/*! For license information please see main.f88e8d73.iframe.bundle.js.LICENSE.txt */
(self.webpackChunktabster=self.webpackChunktabster||[]).push([[179],{"./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Groupper/groupper.css":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js"),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".item {\n    width: 500px;\n    border: 2px dashed red;\n    padding: 4px;\n}\n","",{version:3,sources:["webpack://./stories/Groupper/groupper.css"],names:[],mappings:"AAAA;IACI,YAAY;IACZ,sBAAsB;IACtB,YAAY;AAChB",sourcesContent:[".item {\n    width: 500px;\n    border: 2px dashed red;\n    padding: 4px;\n}\n"],sourceRoot:""}]),__webpack_exports__.Z=___CSS_LOADER_EXPORT___},"./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Modalizer/modalizer.css":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js"),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".lightbox {\n    position: fixed;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.hidden {\n    display: none;\n}\n\n.modal {\n    position: fixed;\n    left: 20%;\n    top: 20%;\n    right: 20%;\n    bottom: 20%;\n    background: #fff;\n    border: 1px solid rgba(0, 0, 0, 0.4);\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n}\n\n.modal-body {\n    display: flex;\n    flex-direction: column;\n}\n\n.button-group {\n    display: flex;\n    margin-left: auto;\n    margin-top: auto;\n    gap: 10px;\n}\n","",{version:3,sources:["webpack://./stories/Modalizer/modalizer.css"],names:[],mappings:"AAAA;IACI,eAAe;IACf,OAAO;IACP,MAAM;IACN,QAAQ;IACR,SAAS;IACT,8BAA8B;AAClC;;AAEA;IACI,aAAa;AACjB;;AAEA;IACI,eAAe;IACf,SAAS;IACT,QAAQ;IACR,UAAU;IACV,WAAW;IACX,gBAAgB;IAChB,oCAAoC;IACpC,aAAa;IACb,aAAa;IACb,sBAAsB;AAC1B;;AAEA;IACI,aAAa;IACb,sBAAsB;AAC1B;;AAEA;IACI,aAAa;IACb,iBAAiB;IACjB,gBAAgB;IAChB,SAAS;AACb",sourcesContent:[".lightbox {\n    position: fixed;\n    left: 0;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.2);\n}\n\n.hidden {\n    display: none;\n}\n\n.modal {\n    position: fixed;\n    left: 20%;\n    top: 20%;\n    right: 20%;\n    bottom: 20%;\n    background: #fff;\n    border: 1px solid rgba(0, 0, 0, 0.4);\n    padding: 20px;\n    display: flex;\n    flex-direction: column;\n}\n\n.modal-body {\n    display: flex;\n    flex-direction: column;\n}\n\n.button-group {\n    display: flex;\n    margin-left: auto;\n    margin-top: auto;\n    gap: 10px;\n}\n"],sourceRoot:""}]),__webpack_exports__.Z=___CSS_LOADER_EXPORT___},"./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Mover/mover.css":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js"),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".mover-wrapper {\n    display: flex;\n    flex-direction: column;\n    width: 200px;\n}\n\n.mover-item {\n    margin: 0;\n}\n","",{version:3,sources:["webpack://./stories/Mover/mover.css"],names:[],mappings:"AAAA;IACI,aAAa;IACb,sBAAsB;IACtB,YAAY;AAChB;;AAEA;IACI,SAAS;AACb",sourcesContent:[".mover-wrapper {\n    display: flex;\n    flex-direction: column;\n    width: 200px;\n}\n\n.mover-item {\n    margin: 0;\n}\n"],sourceRoot:""}]),__webpack_exports__.Z=___CSS_LOADER_EXPORT___},"./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Observed/observed.css":function(module,__webpack_exports__,__webpack_require__){"use strict";var _node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/cssWithMappingToString.js"),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_storybook_builder_webpack5_node_modules_css_loader_dist_runtime_cssWithMappingToString_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,"button {\n    display: block;\n    margin: 10px;\n}\n\n.observed {\n    width: 500px;\n    border: 2px dashed red;\n    padding: 4px;\n    margin: 10px;\n}\n","",{version:3,sources:["webpack://./stories/Observed/observed.css"],names:[],mappings:"AAAA;IACI,cAAc;IACd,YAAY;AAChB;;AAEA;IACI,YAAY;IACZ,sBAAsB;IACtB,YAAY;IACZ,YAAY;AAChB",sourcesContent:["button {\n    display: block;\n    margin: 10px;\n}\n\n.observed {\n    width: 500px;\n    border: 2px dashed red;\n    padding: 4px;\n    margin: 10px;\n}\n"],sourceRoot:""}]),__webpack_exports__.Z=___CSS_LOADER_EXPORT___},"./.storybook/preview.js-generated-config-entry.js":function(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__){"use strict";var preview_namespaceObject={};__webpack_require__.r(preview_namespaceObject),__webpack_require__.d(preview_namespaceObject,{decorators:function(){return decorators},parameters:function(){return parameters}});var ClientApi=__webpack_require__("./node_modules/@storybook/client-api/dist/esm/ClientApi.js"),esm=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/@storybook/client-logger/dist/esm/index.js"),Tabster=__webpack_require__("./src/Tabster.ts"),process=__webpack_require__("./node_modules/process/browser.js"),parameters={actions:{argTypesRegex:"^on[A-Z].*"},controls:{matchers:{color:/(background|color)$/i,date:/Date$/}}},decorators=[function(Story){var controlTab=!process.env.STORYBOOK_UNCONTROLLED,rootDummyInputs=process.env.STORYBOOK_ROOT_DUMMY_INPUTS,tabster=(0,Tabster.ox)(window,{autoRoot:{},controlTab:controlTab,rootDummyInputs:rootDummyInputs});return console.log("created tabster",`as ${controlTab?"controlled":"uncontrolled"}, root dummy inputs ${rootDummyInputs}`),(0,Tabster.V0)(tabster),console.log("created modalizer"),(0,Tabster.BI)(tabster),console.log("created deloser"),(0,Tabster.SG)(tabster),console.log("created outline"),(0,Tabster.GX)(tabster),console.log("created mover"),(0,Tabster.h2)(tabster),console.log("created groupper"),(0,Tabster.yw)(tabster),console.log("created observed"),(0,Tabster.pM)(tabster).setup(),console.log("created cross origin"),window.createTabster=Tabster.ox,window.disposeTabster=Tabster.GL,Story()}];function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.keys(preview_namespaceObject).forEach((function(key){var value=preview_namespaceObject[key];switch(key){case"args":case"argTypes":return esm.kg.warn("Invalid args/argTypes in config, ignoring.",JSON.stringify(value));case"decorators":return value.forEach((function(decorator){return(0,ClientApi.$9)(decorator,!1)}));case"loaders":return value.forEach((function(loader){return(0,ClientApi.HZ)(loader,!1)}));case"parameters":return(0,ClientApi.h1)(function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_defineProperty(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}({},value),!1);case"argTypesEnhancers":return value.forEach((function(enhancer){return(0,ClientApi.My)(enhancer)}));case"argsEnhancers":return value.forEach((function(enhancer){return(0,ClientApi._C)(enhancer)}));case"render":return(0,ClientApi.$P)(value);case"globals":case"globalTypes":var v={};return v[key]=value,(0,ClientApi.h1)(v,!1);case"__namedExportsOrder":case"decorateStory":case"renderToDOM":return null;default:return console.log(key+" was not supported :( !")}}))},"./generated-stories-entry.js":function(module,__unused_webpack_exports,__webpack_require__){"use strict";module=__webpack_require__.nmd(module),(0,__webpack_require__("./node_modules/@storybook/html/dist/esm/client/index.js").configure)([__webpack_require__("./stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.mdx)$"),__webpack_require__("./stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.(js%7Cjsx%7Cts%7Ctsx))$")],module,!1)},"./stories/Groupper/Groupper.stories.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{OnlyTabOut:function(){return OnlyTabOut},TabInAndOut:function(){return TabInAndOut},WithFocusTrap:function(){return WithFocusTrap},default:function(){return Groupper_stories}});var Types=__webpack_require__("./src/Types.ts"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),groupper=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Groupper/groupper.css"),options={insert:"head",singleton:!1},AttributeHelpers=(injectStylesIntoStyleTag_default()(groupper.Z,options),groupper.Z.locals,__webpack_require__("./src/AttributeHelpers.ts")),Groupper_stories={title:"Groupper",argTypes:{tabbability:{control:"select",options:Types.ti}}},FocusableContainer=function(args){return function(props){var tabbability=props.tabbability,wrapper=document.createElement("div");wrapper.tabIndex=0,wrapper.classList.add("item");var attr=(0,AttributeHelpers.yS)({groupper:{tabbability:tabbability}},!0);return wrapper.setAttribute(Types.jN,attr),wrapper.innerHTML="\n    <button>Focusable button</button>\n    <button>Focusable button</button>\n  ",wrapper}(args)},WithFocusTrap=FocusableContainer.bind({});WithFocusTrap.args={tabbability:Types.ti.LimitedTrapFocus};var OnlyTabOut=FocusableContainer.bind({});OnlyTabOut.args={tabbability:Types.ti.Limited};var TabInAndOut=FocusableContainer.bind({});TabInAndOut.args={tabbability:Types.ti.Unlimited},WithFocusTrap.parameters=Object.assign({storySource:{source:"(args) => {\n    return createFocusableContainer(args);\n}"}},WithFocusTrap.parameters),OnlyTabOut.parameters=Object.assign({storySource:{source:"(args) => {\n    return createFocusableContainer(args);\n}"}},OnlyTabOut.parameters),TabInAndOut.parameters=Object.assign({storySource:{source:"(args) => {\n    return createFocusableContainer(args);\n}"}},TabInAndOut.parameters)},"./stories/Modalizer/Modalizer.stories.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Basic:function(){return Basic},circular:function(){return circular},default:function(){return Modalizer_stories}});var injectStylesIntoStyleTag=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),modalizer=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Modalizer/modalizer.css"),options={insert:"head",singleton:!1},Tabster=(injectStylesIntoStyleTag_default()(modalizer.Z,options),modalizer.Z.locals,__webpack_require__("./src/Tabster.ts")),AttributeHelpers=__webpack_require__("./src/AttributeHelpers.ts"),Types=__webpack_require__("./src/Types.ts"),createModalDialog=function(props){var _props$id,_dialog$querySelector,_dialog$querySelector2;null!==(_props$id=props.id)&&void 0!==_props$id||(props.id="modalizer");var tabster=(0,Tabster.ox)(window),dialog=document.createElement("div");dialog.classList.add("lightbox"),dialog.classList.add("hidden"),dialog.innerHTML='\n      <div aria-label="Modal" role="region" class="modal">\n        <h3>Modal dialog</h3>\n        <div class="modal-body">\n          This is a modal dialog powered by Tabster\n\n          <button>Focusable item</button>\n          <button>Focusable item</button>\n          <button>Focusable item</button>\n        </div>\n      <div class="button-group" />\n    ';var closeDialog=function(){return dialog.classList.add("hidden")},rootBtn=document.createElement("button");rootBtn.innerHTML="Open modal dialog",rootBtn.addEventListener("click",(function(){!function(){dialog.classList.remove("hidden");var firstFocusable=null==tabster?void 0:tabster.focusable.findFirst({container:dialog});null==firstFocusable||firstFocusable.focus()}()}));var closeButton=document.createElement("button");closeButton.innerHTML="Close dialog",closeButton.addEventListener("click",(function(){closeDialog()}));var dismissButton=closeButton.cloneNode();dismissButton.innerHTML="Dismiss dialog",dismissButton.addEventListener("click",(function(){closeDialog()}));var isDialogOpen=function(){return!dialog.classList.contains("hidden")};document.addEventListener("click",(function(e){var _dialog$firstElementC;!isDialogOpen()||!e.target||null!==(_dialog$firstElementC=dialog.firstElementChild)&&void 0!==_dialog$firstElementC&&_dialog$firstElementC.contains(e.target)||rootBtn.contains(e.target)||closeDialog()})),document.addEventListener("keydown",(function(e){isDialogOpen()&&"Escape"===e.key&&closeDialog()}));var wrapper=document.createElement("div");wrapper.appendChild(rootBtn),wrapper.appendChild(dialog),null===(_dialog$querySelector=dialog.querySelector(".button-group"))||void 0===_dialog$querySelector||_dialog$querySelector.appendChild(closeButton),null===(_dialog$querySelector2=dialog.querySelector(".button-group"))||void 0===_dialog$querySelector2||_dialog$querySelector2.appendChild(dismissButton);var attr=(0,AttributeHelpers.yS)({modalizer:Object.assign({},props)},!0);return dialog.setAttribute(Types.jN,attr),wrapper},Modalizer_stories={title:"Modalizer",argTypes:{isAlwaysAccessible:{control:"boolean"},isNoFocusDefault:{control:"boolean"},isNoFocusFirst:{control:"boolean"},isOthersAccessible:{control:"boolean"}}},SimpleFocusableCollection=function(args){return createModalDialog(args)},Basic=SimpleFocusableCollection.bind({}),circular=SimpleFocusableCollection.bind({});circular.args={circular:!0},Basic.parameters=Object.assign({storySource:{source:"(args) => {\n    return createModalDialog(args);\n}"}},Basic.parameters),circular.parameters=Object.assign({storySource:{source:"(args) => {\n    return createModalDialog(args);\n}"}},circular.parameters)},"./stories/Mover/Mover.stories.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Circular:function(){return Circular},HorizontalAndVertical:function(){return HorizontalAndVertical},HorizontalOnly:function(){return HorizontalOnly},Tabbable:function(){return Tabbable},TableWithMoverGrid:function(){return TableWithMoverGrid},VerticalOnly:function(){return VerticalOnly},default:function(){return Mover_stories}});var Types=__webpack_require__("./src/Types.ts"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),mover=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Mover/mover.css"),options={insert:"head",singleton:!1},AttributeHelpers=(injectStylesIntoStyleTag_default()(mover.Z,options),mover.Z.locals,__webpack_require__("./src/AttributeHelpers.ts")),Mover_stories={title:"Mover",argTypes:{cyclic:{control:"boolean"},direction:{control:"select",options:Types.bM},memorizeCurrent:{control:"boolean"},tabbable:{control:"boolean"},trackState:{control:"boolean"},visibilityAware:{control:"boolean"}}},SimpleFocusableCollection=function(args){return function(_ref){var cyclic=_ref.cyclic,direction=_ref.direction,disableHomeEndKeys=_ref.disableHomeEndKeys,memorizeCurrent=_ref.memorizeCurrent,tabbable=_ref.tabbable,trackState=_ref.trackState,visibilityAware=_ref.visibilityAware;console.log(direction);var wrapper=document.createElement("div");wrapper.classList.add("mover-wrapper"),wrapper.innerHTML='\n    <button class="mover-item">Mover Item</button>\n    <button class="mover-item">Mover Item</button>\n    <button class="mover-item">Mover Item</button>\n    <button class="mover-item">Mover Item</button>\n  ';var attr=(0,AttributeHelpers.yS)({mover:{cyclic:cyclic,direction:direction,disableHomeEndKeys:disableHomeEndKeys,memorizeCurrent:memorizeCurrent,tabbable:tabbable,trackState:trackState,visibilityAware:visibilityAware}},!0);return wrapper.setAttribute(Types.jN,attr),wrapper}(args)},HorizontalAndVertical=SimpleFocusableCollection.bind({}),Circular=SimpleFocusableCollection.bind({});Circular.args={cyclic:!0};var VerticalOnly=SimpleFocusableCollection.bind({});VerticalOnly.args={direction:Types.bM.Vertical};var HorizontalOnly=SimpleFocusableCollection.bind({});HorizontalOnly.args={direction:Types.bM.Horizontal};var Tabbable=SimpleFocusableCollection.bind({});Tabbable.args={tabbable:!0};var TableWithMoverGrid=function(args){return cyclic=(_ref2=args).cyclic,direction=_ref2.direction,disableHomeEndKeys=_ref2.disableHomeEndKeys,memorizeCurrent=_ref2.memorizeCurrent,tabbable=_ref2.tabbable,trackState=_ref2.trackState,visibilityAware=_ref2.visibilityAware,attr=(0,AttributeHelpers.yS)({mover:{cyclic:cyclic,direction:direction,disableHomeEndKeys:disableHomeEndKeys,memorizeCurrent:memorizeCurrent,tabbable:tabbable,trackState:trackState,visibilityAware:visibilityAware}},!0),(table=document.createElement("table")).innerHTML='\n    <thead>\n        <tr>\n            <th tabindex="0">Company</th>\n            <th tabindex="0">Contact</th>\n            <th tabindex="0">Country</th>\n        </tr>\n    </thead>\n    <tbody class="mover-grid">\n        <tr>\n            <td tabindex="0">Alfreds Futterkiste</td>\n            <td tabindex="0">Maria Anders</td>\n            <td tabindex="0">Germany</td>\n        </tr>\n        <tr>\n            <td tabindex="0">Centro comercial Moctezuma</td>\n            <td tabindex="0">Francisco Chang</td>\n            <td tabindex="0">Mexico</td>\n        </tr>\n        <tr>\n            <td tabindex="0">Ernst Handel</td>\n            <td tabindex="0">Roland Mendel</td>\n            <td tabindex="0">Austria</td>\n        </tr>\n        <tr>\n            <td tabindex="0">Island Trading</td>\n            <td tabindex="0">Helen Bennett</td>\n            <td tabindex="0">UK</td>\n        </tr>\n    </tbody>\n    ',table.setAttribute(Types.jN,attr),table;var _ref2,cyclic,direction,disableHomeEndKeys,memorizeCurrent,tabbable,trackState,visibilityAware,attr,table}.bind({});TableWithMoverGrid.args={direction:Types.bM.Grid},HorizontalAndVertical.parameters=Object.assign({storySource:{source:"(args) => {\n    return createBasicMover(args);\n}"}},HorizontalAndVertical.parameters),Circular.parameters=Object.assign({storySource:{source:"(args) => {\n    return createBasicMover(args);\n}"}},Circular.parameters),VerticalOnly.parameters=Object.assign({storySource:{source:"(args) => {\n    return createBasicMover(args);\n}"}},VerticalOnly.parameters),HorizontalOnly.parameters=Object.assign({storySource:{source:"(args) => {\n    return createBasicMover(args);\n}"}},HorizontalOnly.parameters),Tabbable.parameters=Object.assign({storySource:{source:"(args) => {\n    return createBasicMover(args);\n}"}},Tabbable.parameters),TableWithMoverGrid.parameters=Object.assign({storySource:{source:"(args) =>\n    createTableMover(args)"}},TableWithMoverGrid.parameters)},"./stories/Observed/Observed.stories.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TargetInIframe:function(){return TargetInIframe},TargetNotInDOM:function(){return TargetNotInDOM},default:function(){return Observed_stories}});var injectStylesIntoStyleTag=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),observed=__webpack_require__("./node_modules/@storybook/builder-webpack5/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[8].use[1]!./stories/Observed/observed.css"),options={insert:"head",singleton:!1},Tabster=(injectStylesIntoStyleTag_default()(observed.Z,options),observed.Z.locals,__webpack_require__("./src/Tabster.ts")),AttributeHelpers=__webpack_require__("./src/AttributeHelpers.ts"),Types=__webpack_require__("./src/Types.ts");window.setupTabsterInIframe=function(currWindow){var tabster=(0,Tabster.ox)(currWindow,{autoRoot:{},controlTab:!0,rootDummyInputs:void 0});console.log("created tabster for iframe"),(0,Tabster.yw)(tabster),(0,Tabster.pM)(tabster).setup(),console.log("created cross origin")};var createTrigger=function(_ref){var name=_ref.name,innerText=_ref.innerText,onClick=_ref.onClick,isCrossOrigin=_ref.isCrossOrigin,trigger=document.createElement("button");return trigger.id=`trigger-for-${name}`,trigger.innerText=innerText,trigger.onclick=function(){null==onClick||onClick();var _crossOrigin$observed,tabster=(0,Tabster.ox)(window);isCrossOrigin?null===(_crossOrigin$observed=(0,Tabster.pM)(tabster).observedElement)||void 0===_crossOrigin$observed||_crossOrigin$observed.requestFocus(name,5e3):(0,Tabster.yw)(tabster).requestFocus(name,5e3)},trigger},createObserved=function(props,currDocument){var observed=currDocument.createElement("div");observed.tabIndex=0,observed.classList.add("observed"),observed.innerText=`observed element with names: ${JSON.stringify(props.names)}`;var attr=(0,AttributeHelpers.yS)({observed:props},!0);return observed.setAttribute(Types.jN,attr),observed},Observed_stories={title:"Observed",argTypes:{names:{control:"object"}}},TargetNotInDOM=function(args){return names=(props=args).names,observedContainer=document.createElement("div"),observedTarget=createObserved(props,document),mountObservedTargetWithDelay=function(){observedContainer.childElementCount&&observedContainer.removeChild(observedTarget),setTimeout((function(){observedContainer.appendChild(observedTarget)}),1e3)},triggers=names.map((function(name){return createTrigger({name:name,innerText:`Asynchronously show and focus observed element with name ${name}`,onClick:mountObservedTargetWithDelay})})),wrapper=document.createElement("div"),triggers.forEach((function(trigger){return wrapper.appendChild(trigger)})),wrapper.appendChild(observedContainer),wrapper;var props,names,observedContainer,observedTarget,mountObservedTargetWithDelay,triggers,wrapper}.bind({});TargetNotInDOM.args={names:["observed-0","observed-1"]};var TargetInIframe=function(args){return function(props){var names=props.names,iframe=document.createElement("iframe");iframe.src="#",iframe.onload=function(){var document=iframe.contentDocument;if(document){document.body.innerHTML="";var script=document.createElement("script");script.innerText="setupTabsterInIframe(window)",document.body.append(script);var observedTarget=createObserved(props,document);document.body.append(observedTarget)}},iframe.width="600px";var triggers=names.map((function(name){return createTrigger({name:name,innerText:`Focus observed element in iframe with name ${name}`,isCrossOrigin:!0})})),wrapper=document.createElement("div");return triggers.forEach((function(trigger){return wrapper.appendChild(trigger)})),wrapper.appendChild(iframe),wrapper}(args)}.bind({});TargetInIframe.args={names:["observed-0","observed-1"]},TargetNotInDOM.parameters=Object.assign({storySource:{source:"(args) => {\n    return createObservedWrapper(args);\n}"}},TargetNotInDOM.parameters),TargetInIframe.parameters=Object.assign({storySource:{source:"(args) => {\n    return createObservedWrapperWithIframe(args);\n}"}},TargetInIframe.parameters)},"./stories/TestContainer.stories.tsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{TestContainer:function(){return TestContainer}});__webpack_exports__.default={title:"TestContainer"};var TestContainer=function(){return"<div />"};TestContainer.parameters=Object.assign({storySource:{source:'() => "<div />"'}},TestContainer.parameters)},"./src/AttributeHelpers.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{dx:function(){return setTabsterAttribute},yS:function(){return getTabsterAttribute}});var _Types__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/Types.ts");function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function getTabsterAttribute(props,plain){var attr=JSON.stringify(props);return!0===plain?attr:{[_Types__WEBPACK_IMPORTED_MODULE_0__.jN]:attr}}function setTabsterAttribute(element,newProps,update){var props;if(update){var attr=element.getAttribute(_Types__WEBPACK_IMPORTED_MODULE_0__.jN);if(attr)try{props=JSON.parse(attr)}catch(e){0}}props||(props={}),function mergeTabsterProps(props,newProps){var _step,_iterator=_createForOfIteratorHelper(Object.keys(newProps));try{for(_iterator.s();!(_step=_iterator.n()).done;){var key=_step.value,value=newProps[key];value?props[key]=value:delete props[key]}}catch(err){_iterator.e(err)}finally{_iterator.f()}}(props,newProps),Object.keys(props).length>0?element.setAttribute(_Types__WEBPACK_IMPORTED_MODULE_0__.jN,getTabsterAttribute(props,!0)):element.removeAttribute(_Types__WEBPACK_IMPORTED_MODULE_0__.jN)}},"./src/Tabster.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{ox:function(){return createTabster},GL:function(){return disposeTabster},pM:function(){return getCrossOrigin},BI:function(){return getDeloser},h2:function(){return getGroupper},V0:function(){return getModalizer},GX:function(){return getMover},yw:function(){return getObservedElement},SG:function(){return getOutline}});var src_Types=__webpack_require__("./src/Types.ts");function _createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function _unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Instance_getTabsterOnElement(tabster,element){var _tabster$storageEntry;return null===(_tabster$storageEntry=tabster.storageEntry(element))||void 0===_tabster$storageEntry?void 0:_tabster$storageEntry.tabster}function Instance_updateTabsterByAttribute(tabster,element,dispose){var _entry$attr2,_newAttr,newAttr,newAttrValue=dispose||tabster._noop?void 0:element.getAttribute(src_Types.jN),entry=tabster.storageEntry(element);if(newAttrValue){var _entry,_entry$attr;if(newAttrValue===(null===(_entry=entry)||void 0===_entry||null===(_entry$attr=_entry.attr)||void 0===_entry$attr?void 0:_entry$attr.string))return;try{var newValue=JSON.parse(newAttrValue);if("object"!=typeof newValue)throw new Error(`Value is not a JSON object, got '${newAttrValue}'.`);newAttr={string:newAttrValue,object:newValue}}catch(e){0}}else if(!entry)return;entry||(entry=tabster.storageEntry(element,!0)),entry.tabster||(entry.tabster={});var _step,tabsterOnElement=entry.tabster||{},oldTabsterProps=(null===(_entry$attr2=entry.attr)||void 0===_entry$attr2?void 0:_entry$attr2.object)||{},newTabsterProps=(null===(_newAttr=newAttr)||void 0===_newAttr?void 0:_newAttr.object)||{},_iterator=_createForOfIteratorHelper(Object.keys(oldTabsterProps));try{for(_iterator.s();!(_step=_iterator.n()).done;){var key=_step.value;if(!newTabsterProps[key]){if("root"===key){var root=tabsterOnElement[key];root&&tabster.root.onRoot(root,!0)}else if("modalizer"===key){var modalizer=tabsterOnElement.modalizer;tabster.modalizer&&modalizer&&tabster.modalizer.updateModalizer(modalizer,!0)}switch(key){case"deloser":case"root":case"groupper":case"modalizer":case"mover":var part=tabsterOnElement[key];part&&(part.dispose(),delete tabsterOnElement[key]);break;case"observed":delete tabsterOnElement[key],tabster.observedElement&&tabster.observedElement.onObservedElementUpdate(element);break;case"focusable":case"outline":case"uncontrolled":delete tabsterOnElement[key]}}}}catch(err){_iterator.e(err)}finally{_iterator.f()}var _step2,_iterator2=_createForOfIteratorHelper(Object.keys(newTabsterProps));try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var _key=_step2.value;switch(_key){case"deloser":tabsterOnElement.deloser?tabsterOnElement.deloser.setProps(newTabsterProps.deloser):tabster.deloser&&(tabsterOnElement.deloser=tabster.deloser.createDeloser(element,newTabsterProps.deloser));break;case"root":tabsterOnElement.root?tabsterOnElement.root.setProps(newTabsterProps.root):tabsterOnElement.root=tabster.root.createRoot(element,newTabsterProps.root),tabster.root.onRoot(tabsterOnElement.root);break;case"modalizer":tabsterOnElement.modalizer?tabsterOnElement.modalizer.setProps(newTabsterProps.modalizer):tabster.modalizer&&(tabsterOnElement.modalizer=tabster.modalizer.createModalizer(element,newTabsterProps.modalizer));break;case"focusable":tabsterOnElement.focusable=newTabsterProps.focusable;break;case"groupper":tabsterOnElement.groupper?tabsterOnElement.groupper.setProps(newTabsterProps.groupper):tabster.groupper&&(tabsterOnElement.groupper=tabster.groupper.createGroupper(element,newTabsterProps.groupper));break;case"mover":tabsterOnElement.mover?tabsterOnElement.mover.setProps(newTabsterProps.mover):tabster.mover&&(tabsterOnElement.mover=tabster.mover.createMover(element,newTabsterProps.mover));break;case"observed":tabster.observedElement&&(tabsterOnElement.observed=newTabsterProps.observed,tabster.observedElement.onObservedElementUpdate(element));break;case"uncontrolled":tabsterOnElement.uncontrolled=newTabsterProps.uncontrolled;break;case"outline":tabster.outline&&(tabsterOnElement.outline=newTabsterProps.outline);break;default:console.error(`Unknown key '${_key}' in data-tabster attribute value.`)}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}newAttr?entry.attr=newAttr:(0===Object.keys(tabsterOnElement).length&&(delete entry.tabster,delete entry.attr),tabster.storageEntry(element,!1))}__webpack_require__("./node_modules/core-js/modules/es.typed-array.set.js");var _isBrokenIE11,keyborg_esm=__webpack_require__("./node_modules/keyborg/dist/keyborg.esm.js");__webpack_require__("./node_modules/process/browser.js");function Utils_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function Utils_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return Utils_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Utils_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function Utils_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _DOMRect="undefined"!=typeof DOMRect?DOMRect:function(){return _createClass((function _class2(x,y,width,height){_classCallCheck(this,_class2),this.bottom=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.left=x||0,this.top=y||0,this.right=(x||0)+(width||0),this.bottom=(y||0)+(height||0)}))}(),_uidCounter=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),_isBrokenIE11=!1}catch(e){_isBrokenIE11=!0}function getInstanceContext(getWindow){var win=getWindow(),ctx=win.__tabsterInstanceContext;return ctx||(ctx={elementByUId:{},basics:{Promise:win.Promise||void 0,WeakRef:win.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},win.__tabsterInstanceContext=ctx),ctx}var FakeWeakRef=function(){function FakeWeakRef(target){_classCallCheck(this,FakeWeakRef),this._target=void 0,this._target=target}return _createClass(FakeWeakRef,[{key:"deref",value:function deref(){return this._target}}],[{key:"cleanup",value:function cleanup(fwr,forceRemove){return!fwr._target||!(!forceRemove&&documentContains(fwr._target.ownerDocument,fwr._target))&&(delete fwr._target,!0)}}]),FakeWeakRef}(),WeakHTMLElement=function(){function WeakHTMLElement(getWindow,element,data){_classCallCheck(this,WeakHTMLElement),this._ref=void 0,this._data=void 0;var ref,context=getInstanceContext(getWindow);context.WeakRef?ref=new context.WeakRef(element):(ref=new FakeWeakRef(element),context.fakeWeakRefs.push(ref)),this._ref=ref,this._data=data}return _createClass(WeakHTMLElement,[{key:"get",value:function get(){var element,ref=this._ref;return ref&&((element=ref.deref())||delete this._ref),element}},{key:"getData",value:function getData(){return this._data}}]),WeakHTMLElement}();function cleanupFakeWeakRefs(getWindow,forceRemove){var context=getInstanceContext(getWindow);context.fakeWeakRefs=context.fakeWeakRefs.filter((function(e){return!FakeWeakRef.cleanup(e,forceRemove)}))}function startFakeWeakRefsCleanup(getWindow){var context=getInstanceContext(getWindow);context.fakeWeakRefsStarted||(context.fakeWeakRefsStarted=!0,context.WeakRef=function getWeakRef(context){return context.basics.WeakRef}(context)),context.fakeWeakRefsTimer||(context.fakeWeakRefsTimer=getWindow().setTimeout((function(){context.fakeWeakRefsTimer=void 0,cleanupFakeWeakRefs(getWindow),startFakeWeakRefsCleanup(getWindow)}),12e4))}function Utils_createElementTreeWalker(doc,root,acceptNode){if(root.nodeType===Node.ELEMENT_NODE){var filter=_isBrokenIE11?acceptNode:{acceptNode:acceptNode};return doc.createTreeWalker(root,NodeFilter.SHOW_ELEMENT,filter,!1)}}function getBoundingRect(getWindow,element){var cacheId=element.__tabsterCacheId,context=getInstanceContext(getWindow),cached=cacheId?context.containerBoundingRectCache[cacheId]:void 0;if(cached)return cached.rect;var scrollingElement=element.ownerDocument&&element.ownerDocument.documentElement;if(!scrollingElement)return new _DOMRect;var left=0,top=0,right=scrollingElement.clientWidth,bottom=scrollingElement.clientHeight;if(element!==scrollingElement){var r=element.getBoundingClientRect();left=Math.max(left,r.left),top=Math.max(top,r.top),right=Math.min(right,r.right),bottom=Math.min(bottom,r.bottom)}var rect=new _DOMRect(left<right?left:-1,top<bottom?top:-1,left<right?right-left:0,top<bottom?bottom-top:0);return cacheId||(cacheId="r-"+ ++context.lastContainerBoundingRectCacheId,element.__tabsterCacheId=cacheId),context.containerBoundingRectCache[cacheId]={rect:rect,element:element},context.containerBoundingRectCacheTimer||(context.containerBoundingRectCacheTimer=window.setTimeout((function(){context.containerBoundingRectCacheTimer=void 0;for(var _i=0,_Object$keys=Object.keys(context.containerBoundingRectCache);_i<_Object$keys.length;_i++){var cId=_Object$keys[_i];delete context.containerBoundingRectCache[cId].element.__tabsterCacheId}context.containerBoundingRectCache={}}),50)),rect}function isElementVerticallyVisibleInContainer(getWindow,element){var container=getScrollableContainer(element);if(container){var containerRect=getBoundingRect(getWindow,container),elementRect=element.getBoundingClientRect();return elementRect.top>=containerRect.top&&elementRect.bottom<=containerRect.bottom}return!1}function scrollIntoView(getWindow,element,alignToTop){var container=getScrollableContainer(element);if(container){var containerRect=getBoundingRect(getWindow,container),elementRect=element.getBoundingClientRect();container.scrollTop+=alignToTop?elementRect.top-containerRect.top:elementRect.bottom-containerRect.bottom}}function getScrollableContainer(element){var doc=element.ownerDocument;if(doc){for(var el=element.parentElement;el;el=el.parentElement)if(el.scrollWidth>el.clientWidth||el.scrollHeight>el.clientHeight)return el;return doc.documentElement}return null}function shouldIgnoreFocus(element){return!!element.__shouldIgnoreFocus}function getUId(wnd){var rnd=new Uint32Array(4);if(wnd.crypto&&wnd.crypto.getRandomValues)wnd.crypto.getRandomValues(rnd);else if(wnd.msCrypto&&wnd.msCrypto.getRandomValues)wnd.msCrypto.getRandomValues(rnd);else for(var i=0;i<rnd.length;i++)rnd[i]=4294967295*Math.random();for(var srnd=[],_i2=0;_i2<rnd.length;_i2++)srnd.push(rnd[_i2].toString(36));return srnd.push("|"),srnd.push((++_uidCounter).toString(36)),srnd.push("|"),srnd.push(Date.now().toString(36)),srnd.join("")}function getElementUId(getWindow,element){var context=getInstanceContext(getWindow),uid=element.__tabsterElementUID;return uid||(uid=element.__tabsterElementUID=getUId(getWindow())),!context.elementByUId[uid]&&documentContains(element.ownerDocument,element)&&(context.elementByUId[uid]=new WeakHTMLElement(getWindow,element)),uid}function getWindowUId(win){var uid=win.__tabsterCrossOriginWindowUID;return uid||(uid=win.__tabsterCrossOriginWindowUID=getUId(win)),uid}function clearElementCache(getWindow,parent){for(var context=getInstanceContext(getWindow),_i3=0,_Object$keys2=Object.keys(context.elementByUId);_i3<_Object$keys2.length;_i3++){var key=_Object$keys2[_i3],wel=context.elementByUId[key],el=wel&&wel.get();el&&parent&&!parent.contains(el)||delete context.elementByUId[key]}}function documentContains(doc,element){var _doc$body;return!(null==doc||null===(_doc$body=doc.body)||void 0===_doc$body||!_doc$body.contains(element))}function matchesSelector(element,selector){var matches=element.matches||element.matchesSelector||element.msMatchesSelector||element.webkitMatchesSelector;return matches&&matches.call(element,selector)}function getPromise(getWindow){var context=getInstanceContext(getWindow);if(context.basics.Promise)return context.basics.Promise;throw new Error("No Promise defined.")}var _lastTabsterPartId=0,TabsterPart=function(){function TabsterPart(tabster,element,props){_classCallCheck(this,TabsterPart),this._tabster=void 0,this._element=void 0,this._props=void 0,this.id=void 0;var getWindow=tabster.getWindow;this._tabster=tabster,this._element=new WeakHTMLElement(getWindow,element),this._props=Object.assign({},props),this.id="i"+ ++_lastTabsterPartId}return _createClass(TabsterPart,[{key:"getElement",value:function getElement(){return this._element.get()}},{key:"getProps",value:function getProps(){return this._props}},{key:"setProps",value:function setProps(props){this._props=Object.assign({},props)}}]),TabsterPart}(),DummyInput=function(){function DummyInput(getWindow,isOutside,props,element){var _props$isPhantom,_this=this;_classCallCheck(this,DummyInput),this._isPhantom=void 0,this._disposeTimer=void 0,this._clearDisposeTimeout=void 0,this.input=void 0,this.shouldMoveOut=void 0,this.isFirst=void 0,this.isOutside=void 0,this.onFocusIn=void 0,this.onFocusOut=void 0,this._focusIn=function(e){var input=_this.input;if(_this.onFocusIn&&input){var _relatedTarget=DummyInputManager.getLastPhantomFrom()||e.relatedTarget;_this.onFocusIn(_this,_this._isBackward(!0,input,_relatedTarget),_relatedTarget)}},this._focusOut=function(e){_this.shouldMoveOut=!1;var input=_this.input;if(_this.onFocusOut&&input){var _relatedTarget2=e.relatedTarget;_this.onFocusOut(_this,_this._isBackward(!1,input,_relatedTarget2),_relatedTarget2)}};var win=getWindow(),_input=win.document.createElement("i");_input.tabIndex=0,_input.setAttribute("role","none"),_input.setAttribute(src_Types.$I,""),_input.setAttribute("aria-hidden","true");var style=_input.style;style.position="fixed",style.width=style.height="1px",style.opacity="0.001",style.zIndex="-1",style.setProperty("content-visibility","hidden"),function makeFocusIgnored(element){element.__shouldIgnoreFocus=!0}(_input),this.input=_input,this.isFirst=props.isFirst,this.isOutside=isOutside,this._isPhantom=null!==(_props$isPhantom=props.isPhantom)&&void 0!==_props$isPhantom&&_props$isPhantom,_input.addEventListener("focusin",this._focusIn),_input.addEventListener("focusout",this._focusOut),_input.__tabsterDummyContainer=element,this._isPhantom&&(this._disposeTimer=win.setTimeout((function(){delete _this._disposeTimer,_this.dispose()}),0),this._clearDisposeTimeout=function(){_this._disposeTimer&&(win.clearTimeout(_this._disposeTimer),delete _this._disposeTimer),delete _this._clearDisposeTimeout})}return _createClass(DummyInput,[{key:"dispose",value:function dispose(){var _input$parentElement;this._clearDisposeTimeout&&this._clearDisposeTimeout();var input=this.input;input&&(delete this.onFocusIn,delete this.onFocusOut,delete this.input,input.removeEventListener("focusin",this._focusIn),input.removeEventListener("focusout",this._focusOut),delete input.__tabsterDummyContainer,null===(_input$parentElement=input.parentElement)||void 0===_input$parentElement||_input$parentElement.removeChild(input))}},{key:"setTopLeft",value:function setTopLeft(top,left){var _this$input,style=null===(_this$input=this.input)||void 0===_this$input?void 0:_this$input.style;style&&(style.top=`${top}px`,style.left=`${left}px`)}},{key:"_isBackward",value:function _isBackward(isIn,current,previous){return isIn&&!previous?!this.isFirst:!!(previous&&current.compareDocumentPosition(previous)&Node.DOCUMENT_POSITION_FOLLOWING)}}]),DummyInput}(),DummyInputManagerPriorities_Root=1,DummyInputManagerPriorities_Modalizer=2,DummyInputManagerPriorities_Mover=3,DummyInputManagerPriorities_Groupper=4,DummyInputManager=function(){function DummyInputManager(tabster,element,priority,outsideByDefault){var _this2=this;_classCallCheck(this,DummyInputManager),this._instance=void 0,this._onFocusIn=void 0,this._onFocusOut=void 0,this._element=void 0,this.moveOutWithDefaultAction=void 0,this._element=element,this._instance=new DummyInputManagerCore(tabster,element,this,priority,outsideByDefault),this.moveOutWithDefaultAction=function(backwards){var _this2$_instance;null===(_this2$_instance=_this2._instance)||void 0===_this2$_instance||_this2$_instance.moveOutWithDefaultAction(backwards)}}return _createClass(DummyInputManager,[{key:"_setHandlers",value:function _setHandlers(onFocusIn,onFocusOut){this._onFocusIn=onFocusIn,this._onFocusOut=onFocusOut}},{key:"getHandler",value:function getHandler(isIn){return isIn?this._onFocusIn:this._onFocusOut}},{key:"setTabbable",value:function setTabbable(tabbable){var _this$_instance;null===(_this$_instance=this._instance)||void 0===_this$_instance||_this$_instance.setTabbable(this,tabbable)}},{key:"dispose",value:function dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}}],[{key:"getLastPhantomFrom",value:function getLastPhantomFrom(){var ret=DummyInputManager._lastPhantomFrom;return delete DummyInputManager._lastPhantomFrom,ret}},{key:"moveWithPhantomDummy",value:function moveWithPhantomDummy(tabster,element,moveOutside,isBackward){var input=new DummyInput(tabster.getWindow,!0,{isPhantom:!0,isFirst:!0}).input;if(input){var parent=element.parentElement;if(parent){var insertBefore=moveOutside&&!isBackward||!moveOutside&&isBackward?element.nextElementSibling:element;if(insertBefore)if(isBackward){var beforeBefore=insertBefore.previousElementSibling;beforeBefore&&beforeBefore.__tabsterDummyContainer&&(insertBefore=beforeBefore)}else insertBefore.__tabsterDummyContainer&&(insertBefore=insertBefore.nextElementSibling);parent.insertBefore(input,insertBefore),DummyInputManager._lastPhantomFrom=element,tabster.getWindow().setTimeout((function(){delete DummyInputManager._lastPhantomFrom}),0),(0,keyborg_esm.ev)(input)}}}}]),DummyInputManager}();DummyInputManager._lastPhantomFrom=void 0;var DummyInputManagerCore=function(){function DummyInputManagerCore(tabster,element,_manager,priority,outsideByDefault){var _element$get,_this3=this;_classCallCheck(this,DummyInputManagerCore),this._unobserve=void 0,this._addTimer=void 0,this._getWindow=void 0,this._wrappers=[],this._element=void 0,this._isOutside=!1,this._firstDummy=void 0,this._lastDummy=void 0,this._transformElements=[],this._scrollTimer=void 0,this._onFocusIn=function(dummyInput,isBackward,relatedTarget){_this3._onFocus(!0,dummyInput,isBackward,relatedTarget)},this._onFocusOut=function(dummyInput,isBackward,relatedTarget){_this3._onFocus(!1,dummyInput,isBackward,relatedTarget)},this.moveOutWithDefaultAction=function(backwards){var first=_this3._firstDummy,last=_this3._lastDummy;null!=first&&first.input&&null!=last&&last.input&&(backwards?(first.shouldMoveOut=!0,first.input.tabIndex=0,first.input.focus()):(last.shouldMoveOut=!0,last.input.tabIndex=0,last.input.focus()))},this.setTabbable=function(manager,tabbable){var _step,_iterator=Utils_createForOfIteratorHelper(_this3._wrappers);try{for(_iterator.s();!(_step=_iterator.n()).done;){var w=_step.value;if(w.manager===manager){w.tabbable=tabbable;break}}}catch(err){_iterator.e(err)}finally{_iterator.f()}var wrapper=_this3._getCurrent();if(wrapper){var _this3$_firstDummy,_this3$_lastDummy,tabIndex=wrapper.tabbable?0:-1,input=null===(_this3$_firstDummy=_this3._firstDummy)||void 0===_this3$_firstDummy?void 0:_this3$_firstDummy.input;input&&(input.tabIndex=tabIndex),(input=null===(_this3$_lastDummy=_this3._lastDummy)||void 0===_this3$_lastDummy?void 0:_this3$_lastDummy.input)&&(input.tabIndex=tabIndex)}},this._addTransformOffsets=function(){var win=_this3._getWindow();_this3._scrollTimer&&win.clearTimeout(_this3._scrollTimer),_this3._scrollTimer=win.setTimeout((function(){delete _this3._scrollTimer,_this3._reallyAddTransformOffsets()}),100)};var el=element.get();if(!el)throw new Error("No element");this._getWindow=tabster.getWindow;var instance=el.__tabsterDummy;if((instance||this)._wrappers.push({manager:_manager,priority:priority,tabbable:!0}),instance)return instance;el.__tabsterDummy=this,this._firstDummy=new DummyInput(this._getWindow,this._isOutside,{isFirst:!0},element),this._lastDummy=new DummyInput(this._getWindow,this._isOutside,{isFirst:!1},element),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=element,this._addDummyInputs();var tagName=null===(_element$get=element.get())||void 0===_element$get?void 0:_element$get.tagName;this._isOutside=(outsideByDefault||"UL"===tagName||"OL"===tagName||"TABLE"===tagName)&&!("LI"===tagName||"TD"===tagName||"TH"===tagName),this._observeMutations()}return _createClass(DummyInputManagerCore,[{key:"dispose",value:function dispose(manager,force){if(0===(this._wrappers=this._wrappers.filter((function(w){return w.manager!==manager&&!force}))).length){var _this$_element,_this$_firstDummy,_this$_lastDummy;delete(null===(_this$_element=this._element)||void 0===_this$_element?void 0:_this$_element.get()).__tabsterDummy,this._unobserve&&(this._unobserve(),delete this._unobserve);var _step2,_iterator2=Utils_createForOfIteratorHelper(this._transformElements);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){_step2.value.removeEventListener("scroll",this._addTransformOffsets)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}this._transformElements=[];var win=this._getWindow();this._scrollTimer&&(win.clearTimeout(this._scrollTimer),delete this._scrollTimer),this._addTimer&&(win.clearTimeout(this._addTimer),delete this._addTimer),null===(_this$_firstDummy=this._firstDummy)||void 0===_this$_firstDummy||_this$_firstDummy.dispose(),null===(_this$_lastDummy=this._lastDummy)||void 0===_this$_lastDummy||_this$_lastDummy.dispose()}}},{key:"_onFocus",value:function _onFocus(isIn,dummyInput,isBackward,relatedTarget){var _wrapper$manager$getH,wrapper=this._getCurrent();wrapper&&(null===(_wrapper$manager$getH=wrapper.manager.getHandler(isIn))||void 0===_wrapper$manager$getH||_wrapper$manager$getH(dummyInput,isBackward,relatedTarget))}},{key:"_getCurrent",value:function _getCurrent(){return this._wrappers.sort((function(a,b){return a.tabbable!==b.tabbable?a.tabbable?-1:1:a.priority-b.priority})),this._wrappers[0]}},{key:"_addDummyInputs",value:function _addDummyInputs(){var _this4=this;this._addTimer||(this._addTimer=this._getWindow().setTimeout((function(){var _this4$_element,_this4$_firstDummy,_this4$_lastDummy;delete _this4._addTimer;var element=null===(_this4$_element=_this4._element)||void 0===_this4$_element?void 0:_this4$_element.get(),dif=null===(_this4$_firstDummy=_this4._firstDummy)||void 0===_this4$_firstDummy?void 0:_this4$_firstDummy.input,dil=null===(_this4$_lastDummy=_this4._lastDummy)||void 0===_this4$_lastDummy?void 0:_this4$_lastDummy.input;if(element&&dif&&dil){if(_this4._isOutside){var elementParent=element.parentElement;if(elementParent){var nextSibling=element.nextElementSibling;nextSibling!==dil&&elementParent.insertBefore(dil,nextSibling),element.previousElementSibling!==dif&&elementParent.insertBefore(dif,element)}}else{element.lastElementChild!==dil&&element.appendChild(dil);var firstElementChild=element.firstElementChild;firstElementChild&&firstElementChild!==dif&&element.insertBefore(dif,firstElementChild)}_this4._addTransformOffsets()}}),0))}},{key:"_observeMutations",value:function _observeMutations(){var _this$_element2,_this5=this;if(!this._unobserve){var observer=new MutationObserver((function(){_this5._unobserve&&_this5._addDummyInputs()})),element=null===(_this$_element2=this._element)||void 0===_this$_element2?void 0:_this$_element2.get(),actualElement=this._isOutside?null==element?void 0:element.parentElement:element;actualElement&&(observer.observe(actualElement,{childList:!0}),this._unobserve=function(){observer.disconnect()})}}},{key:"_reallyAddTransformOffsets",value:function _reallyAddTransformOffsets(){var _this$_firstDummy2,_this$_lastDummy2,_this$_firstDummy3,_this$_lastDummy3,_step3,from=(null===(_this$_firstDummy2=this._firstDummy)||void 0===_this$_firstDummy2?void 0:_this$_firstDummy2.input)||(null===(_this$_lastDummy2=this._lastDummy)||void 0===_this$_lastDummy2?void 0:_this$_lastDummy2.input),transformElements=this._transformElements,newTransformElements=[],transformElementsMap=new WeakMap,newTransformElementsMap=new WeakMap,scrollTop=0,scrollLeft=0,_iterator3=Utils_createForOfIteratorHelper(transformElements);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var el=_step3.value;transformElementsMap.set(el,el)}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}for(var win=this._getWindow(),element=from;element;element=element.parentElement){var transform=win.getComputedStyle(element).transform;if(transform&&"none"!==transform){var _el=transformElementsMap.get(element);_el||(_el=element).addEventListener("scroll",this._addTransformOffsets),newTransformElements.push(_el),newTransformElementsMap.set(_el,_el),scrollTop+=_el.scrollTop,scrollLeft+=_el.scrollLeft}}var _step4,_iterator4=Utils_createForOfIteratorHelper(transformElements);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var _el2=_step4.value;newTransformElementsMap.get(_el2)||_el2.removeEventListener("scroll",this._addTransformOffsets)}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}this._transformElements=newTransformElements,null===(_this$_firstDummy3=this._firstDummy)||void 0===_this$_firstDummy3||_this$_firstDummy3.setTopLeft(scrollTop,scrollLeft),null===(_this$_lastDummy3=this._lastDummy)||void 0===_this$_lastDummy3||_this$_lastDummy3.setTopLeft(scrollTop,scrollLeft)}}]),DummyInputManagerCore}();function getLastChild(container){for(var lastChild=null,i=container.lastElementChild;i;i=i.lastElementChild)lastChild=i;return lastChild||void 0}function getAdjacentElement(from,prev){for(var cur=from,adjacent=null;cur&&!adjacent;)adjacent=prev?cur.previousElementSibling:cur.nextElementSibling,cur=cur.parentElement;return adjacent||void 0}function triggerEvent(target,name,details){var event=document.createEvent("HTMLEvents");return event.initEvent(name,!0,!0),event.details=details,target.dispatchEvent(event),!event.defaultPrevented}var AttributeHelpers=__webpack_require__("./src/AttributeHelpers.ts");function Root_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Root_createClass(Constructor,protoProps,staticProps){return protoProps&&Root_defineProperties(Constructor.prototype,protoProps),staticProps&&Root_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function Root_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function _createSuper(Derived){var hasNativeReflectConstruct=function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return _possibleConstructorReturn(this,result)}}function _possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}var RootDummyManager=function(_DummyInputManager){_inherits(RootDummyManager,_DummyInputManager);var _super=_createSuper(RootDummyManager);function RootDummyManager(tabster,_element,setFocused){var _this;return Root_classCallCheck(this,RootDummyManager),(_this=_super.call(this,tabster,_element,DummyInputManagerPriorities_Root))._tabster=void 0,_this._setFocused=void 0,_this._onDummyInputFocus=function(dummyInput){if(dummyInput.shouldMoveOut)_this._setFocused(!1,!0);else{var _dummyInput$input;_this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);var element=_this._element.get();if(element)if(_this._setFocused(!0,!0),dummyInput.isFirst?_this._tabster.focusedElement.focusFirst({container:element}):_this._tabster.focusedElement.focusLast({container:element}))return;null===(_dummyInput$input=dummyInput.input)||void 0===_dummyInput$input||_dummyInput$input.blur()}},_this._setHandlers(_this._onDummyInputFocus),_this._tabster=tabster,_this._setFocused=setFocused,_this}return Root_createClass(RootDummyManager)}(DummyInputManager),Root=function(_TabsterPart){_inherits(Root,_TabsterPart);var _super2=_createSuper(Root);function Root(tabster,_element2,onDispose,props){var _this2;Root_classCallCheck(this,Root),(_this2=_super2.call(this,tabster,_element2,props)).uid=void 0,_this2._dummyManager=void 0,_this2._isFocused=!1,_this2._setFocusedTimer=void 0,_this2._setTabbableTimer=void 0,_this2._onDispose=void 0,_this2._setFocused=function(hasFocused,fromAdjacent){if(_this2._setFocusedTimer&&(_this2._tabster.getWindow().clearTimeout(_this2._setFocusedTimer),delete _this2._setFocusedTimer),_this2._isFocused!==hasFocused){var element=_this2._element.get();element&&(hasFocused?(_this2._isFocused=!0,triggerEvent(_this2._tabster.root.eventTarget,"focus",{element:element,fromAdjacent:fromAdjacent})):_this2._setFocusedTimer=_this2._tabster.getWindow().setTimeout((function(){delete _this2._setFocusedTimer,_this2._isFocused=!1,triggerEvent(_this2._tabster.root.eventTarget,"blur",{element:element,fromAdjacent:fromAdjacent})}),0))}},_this2._onFocus=function(e){var win=_this2._tabster.getWindow();if(_this2._setTabbableTimer&&(win.clearTimeout(_this2._setTabbableTimer),delete _this2._setTabbableTimer),e){var _this2$_dummyManager,ctx=RootAPI.getTabsterContext(_this2._tabster,e);if(ctx&&_this2._setFocused(ctx.root.getElement()===_this2._element.get()),!ctx||ctx.uncontrolled||_this2._tabster.rootDummyInputs)return void(null===(_this2$_dummyManager=_this2._dummyManager)||void 0===_this2$_dummyManager||_this2$_dummyManager.setTabbable(!1))}else _this2._setFocused(!1);_this2._setTabbableTimer=win.setTimeout((function(){var _this2$_dummyManager2;delete _this2._setTabbableTimer,null===(_this2$_dummyManager2=_this2._dummyManager)||void 0===_this2$_dummyManager2||_this2$_dummyManager2.setTabbable(!0)}),0)},_this2._onDispose=onDispose;var _win=tabster.getWindow;return _this2.uid=getElementUId(_win,_element2),(tabster.controlTab||tabster.rootDummyInputs)&&(_this2._dummyManager=new RootDummyManager(tabster,_this2._element,_this2._setFocused)),tabster.focusedElement.subscribe(_this2._onFocus),_this2._add(),_this2}return Root_createClass(Root,[{key:"dispose",value:function dispose(){var _this$_dummyManager;this._onDispose(this);var win=this._tabster.getWindow();this._setFocusedTimer&&(win.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._setTabbableTimer&&(win.clearTimeout(this._setTabbableTimer),delete this._setTabbableTimer),null===(_this$_dummyManager=this._dummyManager)||void 0===_this$_dummyManager||_this$_dummyManager.dispose(),this._remove()}},{key:"moveOutWithDefaultAction",value:function moveOutWithDefaultAction(isBackward){var dummyManager=this._dummyManager;if(dummyManager)dummyManager.moveOutWithDefaultAction(isBackward);else{var el=this.getElement();el&&RootDummyManager.moveWithPhantomDummy(this._tabster,el,!0,isBackward)}}},{key:"_add",value:function _add(){0}},{key:"_remove",value:function _remove(){0}}]),Root}(TabsterPart);var RootAPI=function(){function RootAPI(tabster,autoRoot){var _this3=this;Root_classCallCheck(this,RootAPI),this._tabster=void 0,this._win=void 0,this._initTimer=void 0,this._autoRoot=void 0,this._autoRootWaiting=!1,this._roots={},this.rootById={},this.eventTarget=void 0,this._init=function(){_this3._initTimer=void 0,_this3._autoRoot&&_this3._autoRootCreate()},this._autoRootCreate=function(){if(!_this3._initTimer){var doc=_this3._win().document,body=doc.body;if(body){_this3._autoRootUnwait(doc);var _getTabsterOnElement,props=_this3._autoRoot;if(props)return(0,AttributeHelpers.dx)(body,{root:props},!0),Instance_updateTabsterByAttribute(_this3._tabster,body),null===(_getTabsterOnElement=Instance_getTabsterOnElement(_this3._tabster,body))||void 0===_getTabsterOnElement?void 0:_getTabsterOnElement.root}else _this3._autoRootWaiting||(_this3._autoRootWaiting=!0,doc.addEventListener("readystatechange",_this3._autoRootCreate))}},this._onRootDispose=function(root){delete _this3._roots[root.id]},this._tabster=tabster,this._win=tabster.getWindow,this._initTimer=this._win().setTimeout(this._init,0),this._autoRoot=autoRoot,this.eventTarget=function createEventTarget(getWindow){var global=getWindow();return global.EventTarget?new global.EventTarget:global.document.createElement("div")}(this._win)}return Root_createClass(RootAPI,[{key:"_autoRootUnwait",value:function _autoRootUnwait(doc){doc.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}},{key:"dispose",value:function dispose(){var _this4=this,win=this._win();this._autoRootUnwait(win.document),delete this._autoRoot,win.clearTimeout(this._initTimer),this._initTimer=void 0,Object.keys(this._roots).forEach((function(rootId){_this4._roots[rootId]&&(_this4._roots[rootId].dispose(),delete _this4._roots[rootId])})),this.rootById={}}},{key:"createRoot",value:function createRoot(element,props){var newRoot=new Root(this._tabster,element,this._onRootDispose,props);return this._roots[newRoot.id]=newRoot,newRoot}},{key:"onRoot",value:function onRoot(root,removed){removed?delete this.rootById[root.uid]:this.rootById[root.uid]=root}}],[{key:"getRootByUId",value:function getRootByUId(getWindow,id){var tabster=getWindow().__tabsterInstance;return tabster&&tabster.root.rootById[id]}},{key:"getTabsterContext",value:function getTabsterContext(tabster,element){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(element.ownerDocument){for(var root,modalizer,groupper,mover,isGroupperFirst,isRtl,uncontrolled,checkRtl=options.checkRtl,isExcludedFromMover=!1,curElement=element,ignoreKeydown={};curElement&&(!root||checkRtl);){var _tabsterOnElement$foc,_tabsterOnElement$foc2,tabsterOnElement=Instance_getTabsterOnElement(tabster,curElement);if(checkRtl&&void 0===isRtl){var dir=curElement.dir;dir&&(isRtl="rtl"===dir.toLowerCase())}if(tabsterOnElement){tabsterOnElement.uncontrolled&&(uncontrolled=curElement),mover||null===(_tabsterOnElement$foc=tabsterOnElement.focusable)||void 0===_tabsterOnElement$foc||!_tabsterOnElement$foc.excludeFromMover||groupper||(isExcludedFromMover=!0);var curGroupper=tabsterOnElement.groupper,curMover=tabsterOnElement.mover;!groupper&&curGroupper&&(groupper=curGroupper),!mover&&curMover&&(mover=curMover,isGroupperFirst=!!groupper),!modalizer&&tabsterOnElement.modalizer&&(modalizer=tabsterOnElement.modalizer),tabsterOnElement.root&&(root=tabsterOnElement.root),null!==(_tabsterOnElement$foc2=tabsterOnElement.focusable)&&void 0!==_tabsterOnElement$foc2&&_tabsterOnElement$foc2.ignoreKeydown&&Object.assign(ignoreKeydown,tabsterOnElement.focusable.ignoreKeydown),curElement=curElement.parentElement}else curElement=curElement.parentElement}if(!root){var _element$ownerDocumen,rootAPI=tabster.root,autoRoot=rootAPI._autoRoot;if(autoRoot)null!==(_element$ownerDocumen=element.ownerDocument)&&void 0!==_element$ownerDocumen&&_element$ownerDocumen.body&&(root=rootAPI._autoRootCreate())}return groupper&&!mover&&(isGroupperFirst=!0),root?{root:root,modalizer:modalizer,groupper:groupper,mover:mover,isGroupperFirst:isGroupperFirst,isRtl:checkRtl?!!isRtl:void 0,uncontrolled:uncontrolled,isExcludedFromMover:isExcludedFromMover,ignoreKeydown:ignoreKeydown}:void 0}}}]),RootAPI}();function Deloser_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function Deloser_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return Deloser_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Deloser_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function Deloser_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Deloser_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Deloser_setPrototypeOf(subClass,superClass)}function Deloser_setPrototypeOf(o,p){return Deloser_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},Deloser_setPrototypeOf(o,p)}function Deloser_createSuper(Derived){var hasNativeReflectConstruct=function Deloser_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=Deloser_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Deloser_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Deloser_possibleConstructorReturn(this,result)}}function Deloser_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function Deloser_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Deloser_getPrototypeOf(o){return Deloser_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},Deloser_getPrototypeOf(o)}function Deloser_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Deloser_createClass(Constructor,protoProps,staticProps){return protoProps&&Deloser_defineProperties(Constructor.prototype,protoProps),staticProps&&Deloser_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function Deloser_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var DeloserItemBase=Deloser_createClass((function DeloserItemBase(){Deloser_classCallCheck(this,DeloserItemBase)})),DeloserItem=function(_DeloserItemBase){Deloser_inherits(DeloserItem,_DeloserItemBase);var _super=Deloser_createSuper(DeloserItem);function DeloserItem(tabster,deloser){var _this;return Deloser_classCallCheck(this,DeloserItem),(_this=_super.call(this)).uid=void 0,_this._tabster=void 0,_this._deloser=void 0,_this.uid=deloser.uid,_this._tabster=tabster,_this._deloser=deloser,_this}return Deloser_createClass(DeloserItem,[{key:"belongsTo",value:function belongsTo(deloser){return deloser===this._deloser}},{key:"unshift",value:function unshift(element){this._deloser.unshift(element)}},{key:"focusAvailable",value:async function focusAvailable(){var available=this._deloser.findAvailable();return!!available&&this._tabster.focusedElement.focus(available)}},{key:"resetFocus",value:async function resetFocus(){return getPromise(this._tabster.getWindow).resolve(this._deloser.resetFocus())}}]),DeloserItem}(DeloserItemBase),DeloserHistoryByRootBase=function(){function DeloserHistoryByRootBase(tabster,rootUId){Deloser_classCallCheck(this,DeloserHistoryByRootBase),this._tabster=void 0,this._history=[],this.rootUId=void 0,this._tabster=tabster,this.rootUId=rootUId}return Deloser_createClass(DeloserHistoryByRootBase,[{key:"getLength",value:function getLength(){return this._history.length}},{key:"removeDeloser",value:function removeDeloser(deloser){this._history=this._history.filter((function(c){return!c.belongsTo(deloser)}))}},{key:"hasDeloser",value:function hasDeloser(deloser){return this._history.some((function(d){return d.belongsTo(deloser)}))}}]),DeloserHistoryByRootBase}(),DeloserHistoryByRoot=function(_DeloserHistoryByRoot){Deloser_inherits(DeloserHistoryByRoot,_DeloserHistoryByRoot);var _super2=Deloser_createSuper(DeloserHistoryByRoot);function DeloserHistoryByRoot(){return Deloser_classCallCheck(this,DeloserHistoryByRoot),_super2.apply(this,arguments)}return Deloser_createClass(DeloserHistoryByRoot,[{key:"unshiftToDeloser",value:function unshiftToDeloser(deloser,element){for(var item,i=0;i<this._history.length;i++)if(this._history[i].belongsTo(deloser)){item=this._history[i],this._history.splice(i,1);break}item||(item=new DeloserItem(this._tabster,deloser)),item.unshift(element),this._history.unshift(item),this._history.splice(10,this._history.length-10)}},{key:"focusAvailable",value:async function focusAvailable(from){var _step,skip=!!from,_iterator=Deloser_createForOfIteratorHelper(this._history);try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;if(from&&i.belongsTo(from)&&(skip=!1),!skip&&await i.focusAvailable())return!0}}catch(err){_iterator.e(err)}finally{_iterator.f()}return!1}},{key:"resetFocus",value:async function resetFocus(from){var _step2,skip=!!from,resetQueue={},_iterator2=Deloser_createForOfIteratorHelper(this._history);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var i=_step2.value;from&&i.belongsTo(from)&&(skip=!1),skip||resetQueue[i.uid]||(resetQueue[i.uid]=i)}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}for(var _i=0,_Object$keys=Object.keys(resetQueue);_i<_Object$keys.length;_i++){var _id=_Object$keys[_i];if(await resetQueue[_id].resetFocus())return!0}return!1}}]),DeloserHistoryByRoot}(DeloserHistoryByRootBase),DeloserHistory=function(){function DeloserHistory(tabster){Deloser_classCallCheck(this,DeloserHistory),this._tabster=void 0,this._history=[],this._tabster=tabster}return Deloser_createClass(DeloserHistory,[{key:"dispose",value:function dispose(){this._history=[]}},{key:"process",value:function process(element){var _ctx$modalizer,_this2=this,ctx=RootAPI.getTabsterContext(this._tabster,element),rootUId=ctx&&ctx.root.uid,deloser=DeloserAPI.getDeloser(this._tabster,element);if(rootUId&&deloser){var historyByRoot=this.make(rootUId,(function(){return new DeloserHistoryByRoot(_this2._tabster,rootUId)}));return(!ctx||!ctx.modalizer||null!==(_ctx$modalizer=ctx.modalizer)&&void 0!==_ctx$modalizer&&_ctx$modalizer.isActive())&&historyByRoot.unshiftToDeloser(deloser,element),deloser}}},{key:"make",value:function make(rootUId,createInstance){for(var historyByRoot,i=0;i<this._history.length;i++){var hbr=this._history[i];if(hbr.rootUId===rootUId){historyByRoot=hbr,this._history.splice(i,1);break}}return historyByRoot||(historyByRoot=createInstance()),this._history.unshift(historyByRoot),this._history.splice(10,this._history.length-10),historyByRoot}},{key:"removeDeloser",value:function removeDeloser(deloser){this._history.forEach((function(i){i.removeDeloser(deloser)})),this._history=this._history.filter((function(i){return i.getLength()>0}))}},{key:"focusAvailable",value:async function focusAvailable(from){var _step3,skip=!!from,_iterator3=Deloser_createForOfIteratorHelper(this._history);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var h=_step3.value;if(from&&h.hasDeloser(from)&&(skip=!1),!skip&&await h.focusAvailable(from))return!0}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}return!1}},{key:"resetFocus",value:async function resetFocus(from){var _step4,skip=!!from,_iterator4=Deloser_createForOfIteratorHelper(this._history);try{for(_iterator4.s();!(_step4=_iterator4.n()).done;){var h=_step4.value;if(from&&h.hasDeloser(from)&&(skip=!1),!skip&&await h.resetFocus(from))return!0}}catch(err){_iterator4.e(err)}finally{_iterator4.f()}return!1}}]),DeloserHistory}();function buildElementSelector(element,withClass,withIndex){var selector=[],escapeRegExp=/(:|\.|\[|\]|,|=|@)/g;element.id&&selector.push("#"+element.id.replace(escapeRegExp,"\\$1")),!1!==withClass&&element.className&&element.className.split(" ").forEach((function(cls){(cls=cls.trim())&&selector.push("."+cls.replace(escapeRegExp,"\\$1"))}));var el,index=0;if(!1!==withIndex&&0===selector.length){for(el=element;el;)index++,el=el.previousElementSibling;selector.unshift(":nth-child("+index+")")}return selector.unshift(element.tagName.toLowerCase()),selector.join("")}var Deloser=function(_TabsterPart){Deloser_inherits(Deloser,_TabsterPart);var _super3=Deloser_createSuper(Deloser);function Deloser(tabster,_element,onDispose,props){var _this3;return Deloser_classCallCheck(this,Deloser),(_this3=_super3.call(this,tabster,_element,props)).uid=void 0,_this3._isActive=!1,_this3._history=[[]],_this3._snapshotIndex=0,_this3._onDispose=void 0,_this3.isActive=function(){return _this3._isActive},_this3.setSnapshot=function(index){_this3._snapshotIndex=index,_this3._history.length>index+1&&_this3._history.splice(index+1,_this3._history.length-index-1),_this3._history[index]||(_this3._history[index]=[])},_this3.focusFirst=function(){var e=_this3._element.get();return!!e&&_this3._tabster.focusedElement.focusFirst({container:e})},_this3.focusDefault=function(){var e=_this3._element.get();return!!e&&_this3._tabster.focusedElement.focusDefault(e)},_this3.resetFocus=function(){var e=_this3._element.get();return!!e&&_this3._tabster.focusedElement.resetFocus(e)},_this3.clearHistory=function(preserveExisting){var element=_this3._element.get();_this3._history[_this3._snapshotIndex]=element?_this3._history[_this3._snapshotIndex].filter((function(we){var e=we.get();return!(!e||!preserveExisting)&&element.contains(e)})):[]},_this3.uid=getElementUId(tabster.getWindow,_element),_this3._onDispose=onDispose,_this3}return Deloser_createClass(Deloser,[{key:"dispose",value:function dispose(){this._remove(),this._onDispose(this),this._isActive=!1,this._snapshotIndex=0,this._props={},this._history=[]}},{key:"setActive",value:function setActive(active){this._isActive=active}},{key:"getActions",value:function getActions(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}}},{key:"unshift",value:function unshift(element){var cur=this._history[this._snapshotIndex];for((cur=this._history[this._snapshotIndex]=cur.filter((function(we){var e=we.get();return e&&e!==element}))).unshift(new WeakHTMLElement(this._tabster.getWindow,element,function buildSelector(element){if(documentContains(element.ownerDocument,element)){for(var selector=[buildElementSelector(element)],el=element.parentElement;el;){var isBody="BODY"===el.tagName;if(selector.unshift(buildElementSelector(el,!1,!isBody)),isBody)break;el=el.parentElement}return selector.join(" ")}}(element)));cur.length>10;)cur.pop()}},{key:"findAvailable",value:function findAvailable(){var element=this._element.get();if(!element||!this._tabster.focusable.isVisible(element))return null;var restoreFocusOrder=this._props.restoreFocusOrder,available=null,ctx=RootAPI.getTabsterContext(this._tabster,element);if(!ctx)return null;var root=ctx.root,rootElement=root.getElement();if(!rootElement)return null;if(void 0===restoreFocusOrder&&(restoreFocusOrder=root.getProps().restoreFocusOrder),restoreFocusOrder===src_Types.ho.RootDefault&&(available=this._tabster.focusable.findDefault({container:rootElement})),available||restoreFocusOrder!==src_Types.ho.RootFirst||(available=this._findFirst(rootElement)),available)return available;var availableInHistory=this._findInHistory(),availableDefault=this._tabster.focusable.findDefault({container:element}),availableFirst=this._findFirst(element);return availableInHistory&&restoreFocusOrder===src_Types.ho.History?availableInHistory:availableDefault&&restoreFocusOrder===src_Types.ho.DeloserDefault?availableDefault:availableFirst&&restoreFocusOrder===src_Types.ho.DeloserFirst?availableFirst:availableDefault||availableInHistory||availableFirst||null}},{key:"customFocusLostHandler",value:function customFocusLostHandler(element){return triggerEvent(element,src_Types.Yy,this.getActions())}},{key:"_findInHistory",value:function _findInHistory(){var cur=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(var i=0;i<cur.length;i++){var we=cur[i],e=we.get(),element=this._element.get();if(e&&element&&element.contains(e)){if(this._tabster.focusable.isFocusable(e))return e}else if(!this._props.noSelectorCheck){var selector=we.getData();if(selector&&element){var els=void 0;try{els=element.ownerDocument.querySelectorAll(selector)}catch(e){0;continue}for(var _i2=0;_i2<els.length;_i2++){var el=els[_i2];if(el&&this._tabster.focusable.isFocusable(el))return el}}}}return null}},{key:"_findFirst",value:function _findFirst(element){if(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()){var first=this._tabster.focusable.findFirst({container:element});if(first)return first}return null}},{key:"_remove",value:function _remove(){0}}]),Deloser}(TabsterPart);var DeloserAPI=function(){function DeloserAPI(tabster,props){var _this4=this;Deloser_classCallCheck(this,DeloserAPI),this._tabster=void 0,this._win=void 0,this._initTimer=void 0,this._inDeloser=!1,this._curDeloser=void 0,this._history=void 0,this._restoreFocusTimer=void 0,this._isRestoringFocus=!1,this._isPaused=!1,this._autoDeloser=void 0,this._autoDeloserInstance=void 0,this._init=function(){_this4._initTimer=void 0,_this4._tabster.focusedElement.subscribe(_this4._onFocus)},this._onFocus=function(e){if(_this4._restoreFocusTimer&&(_this4._win().clearTimeout(_this4._restoreFocusTimer),_this4._restoreFocusTimer=void 0),e){var deloser=_this4._history.process(e);deloser?_this4._activate(deloser):_this4._deactivate()}else _this4._scheduleRestoreFocus()},this._onDeloserDispose=function(deloser){_this4._history.removeDeloser(deloser),deloser.isActive()&&_this4._scheduleRestoreFocus()},this._tabster=tabster,this._win=tabster.getWindow,this._history=new DeloserHistory(tabster),this._initTimer=this._win().setTimeout(this._init,0);var autoDeloser=null==props?void 0:props.autoDeloser;autoDeloser&&(this._autoDeloser=autoDeloser)}return Deloser_createClass(DeloserAPI,[{key:"dispose",value:function dispose(){var win=this._win();this._initTimer&&(win.clearTimeout(this._initTimer),this._initTimer=void 0),this._restoreFocusTimer&&(win.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),this._autoDeloserInstance&&(this._autoDeloserInstance.dispose(),delete this._autoDeloserInstance,delete this._autoDeloser),this._tabster.focusedElement.unsubscribe(this._onFocus),this._history.dispose(),delete this._curDeloser}},{key:"createDeloser",value:function createDeloser(element,props){var _this$_tabster$focuse;var deloser=new Deloser(this._tabster,element,this._onDeloserDispose,props);return element.contains(null!==(_this$_tabster$focuse=this._tabster.focusedElement.getFocusedElement())&&void 0!==_this$_tabster$focuse?_this$_tabster$focuse:null)&&this._activate(deloser),deloser}},{key:"getActions",value:function getActions(element){for(var e=element;e;e=e.parentElement){var tabsterOnElement=Instance_getTabsterOnElement(this._tabster,e);if(tabsterOnElement&&tabsterOnElement.deloser)return tabsterOnElement.deloser.getActions()}}},{key:"pause",value:function pause(){this._isPaused=!0,this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)}},{key:"resume",value:function resume(restore){this._isPaused=!1,restore&&this._scheduleRestoreFocus()}},{key:"_activate",value:function _activate(deloser){var curDeloser=this._curDeloser;curDeloser!==deloser&&(this._inDeloser=!0,null==curDeloser||curDeloser.setActive(!1),deloser.setActive(!0),this._curDeloser=deloser)}},{key:"_deactivate",value:function _deactivate(){var _this$_curDeloser;this._inDeloser=!1,null===(_this$_curDeloser=this._curDeloser)||void 0===_this$_curDeloser||_this$_curDeloser.setActive(!1),this._curDeloser=void 0}},{key:"_scheduleRestoreFocus",value:function _scheduleRestoreFocus(force){var _this5=this;if(!this._isPaused&&!this._isRestoringFocus){var restoreFocus=async function(){_this5._restoreFocusTimer=void 0;var lastFocused=_this5._tabster.focusedElement.getLastFocusedElement();if(force||!(_this5._isRestoringFocus||!_this5._inDeloser||null!=lastFocused&&lastFocused.offsetParent)){var curDeloser=_this5._curDeloser;if(curDeloser){if(lastFocused&&curDeloser.customFocusLostHandler(lastFocused))return;var el=curDeloser.findAvailable();if(el&&_this5._tabster.focusedElement.focus(el))return}_this5._deactivate(),_this5._isRestoringFocus=!0,await _this5._history.focusAvailable(null)||await _this5._history.resetFocus(null),_this5._isRestoringFocus=!1}};force?restoreFocus():this._restoreFocusTimer=this._win().setTimeout(restoreFocus,100)}}}],[{key:"getDeloser",value:function getDeloser(tabster,element){for(var e=element;e;e=e.parentElement){var tabsterOnElement=Instance_getTabsterOnElement(tabster,e);if(tabsterOnElement&&tabsterOnElement.deloser)return tabsterOnElement.deloser}var deloserAPI=tabster.deloser&&tabster.deloser;if(deloserAPI){if(deloserAPI._autoDeloserInstance)return deloserAPI._autoDeloserInstance;var autoDeloserProps=deloserAPI._autoDeloser;if(!deloserAPI._autoDeloserInstance&&autoDeloserProps){var _element$ownerDocumen,body=null===(_element$ownerDocumen=element.ownerDocument)||void 0===_element$ownerDocumen?void 0:_element$ownerDocumen.body;body&&(deloserAPI._autoDeloserInstance=new Deloser(tabster,body,tabster.deloser._onDeloserDispose,autoDeloserProps))}return deloserAPI._autoDeloserInstance}}},{key:"getHistory",value:function getHistory(instance){return instance._history}},{key:"forceRestoreFocus",value:function forceRestoreFocus(instance){instance._scheduleRestoreFocus(!0)}}]),DeloserAPI}();function Subscribable_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var Subscribable=function(){function Subscribable(){!function Subscribable_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Subscribable),this._val=void 0,this._callbacks=[]}return function Subscribable_createClass(Constructor,protoProps,staticProps){return protoProps&&Subscribable_defineProperties(Constructor.prototype,protoProps),staticProps&&Subscribable_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(Subscribable,[{key:"dispose",value:function dispose(){this._callbacks=[],delete this._val}},{key:"subscribe",value:function subscribe(callback){this._callbacks.indexOf(callback)<0&&this._callbacks.push(callback)}},{key:"unsubscribe",value:function unsubscribe(callback){var index=this._callbacks.indexOf(callback);index>=0&&this._callbacks.splice(index,1)}},{key:"setVal",value:function setVal(val,details){this._val!==val&&(this._val=val,this._callCallbacks(val,details))}},{key:"getVal",value:function getVal(){return this._val}},{key:"trigger",value:function trigger(val,details){this._callCallbacks(val,details)}},{key:"_callCallbacks",value:function _callCallbacks(val,details){this._callbacks.forEach((function(callback){return callback(val,details)}))}}]),Subscribable}();function CrossOrigin_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function CrossOrigin_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return CrossOrigin_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CrossOrigin_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function CrossOrigin_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function CrossOrigin_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function CrossOrigin_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function CrossOrigin_createClass(Constructor,protoProps,staticProps){return protoProps&&CrossOrigin_defineProperties(Constructor.prototype,protoProps),staticProps&&CrossOrigin_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function CrossOrigin_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&CrossOrigin_setPrototypeOf(subClass,superClass)}function CrossOrigin_setPrototypeOf(o,p){return CrossOrigin_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},CrossOrigin_setPrototypeOf(o,p)}function CrossOrigin_createSuper(Derived){var hasNativeReflectConstruct=function CrossOrigin_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=CrossOrigin_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=CrossOrigin_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return CrossOrigin_possibleConstructorReturn(this,result)}}function CrossOrigin_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function CrossOrigin_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function CrossOrigin_getPrototypeOf(o){return CrossOrigin_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},CrossOrigin_getPrototypeOf(o)}var CrossOriginTransactionTypes_Bootstrap=1,CrossOriginTransactionTypes_FocusElement=2,CrossOriginTransactionTypes_State=3,CrossOriginTransactionTypes_GetElement=4,CrossOriginTransactionTypes_RestoreFocusInDeloser=5,CrossOriginTransactionTypes_Ping=6,CrossOriginDeloserItem=function(_DeloserItemBase){CrossOrigin_inherits(CrossOriginDeloserItem,_DeloserItemBase);var _super=CrossOrigin_createSuper(CrossOriginDeloserItem);function CrossOriginDeloserItem(tabster,deloser,trasactions){var _this;return CrossOrigin_classCallCheck(this,CrossOriginDeloserItem),(_this=_super.call(this))._deloser=void 0,_this._transactions=void 0,_this._deloser=deloser,_this._transactions=trasactions,_this}return CrossOrigin_createClass(CrossOriginDeloserItem,[{key:"belongsTo",value:function belongsTo(deloser){return deloser.deloserUId===this._deloser.deloserUId}},{key:"focusAvailable",value:async function focusAvailable(){var data=Object.assign({},this._deloser,{reset:!1});return this._transactions.beginTransaction(RestoreFocusInDeloserTransaction,data).then((function(value){return!!value}))}},{key:"resetFocus",value:async function resetFocus(){var data=Object.assign({},this._deloser,{reset:!0});return this._transactions.beginTransaction(RestoreFocusInDeloserTransaction,data).then((function(value){return!!value}))}}]),CrossOriginDeloserItem}(DeloserItemBase),CrossOriginDeloserHistoryByRoot=function(_DeloserHistoryByRoot){CrossOrigin_inherits(CrossOriginDeloserHistoryByRoot,_DeloserHistoryByRoot);var _super2=CrossOrigin_createSuper(CrossOriginDeloserHistoryByRoot);function CrossOriginDeloserHistoryByRoot(tabster,rootUId,transactions){var _this2;return CrossOrigin_classCallCheck(this,CrossOriginDeloserHistoryByRoot),(_this2=_super2.call(this,tabster,rootUId))._transactions=void 0,_this2._transactions=transactions,_this2}return CrossOrigin_createClass(CrossOriginDeloserHistoryByRoot,[{key:"unshift",value:function unshift(deloser){for(var item,i=0;i<this._history.length;i++)if(this._history[i].belongsTo(deloser)){item=this._history[i],this._history.splice(i,1);break}item||(item=new CrossOriginDeloserItem(this._tabster,deloser,this._transactions)),this._history.unshift(item),this._history.splice(10,this._history.length-10)}},{key:"focusAvailable",value:async function focusAvailable(){var _step,_iterator=CrossOrigin_createForOfIteratorHelper(this._history);try{for(_iterator.s();!(_step=_iterator.n()).done;){var i=_step.value;if(await i.focusAvailable())return!0}}catch(err){_iterator.e(err)}finally{_iterator.f()}return!1}},{key:"resetFocus",value:async function resetFocus(){var _step2,_iterator2=CrossOrigin_createForOfIteratorHelper(this._history);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var i=_step2.value;if(await i.resetFocus())return!0}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}return!1}}]),CrossOriginDeloserHistoryByRoot}(DeloserHistoryByRootBase),CrossOriginTransaction=function(){function CrossOriginTransaction(tabster,getOwner,knownTargets,value,timeout,sentTo,targetId,sendUp){var _this3=this;CrossOrigin_classCallCheck(this,CrossOriginTransaction),this.type=void 0,this.id=void 0,this.beginData=void 0,this.timeout=void 0,this.tabster=void 0,this.endData=void 0,this.owner=void 0,this.ownerId=void 0,this.sendUp=void 0,this._promise=void 0,this._resolve=void 0,this._reject=void 0,this._knownTargets=void 0,this._sentTo=void 0,this.targetId=void 0,this._inProgress={},this._isDone=!1,this._isSelfResponding=!1,this._sentCount=0,this.tabster=tabster,this.owner=getOwner,this.ownerId=getWindowUId(getOwner()),this.id=getUId(getOwner()),this.beginData=value,this._knownTargets=knownTargets,this._sentTo=sentTo||{[this.ownerId]:!0},this.targetId=targetId,this.sendUp=sendUp,this.timeout=timeout,this._promise=new(getPromise(getOwner))((function(resolve,reject){_this3._resolve=resolve,_this3._reject=reject}))}return CrossOrigin_createClass(CrossOriginTransaction,[{key:"getTargets",value:function getTargets(knownTargets){return"up"===this.targetId?this.sendUp?{up:{send:this.sendUp}}:null:this.targetId?knownTargets[this.targetId]?{[this.targetId]:{send:knownTargets[this.targetId].send}}:null:0===Object.keys(knownTargets).length&&this.sendUp?{up:{send:this.sendUp}}:Object.keys(knownTargets).length>0?knownTargets:null}},{key:"begin",value:function begin(selfResponse){var _this4=this,targets=this.getTargets(this._knownTargets),sentTo=Object.assign({},this._sentTo);if(targets)for(var _i=0,_Object$keys=Object.keys(targets);_i<_Object$keys.length;_i++){sentTo[_Object$keys[_i]]=!0}var data={transaction:this.id,type:this.type,isResponse:!1,timestamp:Date.now(),owner:this.ownerId,sentto:sentTo,timeout:this.timeout,beginData:this.beginData};if(this.targetId&&(data.target=this.targetId),selfResponse&&(this._isSelfResponding=!0,selfResponse(data).then((function(value){_this4._isSelfResponding=!1,void 0!==value&&(_this4.endData||(_this4.endData=value)),(_this4.endData||0===_this4._sentCount)&&_this4.end()}))),targets)for(var _i2=0,_Object$keys2=Object.keys(targets);_i2<_Object$keys2.length;_i2++){var _id2=_Object$keys2[_i2];_id2 in this._sentTo||this._send(targets[_id2].send,_id2,data)}return 0!==this._sentCount||this._isSelfResponding||this.end(),this._promise}},{key:"_send",value:function _send(send,targetId,data){void 0===this._inProgress[targetId]&&(this._inProgress[targetId]=!0,this._sentCount++,send(data))}},{key:"end",value:function end(error){this._isDone||(this._isDone=!0,void 0===this.endData&&error?this._reject&&this._reject(error):this._resolve&&this._resolve(this.endData))}},{key:"onResponse",value:function onResponse(data){var endData=data.endData;void 0===endData||this.endData||(this.endData=endData);var inProgressId="up"===data.target?"up":data.owner;this._inProgress[inProgressId]&&(this._inProgress[inProgressId]=!1,this._sentCount--,(this.endData||0===this._sentCount&&!this._isSelfResponding)&&this.end())}}]),CrossOriginTransaction}(),BootstrapTransaction=function(_CrossOriginTransacti){CrossOrigin_inherits(BootstrapTransaction,_CrossOriginTransacti);var _super3=CrossOrigin_createSuper(BootstrapTransaction);function BootstrapTransaction(){var _this5;CrossOrigin_classCallCheck(this,BootstrapTransaction);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];return(_this5=_super3.call.apply(_super3,[this].concat(args))).type=CrossOriginTransactionTypes_Bootstrap,_this5}return CrossOrigin_createClass(BootstrapTransaction,null,[{key:"shouldForward",value:function shouldForward(){return!1}},{key:"makeResponse",value:async function makeResponse(tabster){return{isNavigatingWithKeyboard:tabster.keyboardNavigation.isNavigatingWithKeyboard()}}}]),BootstrapTransaction}(CrossOriginTransaction),FocusElementTransaction=function(_CrossOriginTransacti2){CrossOrigin_inherits(FocusElementTransaction,_CrossOriginTransacti2);var _super4=CrossOrigin_createSuper(FocusElementTransaction);function FocusElementTransaction(){var _this6;CrossOrigin_classCallCheck(this,FocusElementTransaction);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];return(_this6=_super4.call.apply(_super4,[this].concat(args))).type=CrossOriginTransactionTypes_FocusElement,_this6}return CrossOrigin_createClass(FocusElementTransaction,null,[{key:"shouldSelfRespond",value:function shouldSelfRespond(){return!0}},{key:"shouldForward",value:function shouldForward(tabster,data,getOwner){var el=GetElementTransaction.findElement(tabster,getOwner,data.beginData);return!el||!tabster.focusable.isFocusable(el)}},{key:"makeResponse",value:async function makeResponse(tabster,data,getOwner,ownerId,transactions,forwardResult){var el=GetElementTransaction.findElement(tabster,getOwner,data.beginData);return!!el&&tabster.focusedElement.focus(el,!0)||!!await forwardResult}}]),FocusElementTransaction}(CrossOriginTransaction),CrossOriginStates_Focused=1,CrossOriginStates_Blurred=2,CrossOriginStates_Observed=3,CrossOriginStates_DeadWindow=4,CrossOriginStates_KeyboardNavigation=5,CrossOriginStates_Outline=6,StateTransaction=function(_CrossOriginTransacti3){CrossOrigin_inherits(StateTransaction,_CrossOriginTransacti3);var _super5=CrossOrigin_createSuper(StateTransaction);function StateTransaction(){var _this7;CrossOrigin_classCallCheck(this,StateTransaction);for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++)args[_key3]=arguments[_key3];return(_this7=_super5.call.apply(_super5,[this].concat(args))).type=CrossOriginTransactionTypes_State,_this7}return CrossOrigin_createClass(StateTransaction,null,[{key:"shouldSelfRespond",value:function shouldSelfRespond(tabster,data){return data.state!==CrossOriginStates_DeadWindow&&data.state!==CrossOriginStates_KeyboardNavigation}},{key:"makeResponse",value:async function makeResponse(tabster,data,getOwner,ownerId,transactions,forwardResult,isSelfResponse){var timestamp=data.timestamp,beginData=data.beginData;if(timestamp&&beginData)switch(beginData.state){case CrossOriginStates_Focused:return StateTransaction._makeFocusedResponse(tabster,timestamp,beginData,transactions,isSelfResponse);case CrossOriginStates_Blurred:return StateTransaction._makeBlurredResponse(tabster,timestamp,beginData,transactions.ctx);case CrossOriginStates_Observed:return StateTransaction._makeObservedResponse(tabster,beginData);case CrossOriginStates_DeadWindow:return StateTransaction._makeDeadWindowResponse(tabster,beginData,transactions,forwardResult);case CrossOriginStates_KeyboardNavigation:return StateTransaction._makeKeyboardNavigationResponse(tabster,transactions.ctx,beginData.isNavigatingWithKeyboard);case CrossOriginStates_Outline:return StateTransaction._makeOutlineResponse(tabster,transactions.ctx,beginData.outline)}return!0}},{key:"createElement",value:function createElement(tabster,beginData){return beginData.uid?new CrossOriginElement(tabster,beginData.uid,beginData.ownerUId,beginData.id,beginData.rootUId,beginData.observedName,beginData.observedDetails):null}},{key:"_makeFocusedResponse",value:async function _makeFocusedResponse(tabster,timestamp,beginData,transactions,isSelfResponse){var element=StateTransaction.createElement(tabster,beginData);if(beginData&&beginData.ownerUId&&element){if(transactions.ctx.focusOwner=beginData.ownerUId,transactions.ctx.focusOwnerTimestamp=timestamp,!isSelfResponse&&beginData.rootUId&&beginData.deloserUId){var deloserAPI=tabster.deloser;if(deloserAPI){var history=DeloserAPI.getHistory(deloserAPI),deloser={ownerUId:beginData.ownerUId,deloserUId:beginData.deloserUId,rootUId:beginData.rootUId};history.make(beginData.rootUId,(function(){return new CrossOriginDeloserHistoryByRoot(tabster,deloser.rootUId,transactions)})).unshift(deloser)}}CrossOriginFocusedElementState.setVal(tabster.crossOrigin.focusedElement,element,{isFocusedProgrammatically:beginData.isFocusedProgrammatically})}return!0}},{key:"_makeBlurredResponse",value:async function _makeBlurredResponse(tabster,timestamp,beginData,context){return beginData&&(beginData.ownerUId===context.focusOwner||beginData.force)&&(!context.focusOwnerTimestamp||context.focusOwnerTimestamp<timestamp)&&CrossOriginFocusedElementState.setVal(tabster.crossOrigin.focusedElement,void 0,{}),!0}},{key:"_makeObservedResponse",value:async function _makeObservedResponse(tabster,beginData){var name=beginData.observedName,element=StateTransaction.createElement(tabster,beginData);return name&&element&&CrossOriginObservedElementState.trigger(tabster.crossOrigin.observedElement,element,{names:[name],details:beginData.observedDetails}),!0}},{key:"_makeDeadWindowResponse",value:async function _makeDeadWindowResponse(tabster,beginData,transactions,forwardResult){var deadUId=beginData&&beginData.ownerUId;return deadUId&&transactions.removeTarget(deadUId),forwardResult.then((function(){if(deadUId===transactions.ctx.focusOwner){var deloserAPI=tabster.deloser;deloserAPI&&DeloserAPI.forceRestoreFocus(deloserAPI)}return!0}))}},{key:"_makeKeyboardNavigationResponse",value:async function _makeKeyboardNavigationResponse(tabster,context,isNavigatingWithKeyboard){return void 0!==isNavigatingWithKeyboard&&tabster.keyboardNavigation.isNavigatingWithKeyboard()!==isNavigatingWithKeyboard&&(context.ignoreKeyboardNavigationStateUpdate=!0,tabster.keyboardNavigation.setNavigatingWithKeyboard(isNavigatingWithKeyboard),context.ignoreKeyboardNavigationStateUpdate=!1),!0}},{key:"_makeOutlineResponse",value:async function _makeOutlineResponse(tabster,context,props){return context.origOutlineSetup&&context.origOutlineSetup.call(tabster.outline,props),!0}}]),StateTransaction}(CrossOriginTransaction),GetElementTransaction=function(_CrossOriginTransacti4){CrossOrigin_inherits(GetElementTransaction,_CrossOriginTransacti4);var _super6=CrossOrigin_createSuper(GetElementTransaction);function GetElementTransaction(){var _this8;CrossOrigin_classCallCheck(this,GetElementTransaction);for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++)args[_key4]=arguments[_key4];return(_this8=_super6.call.apply(_super6,[this].concat(args))).type=CrossOriginTransactionTypes_GetElement,_this8}return CrossOrigin_createClass(GetElementTransaction,null,[{key:"shouldSelfRespond",value:function shouldSelfRespond(){return!0}},{key:"findElement",value:function findElement(tabster,getOwner,data){var element;if(data&&(!data.ownerId||data.ownerId===getWindowUId(getOwner())))if(data.id){if((element=getOwner().document.getElementById(data.id))&&data.rootId){var ctx=RootAPI.getTabsterContext(tabster,element);if(!ctx||ctx.root.uid!==data.rootId)return null}}else if(data.uid){var ref=getInstanceContext(getOwner).elementByUId[data.uid];element=ref&&ref.get()}else data.observedName&&(element=tabster.observedElement.getElement(data.observedName));return element||null}},{key:"getElementData",value:function getElementData(tabster,element,getOwner,context,ownerUId){var deloser=DeloserAPI.getDeloser(tabster,element),ctx=RootAPI.getTabsterContext(tabster,element),tabsterOnElement=Instance_getTabsterOnElement(tabster,element),observed=tabsterOnElement&&tabsterOnElement.observed;return{uid:getElementUId(getOwner,element),ownerUId:ownerUId,id:element.id||void 0,rootUId:ctx?ctx.root.uid:void 0,deloserUId:deloser?getDeloserUID(getOwner,context,deloser):void 0,observedName:observed&&observed.names&&observed.names[0],observedDetails:observed&&observed.details}}},{key:"makeResponse",value:async function makeResponse(tabster,data,getOwner,ownerUId,transactions,forwardResult){var element,dataOut,beginData=data.beginData;if(void 0===beginData?element=tabster.focusedElement.getFocusedElement():beginData&&(element=GetElementTransaction.findElement(tabster,getOwner,beginData)||void 0),!element&&beginData){var name=beginData.observedName,_timeout=data.timeout,accessibility=beginData.accessibility;if(name&&_timeout){var e=await new(getPromise(getOwner))((function(resolve){var isWaitElementResolved=!1,isForwardResolved=!1,isResolved=!1;tabster.observedElement.waitElement(name,_timeout,accessibility).result.then((function(value){isWaitElementResolved=!0,isResolved||!value&&!isForwardResolved||(isResolved=!0,resolve({element:value}))})),forwardResult.then((function(value){isForwardResolved=!0,isResolved||!value&&!isWaitElementResolved||(isResolved=!0,resolve({crossOrigin:value}))}))}));e.element?element=e.element:e.crossOrigin&&(dataOut=e.crossOrigin)}}return element?GetElementTransaction.getElementData(tabster,element,getOwner,transactions.ctx,ownerUId):dataOut}}]),GetElementTransaction}(CrossOriginTransaction),RestoreFocusInDeloserTransaction=function(_CrossOriginTransacti5){CrossOrigin_inherits(RestoreFocusInDeloserTransaction,_CrossOriginTransacti5);var _super7=CrossOrigin_createSuper(RestoreFocusInDeloserTransaction);function RestoreFocusInDeloserTransaction(){var _this9;CrossOrigin_classCallCheck(this,RestoreFocusInDeloserTransaction);for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++)args[_key5]=arguments[_key5];return(_this9=_super7.call.apply(_super7,[this].concat(args))).type=CrossOriginTransactionTypes_RestoreFocusInDeloser,_this9}return CrossOrigin_createClass(RestoreFocusInDeloserTransaction,null,[{key:"makeResponse",value:async function makeResponse(tabster,data,getOwner,ownerId,transactions,forwardResult){var forwardRet=await forwardResult,begin=!forwardRet&&data.beginData,uid=begin&&begin.deloserUId,deloser=uid&&transactions.ctx.deloserByUId[uid],deloserAPI=tabster.deloser;if(begin&&deloser&&deloserAPI){var history=DeloserAPI.getHistory(deloserAPI);return begin.reset?history.resetFocus(deloser):history.focusAvailable(deloser)}return!!forwardRet}}]),RestoreFocusInDeloserTransaction}(CrossOriginTransaction),PingTransaction=function(_CrossOriginTransacti6){CrossOrigin_inherits(PingTransaction,_CrossOriginTransacti6);var _super8=CrossOrigin_createSuper(PingTransaction);function PingTransaction(){var _this10;CrossOrigin_classCallCheck(this,PingTransaction);for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++)args[_key6]=arguments[_key6];return(_this10=_super8.call.apply(_super8,[this].concat(args))).type=CrossOriginTransactionTypes_Ping,_this10}return CrossOrigin_createClass(PingTransaction,null,[{key:"shouldForward",value:function shouldForward(){return!1}},{key:"makeResponse",value:async function makeResponse(){return!0}}]),PingTransaction}(CrossOriginTransaction),CrossOriginTransactions=function(){function CrossOriginTransactions(tabster,getOwner,context){var _this11=this;CrossOrigin_classCallCheck(this,CrossOriginTransactions),this._owner=void 0,this._ownerUId=void 0,this._knownTargets={},this._transactions={},this._tabster=void 0,this._pingTimer=void 0,this._isDefaultSendUp=!1,this._deadPromise=void 0,this.isSetUp=!1,this.sendUp=void 0,this.ctx=void 0,this._onMessage=function(e){if(e.data.owner!==_this11._ownerUId&&_this11._tabster){var transactionId,data=e.data;if(data&&(transactionId=data.transaction)&&data.type&&data.timestamp&&data.owner&&data.sentto){var knownTarget=_this11._knownTargets[data.owner];if(!knownTarget&&e.send&&data.owner!==_this11._ownerUId&&(knownTarget=_this11._knownTargets[data.owner]={send:e.send}),knownTarget&&(knownTarget.last=Date.now()),data.isResponse){var t=_this11._transactions[transactionId];t&&t.transaction&&t.transaction.type===data.type&&t.transaction.onResponse(data)}else{var Transaction=_this11._getTransactionClass(data.type),_forwardResult=_this11.forwardTransaction(data);Transaction&&e.send&&Transaction.makeResponse(_this11._tabster,data,_this11._owner,_this11._ownerUId,_this11,_forwardResult,!1).then((function(r){var response={transaction:data.transaction,type:data.type,isResponse:!0,timestamp:Date.now(),owner:_this11._ownerUId,timeout:data.timeout,sentto:{},target:"up"===data.target?"up":data.owner,endData:r};e.send(response)}))}}}},this._onPageHide=function(){_this11._dead()},this._onBrowserMessage=function(e){if(e.source!==_this11._owner()){try{_this11._onMessage({data:JSON.parse(e.data),send:function(data){e.source&&e.source.postMessage&&e.source.postMessage(JSON.stringify(data),"*")}})}catch(e){}}},this._tabster=tabster,this._owner=getOwner,this._ownerUId=getWindowUId(getOwner()),this.ctx=context}return CrossOrigin_createClass(CrossOriginTransactions,[{key:"setup",value:function setup(sendUp){return this.isSetUp||(this.isSetUp=!0,this.setSendUp(sendUp),this._owner().addEventListener("pagehide",this._onPageHide),this._ping()),this._onMessage}},{key:"setSendUp",value:function setSendUp(sendUp){if(!this.isSetUp)throw new Error("CrossOrigin is not set up.");this.sendUp=sendUp||void 0;var owner=this._owner();return void 0===sendUp?this._isDefaultSendUp||owner.document&&(this._isDefaultSendUp=!0,owner.parent&&owner.parent!==owner&&owner.parent.postMessage&&(this.sendUp=function(data){owner.parent.postMessage(JSON.stringify(data),"*")}),owner.addEventListener("message",this._onBrowserMessage)):this._isDefaultSendUp&&(owner.removeEventListener("message",this._onBrowserMessage),this._isDefaultSendUp=!1),this._onMessage}},{key:"dispose",value:async function dispose(){var owner=this._owner();this._pingTimer&&(owner.clearTimeout(this._pingTimer),this._pingTimer=void 0),owner.removeEventListener("message",this._onBrowserMessage),owner.removeEventListener("pagehide",this._onPageHide),await this._dead(),delete this._deadPromise;for(var _i3=0,_Object$keys3=Object.keys(this._transactions);_i3<_Object$keys3.length;_i3++){var _id3=_Object$keys3[_i3],t=this._transactions[_id3];t.timer&&(owner.clearTimeout(t.timer),delete t.timer),t.transaction.end()}this._knownTargets={},delete this.sendUp}},{key:"beginTransaction",value:function beginTransaction(Transaction,value,timeout,sentTo,targetId,withReject){var _this12=this;if(!this._owner)return getPromise(this._owner).reject();var selfResponse,transaction=new Transaction(this._tabster,this._owner,this._knownTargets,value,timeout,sentTo,targetId,this.sendUp);return Transaction.shouldSelfRespond&&Transaction.shouldSelfRespond(this._tabster,value,this._owner,this._ownerUId)&&(selfResponse=function(data){return Transaction.makeResponse(_this12._tabster,data,_this12._owner,_this12._ownerUId,_this12,getPromise(_this12._owner).resolve(void 0),!0)}),this._beginTransaction(transaction,timeout,selfResponse,withReject)}},{key:"removeTarget",value:function removeTarget(uid){delete this._knownTargets[uid]}},{key:"_beginTransaction",value:function _beginTransaction(transaction,timeout,selfResponse,withReject){var _this13=this,owner=this._owner(),wrapper={transaction:transaction,timer:owner.setTimeout((function(){delete wrapper.timer,transaction.end("Cross origin transaction timed out.")}),1500+(timeout||0))};this._transactions[transaction.id]=wrapper;var ret=transaction.begin(selfResponse);return ret.catch((function(){})).finally((function(){wrapper.timer&&owner.clearTimeout(wrapper.timer),delete _this13._transactions[transaction.id]})),ret.then((function(value){return value}),withReject?void 0:function(){})}},{key:"forwardTransaction",value:function forwardTransaction(data){var owner=this._owner,targetId=data.target;if(targetId===this._ownerUId)return getPromise(owner).resolve();var Transaction=this._getTransactionClass(data.type);if(Transaction){if(void 0===Transaction.shouldForward||Transaction.shouldForward(this._tabster,data,owner,this._ownerUId)){var _sentTo=data.sentto;return"up"===targetId&&(targetId=void 0,_sentTo[this._ownerUId]=!0),delete _sentTo.up,this._beginTransaction(new Transaction(this._tabster,owner,this._knownTargets,data.beginData,data.timeout,_sentTo,targetId,this.sendUp),data.timeout)}return getPromise(owner).resolve()}return getPromise(owner).reject(`Unknown transaction type ${data.type}`)}},{key:"_getTransactionClass",value:function _getTransactionClass(type){switch(type){case CrossOriginTransactionTypes_Bootstrap:return BootstrapTransaction;case CrossOriginTransactionTypes_FocusElement:return FocusElementTransaction;case CrossOriginTransactionTypes_State:return StateTransaction;case CrossOriginTransactionTypes_GetElement:return GetElementTransaction;case CrossOriginTransactionTypes_RestoreFocusInDeloser:return RestoreFocusInDeloserTransaction;case CrossOriginTransactionTypes_Ping:return PingTransaction;default:return null}}},{key:"_dead",value:async function _dead(){this._deadPromise||this.ctx.focusOwner!==this._ownerUId||(this._deadPromise=this.beginTransaction(StateTransaction,{ownerUId:this._ownerUId,state:CrossOriginStates_DeadWindow})),this._deadPromise&&await this._deadPromise}},{key:"_ping",value:async function _ping(){var _this14=this;if(!this._pingTimer){var deadWindows,now=Date.now(),targets=Object.keys(this._knownTargets).filter((function(uid){return now-(_this14._knownTargets[uid].last||0)>3e3}));if(this.sendUp&&targets.push("up"),targets.length&&await getPromise(this._owner).all(targets.map((function(uid){return _this14.beginTransaction(PingTransaction,void 0,void 0,void 0,uid,!0).then((function(){return!0}),(function(){return"up"!==uid&&(deadWindows||(deadWindows={}),deadWindows[uid]=!0,delete _this14._knownTargets[uid]),!1}))}))),deadWindows)if(!await this.beginTransaction(GetElementTransaction,void 0)&&this.ctx.focusOwner&&this.ctx.focusOwner in deadWindows){await this.beginTransaction(StateTransaction,{ownerUId:this._ownerUId,state:CrossOriginStates_Blurred,force:!0});var deloserAPI=this._tabster.deloser;deloserAPI&&DeloserAPI.forceRestoreFocus(deloserAPI)}this._pingTimer=this._owner().setTimeout((function(){_this14._pingTimer=void 0,_this14._ping()}),3e3)}}}]),CrossOriginTransactions}(),CrossOriginElement=function(){function CrossOriginElement(tabster,uid,ownerId,id,rootId,observedName,observedDetails){CrossOrigin_classCallCheck(this,CrossOriginElement),this._tabster=void 0,this.uid=void 0,this.ownerId=void 0,this.id=void 0,this.rootId=void 0,this.observedName=void 0,this.observedDetails=void 0,this._tabster=tabster,this.uid=uid,this.ownerId=ownerId,this.id=id,this.rootId=rootId,this.observedName=observedName,this.observedDetails=observedDetails}return CrossOrigin_createClass(CrossOriginElement,[{key:"focus",value:function focus(noFocusedProgrammaticallyFlag,noAccessibleCheck){return this._tabster.crossOrigin.focusedElement.focus(this,noFocusedProgrammaticallyFlag,noAccessibleCheck)}}]),CrossOriginElement}(),CrossOriginFocusedElementState=function(_Subscribable){CrossOrigin_inherits(CrossOriginFocusedElementState,_Subscribable);var _super9=CrossOrigin_createSuper(CrossOriginFocusedElementState);function CrossOriginFocusedElementState(transactions){var _this15;return CrossOrigin_classCallCheck(this,CrossOriginFocusedElementState),(_this15=_super9.call(this))._transactions=void 0,_this15._transactions=transactions,_this15}return CrossOrigin_createClass(CrossOriginFocusedElementState,[{key:"focus",value:async function focus(element,noFocusedProgrammaticallyFlag,noAccessibleCheck){return this._focus({uid:element.uid,id:element.id,rootId:element.rootId,ownerId:element.ownerId,observedName:element.observedName},noFocusedProgrammaticallyFlag,noAccessibleCheck)}},{key:"focusById",value:async function focusById(elementId,rootId,noFocusedProgrammaticallyFlag,noAccessibleCheck){return this._focus({id:elementId,rootId:rootId},noFocusedProgrammaticallyFlag,noAccessibleCheck)}},{key:"focusByObservedName",value:async function focusByObservedName(observedName,timeout,rootId,noFocusedProgrammaticallyFlag,noAccessibleCheck){return this._focus({observedName:observedName,rootId:rootId},noFocusedProgrammaticallyFlag,noAccessibleCheck,timeout)}},{key:"_focus",value:async function _focus(elementData,noFocusedProgrammaticallyFlag,noAccessibleCheck,timeout){return this._transactions.beginTransaction(FocusElementTransaction,Object.assign({},elementData,{noFocusedProgrammaticallyFlag:noFocusedProgrammaticallyFlag,noAccessibleCheck:noAccessibleCheck}),timeout).then((function(value){return!!value}))}}],[{key:"setVal",value:function setVal(instance,val,details){instance.setVal(val,details)}}]),CrossOriginFocusedElementState}(Subscribable),CrossOriginObservedElementState=function(_Subscribable2){CrossOrigin_inherits(CrossOriginObservedElementState,_Subscribable2);var _super10=CrossOrigin_createSuper(CrossOriginObservedElementState);function CrossOriginObservedElementState(tabster,transactions){var _this16;return CrossOrigin_classCallCheck(this,CrossOriginObservedElementState),(_this16=_super10.call(this))._tabster=void 0,_this16._transactions=void 0,_this16._lastRequestFocusId=0,_this16._tabster=tabster,_this16._transactions=transactions,_this16}return CrossOrigin_createClass(CrossOriginObservedElementState,[{key:"getElement",value:async function getElement(observedName,accessibility){return this.waitElement(observedName,0,accessibility)}},{key:"waitElement",value:async function waitElement(observedName,timeout,accessibility){var _this17=this;return this._transactions.beginTransaction(GetElementTransaction,{observedName:observedName,accessibility:accessibility},timeout).then((function(value){return value?StateTransaction.createElement(_this17._tabster,value):null}))}},{key:"requestFocus",value:async function requestFocus(observedName,timeout){var _this18=this,requestId=++this._lastRequestFocusId;return this.waitElement(observedName,timeout,src_Types.hu.Focusable).then((function(element){return!(_this18._lastRequestFocusId!==requestId||!element)&&_this18._tabster.crossOrigin.focusedElement.focus(element,!0)}))}}],[{key:"trigger",value:function trigger(instance,element,details){instance.trigger(element,details)}}]),CrossOriginObservedElementState}(Subscribable),CrossOriginAPI=function(){function CrossOriginAPI(_tabster){var _this19=this;CrossOrigin_classCallCheck(this,CrossOriginAPI),this._tabster=void 0,this._initTimer=void 0,this._win=void 0,this._transactions=void 0,this._blurTimer=void 0,this._ctx=void 0,this.focusedElement=void 0,this.observedElement=void 0,this._init=function(){_this19._initTimer=void 0;var tabster=_this19._tabster;tabster.keyboardNavigation.subscribe(_this19._onKeyboardNavigationStateChanged),tabster.focusedElement.subscribe(_this19._onFocus),tabster.observedElement.subscribe(_this19._onObserved),_this19._ctx.origOutlineSetup||(_this19._ctx.origOutlineSetup=tabster.outline.setup,tabster.outline.setup=_this19._outlineSetup),_this19._transactions.beginTransaction(BootstrapTransaction,void 0,void 0,void 0,"up").then((function(data){data&&_this19._tabster.keyboardNavigation.isNavigatingWithKeyboard()!==data.isNavigatingWithKeyboard&&(_this19._ctx.ignoreKeyboardNavigationStateUpdate=!0,_this19._tabster.keyboardNavigation.setNavigatingWithKeyboard(data.isNavigatingWithKeyboard),_this19._ctx.ignoreKeyboardNavigationStateUpdate=!1)}))},this._onKeyboardNavigationStateChanged=function(value){_this19._ctx.ignoreKeyboardNavigationStateUpdate||_this19._transactions.beginTransaction(StateTransaction,{state:CrossOriginStates_KeyboardNavigation,ownerUId:getWindowUId(_this19._win()),isNavigatingWithKeyboard:value})},this._onFocus=function(element){var win=_this19._win(),ownerUId=getWindowUId(win);_this19._blurTimer&&(win.clearTimeout(_this19._blurTimer),_this19._blurTimer=void 0),element?_this19._transactions.beginTransaction(StateTransaction,Object.assign({},GetElementTransaction.getElementData(_this19._tabster,element,_this19._win,_this19._ctx,ownerUId),{state:CrossOriginStates_Focused})):_this19._blurTimer=win.setTimeout((function(){_this19._blurTimer=void 0,_this19._ctx.focusOwner&&_this19._ctx.focusOwner===ownerUId&&_this19._transactions.beginTransaction(GetElementTransaction,void 0).then((function(value){value||_this19._ctx.focusOwner!==ownerUId||_this19._transactions.beginTransaction(StateTransaction,{ownerUId:ownerUId,state:CrossOriginStates_Blurred,force:!1})}))}),0)},this._onObserved=function(element,details){var _details$names,d=GetElementTransaction.getElementData(_this19._tabster,element,_this19._win,_this19._ctx,getWindowUId(_this19._win()));d.state=CrossOriginStates_Observed,d.observedName=null===(_details$names=details.names)||void 0===_details$names?void 0:_details$names[0],d.observedDetails=details.details,_this19._transactions.beginTransaction(StateTransaction,d)},this._outlineSetup=function(props){_this19._transactions.beginTransaction(StateTransaction,{state:CrossOriginStates_Outline,ownerUId:getWindowUId(_this19._win()),outline:props})},this._tabster=_tabster,this._win=_tabster.getWindow,this._ctx={ignoreKeyboardNavigationStateUpdate:!1,deloserByUId:{}},this._transactions=new CrossOriginTransactions(_tabster,this._win,this._ctx),this.focusedElement=new CrossOriginFocusedElementState(this._transactions),this.observedElement=new CrossOriginObservedElementState(_tabster,this._transactions)}return CrossOrigin_createClass(CrossOriginAPI,[{key:"setup",value:function setup(sendUp){return this.isSetUp()?this._transactions.setSendUp(sendUp):(this._initTimer=this._win().setTimeout(this._init,0),this._transactions.setup(sendUp))}},{key:"isSetUp",value:function isSetUp(){return this._transactions.isSetUp}},{key:"dispose",value:function dispose(){var _tabster$observedElem;this._initTimer&&(this._win().clearTimeout(this._initTimer),this._initTimer=void 0);var tabster=this._tabster;tabster.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),tabster.focusedElement.unsubscribe(this._onFocus),null===(_tabster$observedElem=tabster.observedElement)||void 0===_tabster$observedElem||_tabster$observedElem.unsubscribe(this._onObserved),this._transactions.dispose(),this.focusedElement.dispose(),this.observedElement.dispose(),this._ctx.deloserByUId={}}}]),CrossOriginAPI}();function getDeloserUID(getWindow,context,deloser){var deloserElement=deloser.getElement();if(deloserElement){var _uid=getElementUId(getWindow,deloserElement);return context.deloserByUId[_uid]||(context.deloserByUId[_uid]=deloser),_uid}}function Focusable_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var _focusableSelector=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]"].join(", "),FocusableAPI=function(){function FocusableAPI(tabster,getWindow){!function Focusable_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FocusableAPI),this._tabster=void 0,this._win=void 0,this._tabster=tabster,this._win=getWindow}return function Focusable_createClass(Constructor,protoProps,staticProps){return protoProps&&Focusable_defineProperties(Constructor.prototype,protoProps),staticProps&&Focusable_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(FocusableAPI,[{key:"dispose",value:function dispose(){}},{key:"_getBody",value:function _getBody(){var last=this._tabster.focusedElement.getLastFocusedElement();return last&&last.ownerDocument?last.ownerDocument.body:this._win().document.body}},{key:"getProps",value:function getProps(element){var tabsterOnElement=Instance_getTabsterOnElement(this._tabster,element);return tabsterOnElement&&tabsterOnElement.focusable||{}}},{key:"isFocusable",value:function isFocusable(el,includeProgrammaticallyFocusable,noVisibleCheck,noAccessibleCheck){return!(!matchesSelector(el,_focusableSelector)||!includeProgrammaticallyFocusable&&-1===el.tabIndex)&&((noVisibleCheck||this.isVisible(el))&&(noAccessibleCheck||this.isAccessible(el)))}},{key:"isVisible",value:function isVisible(el){if(!el.ownerDocument)return!1;if(null===el.offsetParent&&el.ownerDocument.body!==el)return!1;var win=el.ownerDocument.defaultView;if(!win)return!1;var rect=el.ownerDocument.body.getBoundingClientRect();return(0!==rect.width||0!==rect.height)&&"hidden"!==win.getComputedStyle(el).visibility}},{key:"isAccessible",value:function isAccessible(el){for(var e=el;e;e=e.parentElement){var _tabsterOnElement$foc,tabsterOnElement=Instance_getTabsterOnElement(this._tabster,e);if(this._isHidden(e))return!1;if(!(null==tabsterOnElement||null===(_tabsterOnElement$foc=tabsterOnElement.focusable)||void 0===_tabsterOnElement$foc?void 0:_tabsterOnElement$foc.ignoreAriaDisabled)&&this._isDisabled(e))return!1}return!0}},{key:"_isDisabled",value:function _isDisabled(el){return el.hasAttribute("disabled")}},{key:"_isHidden",value:function _isHidden(el){var attrVal=el.getAttribute("aria-hidden");return!(!attrVal||"true"!==attrVal.toLowerCase())}},{key:"findFirst",value:function findFirst(options){return this.findElement(Object.assign({container:this._getBody()},options))}},{key:"findLast",value:function findLast(options){return this.findElement(Object.assign({container:this._getBody(),isBackward:!0},options))}},{key:"findNext",value:function findNext(options){return this.findElement(Object.assign({container:this._getBody()},options))}},{key:"findPrev",value:function findPrev(options){return this.findElement(Object.assign({container:this._getBody(),isBackward:!0},options))}},{key:"findDefault",value:function findDefault(options){var _this=this;return this.findElement(Object.assign({},options,{acceptCondition:function(el){return _this._tabster.focusable.isFocusable(el,options.includeProgrammaticallyFocusable)&&!!_this.getProps(el).isDefault}}))||null}},{key:"findAll",value:function findAll(options){return this._findElements(!0,options)||[]}},{key:"findElement",value:function findElement(options){var found=this._findElements(!1,options);return found?found[0]:found}},{key:"_findElements",value:function _findElements(findAll,options){var _this2=this,container=options.container,_options$currentEleme=options.currentElement,currentElement=void 0===_options$currentEleme?null:_options$currentEleme,includeProgrammaticallyFocusable=options.includeProgrammaticallyFocusable,ignoreUncontrolled=options.ignoreUncontrolled,ignoreAccessibiliy=options.ignoreAccessibiliy,isBackward=options.isBackward,onUncontrolled=options.onUncontrolled,onElement=options.onElement,elements=[],acceptCondition=options.acceptCondition;if(!container)return null;acceptCondition||(acceptCondition=function(el){return _this2._tabster.focusable.isFocusable(el,includeProgrammaticallyFocusable,ignoreAccessibiliy,ignoreAccessibiliy)});var acceptElementState={container:container,from:currentElement||container,isBackward:isBackward,acceptCondition:acceptCondition,includeProgrammaticallyFocusable:includeProgrammaticallyFocusable,ignoreUncontrolled:ignoreUncontrolled,ignoreAccessibiliy:ignoreAccessibiliy,cachedGrouppers:{}},walker=Utils_createElementTreeWalker(container.ownerDocument,container,(function(node){return _this2._acceptElement(node,acceptElementState)}));if(!walker)return null;var foundElement,prepareForNextElement=function(shouldContinueIfNotFound){var foundElement=acceptElementState.foundElement;return foundElement&&elements.push(foundElement),findAll?!(foundElement&&(acceptElementState.found=!1,delete acceptElementState.foundElement,delete acceptElementState.fromCtx,acceptElementState.from=foundElement,onElement&&!onElement(foundElement)))&&!(!foundElement&&!shouldContinueIfNotFound):!(!shouldContinueIfNotFound||foundElement)};if(currentElement)walker.currentNode=currentElement;else if(isBackward){var lastChild=getLastChild(container);if(!lastChild)return null;if(this._acceptElement(lastChild,acceptElementState)===NodeFilter.FILTER_ACCEPT&&!prepareForNextElement(!0))return elements;walker.currentNode=lastChild}do{foundElement=(isBackward?walker.previousNode():walker.nextNode())||void 0}while(prepareForNextElement());if(!findAll){var nextUncontrolled=acceptElementState.nextUncontrolled;if(nextUncontrolled)return onUncontrolled&&onUncontrolled(nextUncontrolled),foundElement?void 0:null}return elements.length?elements:null}},{key:"_acceptElement",value:function _acceptElement(element,state){var _fromCtx;if(state.found)return NodeFilter.FILTER_ACCEPT;var container=state.container;if(element===container)return NodeFilter.FILTER_SKIP;if(!container.contains(element))return NodeFilter.FILTER_REJECT;if(element.__tabsterDummyContainer)return NodeFilter.FILTER_REJECT;var lastToIgnore=state.lastToIgnore;if(lastToIgnore){if(lastToIgnore.contains(element))return NodeFilter.FILTER_REJECT;lastToIgnore=state.lastToIgnore=void 0}var result,ctx=state.currentCtx=RootAPI.getTabsterContext(this._tabster,element);if(!ctx)return NodeFilter.FILTER_SKIP;if(state.ignoreUncontrolled){if(shouldIgnoreFocus(element))return NodeFilter.FILTER_SKIP}else if(ctx.uncontrolled&&!state.nextUncontrolled&&this._tabster.focusable.isFocusable(element,void 0,!0,!0)&&!ctx.groupper&&!ctx.mover)return state.nextUncontrolled=ctx.uncontrolled,NodeFilter.FILTER_REJECT;if("IFRAME"===element.tagName||"WEBVIEW"===element.tagName)return state.found=!0,state.lastToIgnore=state.foundElement=element,NodeFilter.FILTER_ACCEPT;if(!state.ignoreAccessibiliy&&!this.isAccessible(element))return NodeFilter.FILTER_REJECT;var fromCtx=state.fromCtx;fromCtx||(fromCtx=state.fromCtx=RootAPI.getTabsterContext(this._tabster,state.from));var fromMover=null===(_fromCtx=fromCtx)||void 0===_fromCtx?void 0:_fromCtx.mover,groupper=ctx.groupper,mover=ctx.mover;if(groupper||mover||fromMover){var _groupper,_mover,groupperElement=null===(_groupper=groupper)||void 0===_groupper?void 0:_groupper.getElement(),fromMoverElement=null==fromMover?void 0:fromMover.getElement(),moverElement=null===(_mover=mover)||void 0===_mover?void 0:_mover.getElement();moverElement&&fromMoverElement&&container.contains(fromMoverElement)&&(!groupperElement||!mover||fromMoverElement.contains(groupperElement))&&(mover=fromMover,moverElement=fromMoverElement),!groupperElement||groupperElement!==container&&container.contains(groupperElement)||(groupper=void 0),moverElement&&!container.contains(moverElement)&&(mover=void 0),groupper&&mover&&(moverElement&&groupperElement&&!groupperElement.contains(moverElement)?mover=void 0:groupper=void 0),groupper&&(result=groupper.acceptElement(element,state)),mover&&(result=mover.acceptElement(element,state))}return void 0===result&&(result=state.acceptCondition(element)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP),result!==NodeFilter.FILTER_ACCEPT||state.found||(state.found=!0,state.foundElement=element),result}}]),FocusableAPI}(),Keys_Tab=9,Keys_Enter=13,Keys_Esc=27,Keys_PageUp=33,Keys_PageDown=34,Keys_End=35,Keys_Home=36,Keys_Left=37,Keys_Up=38,Keys_Right=39,Keys_Down=40;function FocusedElement_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},_get.apply(this,arguments)}function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=FocusedElement_getPrototypeOf(object)););return object}function FocusedElement_setPrototypeOf(o,p){return FocusedElement_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},FocusedElement_setPrototypeOf(o,p)}function FocusedElement_createSuper(Derived){var hasNativeReflectConstruct=function FocusedElement_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=FocusedElement_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=FocusedElement_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return FocusedElement_possibleConstructorReturn(this,result)}}function FocusedElement_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function FocusedElement_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function FocusedElement_getPrototypeOf(o){return FocusedElement_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},FocusedElement_getPrototypeOf(o)}var FocusedElementState=function(_Subscribable){!function FocusedElement_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&FocusedElement_setPrototypeOf(subClass,superClass)}(FocusedElementState,_Subscribable);var _super=FocusedElement_createSuper(FocusedElementState);function FocusedElementState(_tabster,getWindow){var _this;return function FocusedElement_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FocusedElementState),(_this=_super.call(this))._tabster=void 0,_this._initTimer=void 0,_this._win=void 0,_this._nextVal=void 0,_this._lastVal=void 0,_this._init=function(){_this._initTimer=void 0;var win=_this._win();win.document.addEventListener(keyborg_esm.PW,_this._onFocusIn,!0),win.document.addEventListener("focusout",_this._onFocusOut,!0),win.addEventListener("keydown",_this._onKeyDown,!0)},_this._onFocusIn=function(e){_this._setFocusedElement(e.target,e.details.relatedTarget,e.details.isFocusedProgrammatically)},_this._onFocusOut=function(e){_this._setFocusedElement(void 0,e.relatedTarget)},_this._validateFocusedElement=function(element){},_this._onKeyDown=function(e){if(e.keyCode===Keys_Tab&&!e.ctrlKey){var currentElement=_this.getVal();if(currentElement&&currentElement.ownerDocument&&"true"!==currentElement.contentEditable){var tabster=_this._tabster,controlTab=tabster.controlTab,ctx=RootAPI.getTabsterContext(tabster,currentElement);if(ctx&&(controlTab||ctx.groupper||ctx.mover)&&!ctx.ignoreKeydown[e.key]){var nextElement,isBackward=e.shiftKey,next=FocusedElementState.findNextTabbable(tabster,ctx,void 0,currentElement,isBackward);if(!(next&&(controlTab||next.element)||controlTab)){var _lastMoverOrGroupper$,lastMoverOrGroupper=null==next?void 0:next.lastMoverOrGroupper;if(lastMoverOrGroupper)return void(null===(_lastMoverOrGroupper$=lastMoverOrGroupper.dummyManager)||void 0===_lastMoverOrGroupper$||_lastMoverOrGroupper$.moveOutWithDefaultAction(isBackward))}if(next){var uncontrolled=next.uncontrolled;if(uncontrolled){var isGroupperFirst=ctx.isGroupperFirst,moveOutside=!1;if(void 0!==isGroupperFirst){var _ctx$groupper,_ctx$mover,moveFrom,groupper=null===(_ctx$groupper=ctx.groupper)||void 0===_ctx$groupper?void 0:_ctx$groupper.getElement(),mover=null===(_ctx$mover=ctx.mover)||void 0===_ctx$mover?void 0:_ctx$mover.getElement();isGroupperFirst&&groupper&&uncontrolled.contains(groupper)?moveFrom=groupper:!isGroupperFirst&&mover&&uncontrolled.contains(mover)&&(moveFrom=mover),moveFrom&&(uncontrolled=moveFrom,moveOutside=!0)}return void(uncontrolled&&ctx.uncontrolled!==uncontrolled&&DummyInputManager.moveWithPhantomDummy(_this._tabster,uncontrolled,moveOutside,isBackward))}if(nextElement=next.element,ctx.modalizer){var _nextElementCtx$modal,nextElementCtx=nextElement&&RootAPI.getTabsterContext(tabster,nextElement);if((!nextElementCtx||ctx.root.uid!==nextElementCtx.root.uid||null===(_nextElementCtx$modal=nextElementCtx.modalizer)||void 0===_nextElementCtx$modal||!_nextElementCtx$modal.isActive())&&ctx.modalizer.onBeforeFocusOut())return void e.preventDefault();if(!nextElement&&ctx.modalizer.isActive()&&ctx.modalizer.getProps().isTrapped){var findFn=isBackward?"findLast":"findFirst";nextElement=tabster.focusable[findFn]({container:ctx.modalizer.getElement()})}}}nextElement?"IFRAME"!==nextElement.tagName&&(e.preventDefault(),e.stopImmediatePropagation(),(0,keyborg_esm.ev)(nextElement)):ctx.root.moveOutWithDefaultAction(isBackward)}}}},_this._tabster=_tabster,_this._win=getWindow,_this._initTimer=getWindow().setTimeout(_this._init,0),_this}return function FocusedElement_createClass(Constructor,protoProps,staticProps){return protoProps&&FocusedElement_defineProperties(Constructor.prototype,protoProps),staticProps&&FocusedElement_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(FocusedElementState,[{key:"dispose",value:function dispose(){_get(FocusedElement_getPrototypeOf(FocusedElementState.prototype),"dispose",this).call(this);var win=this._win();this._initTimer&&(win.clearTimeout(this._initTimer),this._initTimer=void 0),win.document.removeEventListener(keyborg_esm.PW,this._onFocusIn,!0),win.document.removeEventListener("focusout",this._onFocusOut,!0),win.removeEventListener("keydown",this._onKeyDown,!0),delete FocusedElementState._lastResetElement,delete this._nextVal,delete this._lastVal}},{key:"getFocusedElement",value:function getFocusedElement(){return this.getVal()}},{key:"getLastFocusedElement",value:function getLastFocusedElement(){var _this$_lastVal,el=null===(_this$_lastVal=this._lastVal)||void 0===_this$_lastVal?void 0:_this$_lastVal.get();return(!el||el&&!documentContains(el.ownerDocument,el))&&(this._lastVal=el=void 0),el}},{key:"focus",value:function focus(element,noFocusedProgrammaticallyFlag,noAccessibleCheck){return!!this._tabster.focusable.isFocusable(element,noFocusedProgrammaticallyFlag,!1,noAccessibleCheck)&&(element.focus(),!0)}},{key:"focusDefault",value:function focusDefault(container){var el=this._tabster.focusable.findDefault({container:container});return!!el&&(this._tabster.focusedElement.focus(el),!0)}},{key:"_focusFirstOrLast",value:function _focusFirstOrLast(isFirst,props){var uncontrolled,toFocus,tabsterFocusable=this._tabster.focusable,container=props.container;if(container){var ctx=RootAPI.getTabsterContext(this._tabster,container);if(ctx){var next=FocusedElementState.findNextTabbable(this._tabster,ctx,container,void 0,!isFirst);if(next)for(toFocus=next.element,uncontrolled=next.uncontrolled;!toFocus&&uncontrolled;)(toFocus=tabsterFocusable.isFocusable(uncontrolled,!1,!0,!0)?uncontrolled:tabsterFocusable[isFirst?"findFirst":"findLast"]({container:uncontrolled,ignoreUncontrolled:!0,ignoreAccessibiliy:!0}))||(next=FocusedElementState.findNextTabbable(this._tabster,ctx,uncontrolled,void 0,!isFirst))&&(toFocus=next.element,uncontrolled=next.uncontrolled)}}return!toFocus||null!=container&&container.contains(toFocus)||(toFocus=void 0),!!toFocus&&(this.focus(toFocus,!1,!0),!0)}},{key:"focusFirst",value:function focusFirst(props){return this._focusFirstOrLast(!0,props)}},{key:"focusLast",value:function focusLast(props){return this._focusFirstOrLast(!1,props)}},{key:"resetFocus",value:function resetFocus(container){if(!this._tabster.focusable.isVisible(container))return!1;if(this._tabster.focusable.isFocusable(container,!0,!0,!0))this.focus(container);else{var prevTabIndex=container.getAttribute("tabindex"),prevAriaHidden=container.getAttribute("aria-hidden");container.tabIndex=-1,container.setAttribute("aria-hidden","true"),FocusedElementState._lastResetElement=new WeakHTMLElement(this._win,container),this.focus(container,!0,!0),this._setOrRemoveAttribute(container,"tabindex",prevTabIndex),this._setOrRemoveAttribute(container,"aria-hidden",prevAriaHidden)}return!0}},{key:"_setOrRemoveAttribute",value:function _setOrRemoveAttribute(element,name,value){null===value?element.removeAttribute(name):element.setAttribute(name,value)}},{key:"_setFocusedElement",value:function _setFocusedElement(element,relatedTarget,isFocusedProgrammatically){if(!this._tabster._noop){var details={relatedTarget:relatedTarget};if(element){var _FocusedElementState$,lastResetElement=null===(_FocusedElementState$=FocusedElementState._lastResetElement)||void 0===_FocusedElementState$?void 0:_FocusedElementState$.get();if(FocusedElementState._lastResetElement=void 0,lastResetElement===element||shouldIgnoreFocus(element))return;details.isFocusedProgrammatically=isFocusedProgrammatically}var nextVal=this._nextVal={element:element?new WeakHTMLElement(this._win,element):void 0,details:details};element&&element!==this._val&&this._validateFocusedElement(element),this._nextVal===nextVal&&this.setVal(element,details),this._nextVal=void 0}}},{key:"setVal",value:function setVal(val,details){_get(FocusedElement_getPrototypeOf(FocusedElementState.prototype),"setVal",this).call(this,val,details),val&&(this._lastVal=new WeakHTMLElement(this._win,val))}}],[{key:"forgetMemorized",value:function forgetMemorized(instance,parent){var _nextVal,_nextVal$element,wel=FocusedElementState._lastResetElement,el=wel&&wel.get();el&&parent.contains(el)&&delete FocusedElementState._lastResetElement,(el=null===(_nextVal=instance._nextVal)||void 0===_nextVal||null===(_nextVal$element=_nextVal.element)||void 0===_nextVal$element?void 0:_nextVal$element.get())&&parent.contains(el)&&delete instance._nextVal,(el=(wel=instance._lastVal)&&wel.get())&&parent.contains(el)&&delete instance._lastVal}},{key:"findNextTabbable",value:function findNextTabbable(tabster,ctx,container,currentElement,isBackward){var _next,_next$lastMoverOrGrou,actualContainer=container||ctx.root.getElement();if(!actualContainer)return null;var next=null,isTabbingTimer=FocusedElementState._isTabbingTimer,win=tabster.getWindow();isTabbingTimer&&win.clearTimeout(isTabbingTimer),FocusedElementState.isTabbing=!0,FocusedElementState._isTabbingTimer=win.setTimeout((function(){delete FocusedElementState._isTabbingTimer,FocusedElementState.isTabbing=!1}),0);var callFindNext=function(what){next=what.findNextTabbable(currentElement,isBackward)};if(ctx.groupper&&ctx.mover){var isGroupperFirst=ctx.isGroupperFirst;if(isGroupperFirst&&currentElement){var fromCtx=RootAPI.getTabsterContext(tabster,currentElement);(null==fromCtx?void 0:fromCtx.groupper)!==ctx.groupper&&(isGroupperFirst=!1)}callFindNext(isGroupperFirst?ctx.groupper:ctx.mover)}else if(ctx.groupper)callFindNext(ctx.groupper);else if(ctx.mover)callFindNext(ctx.mover);else{var uncontrolled,onUncontrolled=function(el){uncontrolled=el},nextElement=isBackward?tabster.focusable.findPrev({container:actualContainer,currentElement:currentElement,onUncontrolled:onUncontrolled}):tabster.focusable.findNext({container:actualContainer,currentElement:currentElement,onUncontrolled:onUncontrolled});next={element:uncontrolled?void 0:nextElement,uncontrolled:uncontrolled}}var lastMoverOrGroupperElement=null===(_next=next)||void 0===_next||null===(_next$lastMoverOrGrou=_next.lastMoverOrGroupper)||void 0===_next$lastMoverOrGrou?void 0:_next$lastMoverOrGrou.getElement();if(lastMoverOrGroupperElement){next=null;var adjacentElement=getAdjacentElement(lastMoverOrGroupperElement,isBackward);if(adjacentElement){var adjacentCtx=RootAPI.getTabsterContext(tabster,adjacentElement,{checkRtl:!0});if(adjacentCtx){var adjacentFrom=getAdjacentElement(adjacentElement,!isBackward);adjacentFrom&&(isBackward||(adjacentFrom=getLastChild(adjacentFrom)),next=FocusedElementState.findNextTabbable(tabster,adjacentCtx,actualContainer,adjacentFrom,isBackward))}}}return next}}]),FocusedElementState}(Subscribable);function Groupper_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Groupper_createClass(Constructor,protoProps,staticProps){return protoProps&&Groupper_defineProperties(Constructor.prototype,protoProps),staticProps&&Groupper_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function Groupper_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Groupper_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Groupper_setPrototypeOf(subClass,superClass)}function Groupper_setPrototypeOf(o,p){return Groupper_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},Groupper_setPrototypeOf(o,p)}function Groupper_createSuper(Derived){var hasNativeReflectConstruct=function Groupper_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=Groupper_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Groupper_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Groupper_possibleConstructorReturn(this,result)}}function Groupper_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return Groupper_assertThisInitialized(self)}function Groupper_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function Groupper_getPrototypeOf(o){return Groupper_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},Groupper_getPrototypeOf(o)}FocusedElementState._lastResetElement=void 0,FocusedElementState._isTabbingTimer=void 0,FocusedElementState.isTabbing=!1;var GroupperDummyManager=function(_DummyInputManager){Groupper_inherits(GroupperDummyManager,_DummyInputManager);var _super=Groupper_createSuper(GroupperDummyManager);function GroupperDummyManager(element,groupper,tabster){var _this;return Groupper_classCallCheck(this,GroupperDummyManager),(_this=_super.call(this,tabster,element,DummyInputManagerPriorities_Groupper,!0))._setHandlers((function(dummyInput,isBackward,relatedTarget){var container=element.get();if(container&&!dummyInput.shouldMoveOut){var input=dummyInput.input;if(input){var ctx=RootAPI.getTabsterContext(tabster,input);if(ctx){var next,_groupper$findNextTab,_FocusedElementState$;if(relatedTarget&&"true"===relatedTarget.contentEditable&&groupper.getProps().tabbability===src_Types.ti.LimitedTrapFocus&&container.contains(relatedTarget))next=null===(_groupper$findNextTab=groupper.findNextTabbable(relatedTarget,isBackward))||void 0===_groupper$findNextTab?void 0:_groupper$findNextTab.element;if(!next)next=null===(_FocusedElementState$=FocusedElementState.findNextTabbable(tabster,ctx,void 0,dummyInput.isOutside?input:getAdjacentElement(container,!isBackward),isBackward))||void 0===_FocusedElementState$?void 0:_FocusedElementState$.element;next&&tabster.focusedElement.focus(next)}}}})),_this}return Groupper_createClass(GroupperDummyManager)}(DummyInputManager),Groupper=function(_TabsterPart){Groupper_inherits(Groupper,_TabsterPart);var _super2=Groupper_createSuper(Groupper);function Groupper(tabster,element,onDispose,props){var _this2;return Groupper_classCallCheck(this,Groupper),(_this2=_super2.call(this,tabster,element,props))._shouldTabInside=!1,_this2._first=void 0,_this2._onDispose=void 0,_this2.dummyManager=void 0,_this2.makeTabbable(!1),_this2._onDispose=onDispose,tabster.controlTab||(_this2.dummyManager=new GroupperDummyManager(_this2._element,Groupper_assertThisInitialized(_this2),tabster)),_this2}return Groupper_createClass(Groupper,[{key:"dispose",value:function dispose(){var _this$dummyManager;this._onDispose(this);this._element.get();null===(_this$dummyManager=this.dummyManager)||void 0===_this$dummyManager||_this$dummyManager.dispose(),delete this._first}},{key:"findNextTabbable",value:function findNextTabbable(currentElement,isBackward){var groupperElement=this.getElement();if(!groupperElement)return null;var groupperFirstFocusable=this.getFirst(!0);if(!currentElement||!groupperElement.contains(currentElement))return{element:groupperFirstFocusable,lastMoverOrGroupper:groupperFirstFocusable?void 0:this};var uncontrolled,tabster=this._tabster,next=null,onUncontrolled=function(el){uncontrolled=el};return this._shouldTabInside&&groupperFirstFocusable&&(next=isBackward?tabster.focusable.findPrev({container:groupperElement,currentElement:currentElement,onUncontrolled:onUncontrolled}):tabster.focusable.findNext({container:groupperElement,currentElement:currentElement,onUncontrolled:onUncontrolled}),uncontrolled||next||this._props.tabbability!==src_Types.ti.LimitedTrapFocus||(next=isBackward?tabster.focusable.findLast({container:groupperElement}):tabster.focusable.findFirst({container:groupperElement}))),{element:next,uncontrolled:uncontrolled,lastMoverOrGroupper:next||uncontrolled?void 0:this}}},{key:"makeTabbable",value:function makeTabbable(isTabbable){this._shouldTabInside=isTabbable||!this._props.tabbability}},{key:"isActive",value:function isActive(noIfFirstIsFocused){for(var element=this.getElement()||null,isParentActive=!0,e=null==element?void 0:element.parentElement;e;e=e.parentElement){var _getTabsterOnElement,g=null===(_getTabsterOnElement=Instance_getTabsterOnElement(this._tabster,e))||void 0===_getTabsterOnElement?void 0:_getTabsterOnElement.groupper;g&&(g._shouldTabInside||(isParentActive=!1))}var ret=isParentActive?!!this._props.tabbability&&this._shouldTabInside:void 0;if(ret&&noIfFirstIsFocused){var focused=this._tabster.focusedElement.getFocusedElement();focused&&(ret=focused!==this.getFirst(!0))}return ret}},{key:"getFirst",value:function getFirst(orContainer){var first,groupperElement=this.getElement();if(groupperElement){var _this$_first;if(orContainer&&this._tabster.focusable.isFocusable(groupperElement))return groupperElement;(first=null===(_this$_first=this._first)||void 0===_this$_first?void 0:_this$_first.get())||(first=this._tabster.focusable.findFirst({container:groupperElement,ignoreUncontrolled:!0})||void 0)&&this.setFirst(first)}return first}},{key:"setFirst",value:function setFirst(element){element?this._first=new WeakHTMLElement(this._tabster.getWindow,element):delete this._first}},{key:"acceptElement",value:function acceptElement(element,state){var isActive,cachedGrouppers=state.cachedGrouppers,cached=cachedGrouppers[this.id];cached?isActive=cached.isActive:(isActive=this.isActive(!0),cached=cachedGrouppers[this.id]={isActive:isActive});var groupperElement=this.getElement();if(groupperElement&&!0!==isActive){if(groupperElement.contains(state.from))return NodeFilter.FILTER_REJECT;var first;if((first="first"in cached?cached.first:cached.first=this.getFirst(!0))&&state.acceptCondition(first))return state.lastToIgnore=groupperElement,first!==state.from?(state.found=!0,state.foundElement=first,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT}}}]),Groupper}(TabsterPart);var GroupperAPI=function(){function GroupperAPI(tabster,getWindow){var _this3=this;Groupper_classCallCheck(this,GroupperAPI),this._tabster=void 0,this._initTimer=void 0,this._win=void 0,this._current={},this._grouppers={},this._init=function(){_this3._initTimer=void 0;var win=_this3._win();_this3._tabster.focusedElement.subscribe(_this3._onFocus),win.document.addEventListener("mousedown",_this3._onMouseDown,!0),win.addEventListener("keydown",_this3._onKeyDown,!0)},this._onGroupperDispose=function(groupper){delete _this3._grouppers[groupper.id]},this._onFocus=function(element){element&&_this3._updateCurrent(element,!0,!0)},this._onMouseDown=function(e){e.target&&_this3._updateCurrent(e.target,!0)},this._onKeyDown=function(e){if(e.keyCode===Keys_Enter||e.keyCode===Keys_Esc){var element=_this3._tabster.focusedElement.getFocusedElement();if(element){var ctx=RootAPI.getTabsterContext(_this3._tabster,element),_groupper=null==ctx?void 0:ctx.groupper;if(ctx&&_groupper){var next,groupperElement=_groupper.getElement();if(e.keyCode===Keys_Enter){if(ctx.ignoreKeydown.Enter)return;(element===groupperElement||_groupper.getProps().delegated&&element===_groupper.getFirst(!1))&&(next=_this3._tabster.focusable.findNext({container:groupperElement,currentElement:element}))}else if(e.keyCode===Keys_Esc){if(ctx.ignoreKeydown.Escape)return;if(groupperElement&&groupperElement.contains(element))if(element!==groupperElement)next=_groupper.getFirst(!0);else{var _groupper2,parentElement=groupperElement.parentElement,parentCtx=parentElement?RootAPI.getTabsterContext(_this3._tabster,parentElement):void 0;next=null===(_groupper2=_groupper=null==parentCtx?void 0:parentCtx.groupper)||void 0===_groupper2?void 0:_groupper2.getFirst(!0)}_groupper&&_groupper.makeTabbable(!1)}next&&(e.preventDefault(),e.stopImmediatePropagation(),(0,keyborg_esm.ev)(next))}}}},this._tabster=tabster,this._win=getWindow,this._initTimer=getWindow().setTimeout(this._init,0)}return Groupper_createClass(GroupperAPI,[{key:"dispose",value:function dispose(){var _this4=this,win=this._win();this._current={},this._initTimer&&(win.clearTimeout(this._initTimer),this._initTimer=void 0),this._tabster.focusedElement.unsubscribe(this._onFocus),win.document.removeEventListener("mousedown",this._onMouseDown,!0),win.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._grouppers).forEach((function(groupperId){_this4._grouppers[groupperId]&&(_this4._grouppers[groupperId].dispose(),delete _this4._grouppers[groupperId])}))}},{key:"createGroupper",value:function createGroupper(element,props){var newGroupper=new Groupper(this._tabster,element,this._onGroupperDispose,props);return this._grouppers[newGroupper.id]=newGroupper,newGroupper}},{key:"forgetCurrentGrouppers",value:function forgetCurrentGrouppers(){this._current={}}},{key:"_updateCurrent",value:function _updateCurrent(element,includeTarget,checkTarget){for(var newIds={},isTarget=!0,el=element;el;el=el.parentElement){var _getTabsterOnElement2,_groupper3=null===(_getTabsterOnElement2=Instance_getTabsterOnElement(this._tabster,el))||void 0===_getTabsterOnElement2?void 0:_getTabsterOnElement2.groupper;if(_groupper3){if(newIds[_groupper3.id]=!0,isTarget&&checkTarget&&el!==element&&(isTarget=!1),includeTarget||!isTarget){this._current[_groupper3.id]=_groupper3;var isTabbable=_groupper3.isActive()||element!==el&&(!_groupper3.getProps().delegated||_groupper3.getFirst(!1)!==element);_groupper3.makeTabbable(isTabbable)}isTarget=!1}}for(var _i=0,_Object$keys=Object.keys(this._current);_i<_Object$keys.length;_i++){var id=_Object$keys[_i],_groupper4=this._current[id];_groupper4.id in newIds||(_groupper4.makeTabbable(!1),_groupper4.setFirst(void 0),delete this._current[id])}}}]),GroupperAPI}();function KeyboardNavigation_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function KeyboardNavigation_get(){return KeyboardNavigation_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=KeyboardNavigation_superPropBase(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(arguments.length<3?target:receiver):desc.value}},KeyboardNavigation_get.apply(this,arguments)}function KeyboardNavigation_superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=KeyboardNavigation_getPrototypeOf(object)););return object}function KeyboardNavigation_setPrototypeOf(o,p){return KeyboardNavigation_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},KeyboardNavigation_setPrototypeOf(o,p)}function KeyboardNavigation_createSuper(Derived){var hasNativeReflectConstruct=function KeyboardNavigation_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=KeyboardNavigation_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=KeyboardNavigation_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return KeyboardNavigation_possibleConstructorReturn(this,result)}}function KeyboardNavigation_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function KeyboardNavigation_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function KeyboardNavigation_getPrototypeOf(o){return KeyboardNavigation_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},KeyboardNavigation_getPrototypeOf(o)}var KeyboardNavigationState=function(_Subscribable){!function KeyboardNavigation_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&KeyboardNavigation_setPrototypeOf(subClass,superClass)}(KeyboardNavigationState,_Subscribable);var _super=KeyboardNavigation_createSuper(KeyboardNavigationState);function KeyboardNavigationState(getWindow){var _this;return function KeyboardNavigation_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,KeyboardNavigationState),(_this=_super.call(this))._keyborg=void 0,_this._onChange=function(isNavigatingWithKeyboard){_this.setVal(isNavigatingWithKeyboard,void 0)},_this._keyborg=(0,keyborg_esm.Vm)(getWindow()),_this._keyborg.subscribe(_this._onChange),_this}return function KeyboardNavigation_createClass(Constructor,protoProps,staticProps){return protoProps&&KeyboardNavigation_defineProperties(Constructor.prototype,protoProps),staticProps&&KeyboardNavigation_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(KeyboardNavigationState,[{key:"dispose",value:function dispose(){KeyboardNavigation_get(KeyboardNavigation_getPrototypeOf(KeyboardNavigationState.prototype),"dispose",this).call(this),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),(0,keyborg_esm.ub)(this._keyborg),delete this._keyborg)}},{key:"setNavigatingWithKeyboard",value:function setNavigatingWithKeyboard(isNavigatingWithKeyboard){var _this$_keyborg;null===(_this$_keyborg=this._keyborg)||void 0===_this$_keyborg||_this$_keyborg.setVal(isNavigatingWithKeyboard)}},{key:"isNavigatingWithKeyboard",value:function isNavigatingWithKeyboard(){var _this$_keyborg2;return!(null===(_this$_keyborg2=this._keyborg)||void 0===_this$_keyborg2||!_this$_keyborg2.isNavigatingWithKeyboard())}}]),KeyboardNavigationState}(Subscribable);function Modalizer_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Modalizer_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Modalizer_createClass(Constructor,protoProps,staticProps){return protoProps&&Modalizer_defineProperties(Constructor.prototype,protoProps),staticProps&&Modalizer_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function Modalizer_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Modalizer_setPrototypeOf(subClass,superClass)}function Modalizer_setPrototypeOf(o,p){return Modalizer_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},Modalizer_setPrototypeOf(o,p)}function Modalizer_createSuper(Derived){var hasNativeReflectConstruct=function Modalizer_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=Modalizer_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Modalizer_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Modalizer_possibleConstructorReturn(this,result)}}function Modalizer_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function Modalizer_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Modalizer_getPrototypeOf(o){return Modalizer_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},Modalizer_getPrototypeOf(o)}var _lastInternalId=0;var Modalizer=function(_TabsterPart){Modalizer_inherits(Modalizer,_TabsterPart);var _super=Modalizer_createSuper(Modalizer);function Modalizer(tabster,element,onDispose,moveOutWithDefault,onActiveChange,props){var _this;Modalizer_classCallCheck(this,Modalizer),(_this=_super.call(this,tabster,element,props)).internalId=void 0,_this.userId=void 0,_this._isActive=void 0,_this._isFocused=!1,_this._modalizerParent=void 0,_this._onDispose=void 0,_this._moveOutWithDefault=void 0,_this._onActiveChange=void 0,_this._onKeyDown=function(e){var keyCode=e.keyCode,isPrev=e.shiftKey;if(keyCode===Keys_Tab){var next,focusedElement=_this._tabster.focusedElement.getFocusedElement(),modalizerElement=_this.getElement(),findFn=isPrev?"findPrev":"findNext";focusedElement&&null!=modalizerElement&&modalizerElement.contains(focusedElement)&&(next=_this._tabster.focusable[findFn]({container:_this.getElement(),currentElement:focusedElement})),!next&&_this._props.isTrapped&&(findFn=isPrev?"findLast":"findFirst",next=_this._tabster.focusable[findFn]({container:_this.getElement()})),next?(e.preventDefault(),e.stopImmediatePropagation(),(0,keyborg_esm.ev)(next)):_this._props.isOthersAccessible||_this._moveOutWithDefault(isPrev)}},_this.internalId="ml"+ ++_lastInternalId,_this.userId=props.id,_this._onDispose=onDispose,_this._moveOutWithDefault=moveOutWithDefault,_this._onActiveChange=onActiveChange,tabster.controlTab||element.addEventListener("keydown",_this._onKeyDown);var parentElement=element.parentElement;return _this._modalizerParent=parentElement?new WeakHTMLElement(tabster.getWindow,parentElement):null,_this._setAccessibilityProps(),_this}return Modalizer_createClass(Modalizer,[{key:"setProps",value:function setProps(props){props.id&&(this.userId=props.id),this._props=Object.assign({},props),this._setAccessibilityProps()}},{key:"dispose",value:function dispose(){this._onDispose(this),this._remove()}},{key:"setActive",value:function setActive(active){var _this$_element$get,_this$_modalizerParen,_this$_modalizerParen2,_this2=this;if(active!==this._isActive){this._isActive=active,this._onActiveChange(active);var targetDocument=(null===(_this$_element$get=this._element.get())||void 0===_this$_element$get?void 0:_this$_element$get.ownerDocument)||(null===(_this$_modalizerParen=this._modalizerParent)||void 0===_this$_modalizerParen||null===(_this$_modalizerParen2=_this$_modalizerParen.get())||void 0===_this$_modalizerParen2?void 0:_this$_modalizerParen2.ownerDocument);targetDocument||(targetDocument=this._tabster.getWindow().document);var ariaHiddenWalker=Utils_createElementTreeWalker(targetDocument,targetDocument.body,(function(el){var _this2$_modalizerPare;if(_this2._props.isOthersAccessible)return NodeFilter.FILTER_REJECT;var modalizerRoot=_this2._element.get(),modalizerParent=null===(_this2$_modalizerPare=_this2._modalizerParent)||void 0===_this2$_modalizerPare?void 0:_this2$_modalizerPare.get(),isModalizerElement=modalizerRoot===el,containsModalizerRoot=!!el.contains(modalizerRoot||null),containsModalizerParent=!!el.contains(modalizerParent||null);if(isModalizerElement)return NodeFilter.FILTER_REJECT;if(containsModalizerRoot||containsModalizerParent)return NodeFilter.FILTER_SKIP;!function augmentAttribute(tabster,element,name,value){var entry=tabster.storageEntry(element,!0);if(!entry.aug){if(void 0===value)return;entry.aug={}}if(void 0===value){if(name in entry.aug){var origVal=entry.aug[name];delete entry.aug[name],null===origVal?element.removeAttribute(name):element.setAttribute(name,origVal)}}else name in entry.aug||(entry.aug[name]=element.getAttribute(name)),null===value?element.removeAttribute(name):element.setAttribute(name,value);void 0===value&&0===Object.keys(entry.aug).length&&(delete entry.aug,tabster.storageEntry(element,!1))}(_this2._tabster,el,"aria-hidden",active?"true":void 0);var modalizerRootOnPage=modalizerRoot!==(null==modalizerRoot?void 0:modalizerRoot.ownerDocument.body)&&(null==modalizerRoot?void 0:modalizerRoot.ownerDocument.body.contains(modalizerRoot));return modalizerParent!==(null==modalizerParent?void 0:modalizerParent.ownerDocument.body)&&(null==modalizerParent?void 0:modalizerParent.ownerDocument.body.contains(modalizerParent))||modalizerRootOnPage?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}));if(ariaHiddenWalker)for(;ariaHiddenWalker.nextNode(););}}},{key:"isActive",value:function isActive(){return!!this._isActive}},{key:"contains",value:function contains(element){var _this$getElement;return!(null===(_this$getElement=this.getElement())||void 0===_this$getElement||!_this$getElement.contains(element))}},{key:"onBeforeFocusOut",value:function onBeforeFocusOut(){var element=this.getElement();return!!element&&!triggerEvent(element,src_Types.LL,{eventName:"beforefocusout"})}},{key:"_remove",value:function _remove(){0}},{key:"_setAccessibilityProps",value:function _setAccessibilityProps(){}}]),Modalizer}(TabsterPart);var ModalizerAPIDummyManager=function(_DummyInputManager){Modalizer_inherits(ModalizerAPIDummyManager,_DummyInputManager);var _super2=Modalizer_createSuper(ModalizerAPIDummyManager);function ModalizerAPIDummyManager(modalizerAPI,tabster,element){var _this3;return Modalizer_classCallCheck(this,ModalizerAPIDummyManager),(_this3=_super2.call(this,tabster,element,DummyInputManagerPriorities_Modalizer))._modalizerAPI=void 0,_this3._tabster=void 0,_this3._onFocusDummyInput=function(dummyInput){var activeModalizer=_this3._modalizerAPI.activeModalizer;if(activeModalizer&&!dummyInput.shouldMoveOut){var findFn=dummyInput.isFirst?"findFirst":"findLast",next=_this3._tabster.focusable[findFn]({container:activeModalizer.getElement()});next&&_this3._tabster.focusedElement.focus(next)}},_this3._modalizerAPI=modalizerAPI,_this3._tabster=tabster,_this3.setTabbable(!1),_this3._setHandlers(_this3._onFocusDummyInput),_this3}return Modalizer_createClass(ModalizerAPIDummyManager)}(DummyInputManager),ModalizerAPI=function(){function ModalizerAPI(tabster){var _this4=this;if(Modalizer_classCallCheck(this,ModalizerAPI),this._tabster=void 0,this._win=void 0,this._initTimer=void 0,this._dummyManager=void 0,this.activeModalizer=void 0,this._focusOutTimer=void 0,this._restoreModalizerFocusTimer=void 0,this._modalizers=void 0,this._init=function(){_this4._initTimer=void 0,_this4._tabster.focusedElement.subscribe(_this4._onFocus)},this._onModalizerDispose=function(modalizer){modalizer.setActive(!1),_this4.activeModalizer===modalizer&&(_this4.activeModalizer=void 0),delete _this4._modalizers[modalizer.userId]},this._onFocus=function(focusedElement,details){var _this4$activeModalize,_this4$activeModalize3,ctx=focusedElement&&RootAPI.getTabsterContext(_this4._tabster,focusedElement);if(ctx&&focusedElement){_this4._focusOutTimer&&(_this4._win().clearTimeout(_this4._focusOutTimer),_this4._focusOutTimer=void 0);var _this4$activeModalize2,modalizer=null==ctx?void 0:ctx.modalizer;if(modalizer!==_this4.activeModalizer)if(!details.isFocusedProgrammatically||null!==(_this4$activeModalize=_this4.activeModalizer)&&void 0!==_this4$activeModalize&&_this4$activeModalize.contains(focusedElement)){if(null===(_this4$activeModalize3=_this4.activeModalizer)||void 0===_this4$activeModalize3||!_this4$activeModalize3.getProps().isOthersAccessible){var win=_this4._win();win.clearTimeout(_this4._restoreModalizerFocusTimer),_this4._restoreModalizerFocusTimer=win.setTimeout((function(){return _this4._restoreModalizerFocus(focusedElement)}),100)}}else null===(_this4$activeModalize2=_this4.activeModalizer)||void 0===_this4$activeModalize2||_this4$activeModalize2.setActive(!1),_this4.activeModalizer=void 0,modalizer&&(_this4.activeModalizer=modalizer,_this4.activeModalizer.setActive(!0))}},this._tabster=tabster,this._win=tabster.getWindow,this._initTimer=this._win().setTimeout(this._init,0),this._modalizers={},!tabster.controlTab){var documentBody=this._win().document.body;this._dummyManager=new ModalizerAPIDummyManager(this,tabster,new WeakHTMLElement(this._win,documentBody))}}return Modalizer_createClass(ModalizerAPI,[{key:"dispose",value:function dispose(){var _this$_dummyManager,_this5=this,win=this._win();null===(_this$_dummyManager=this._dummyManager)||void 0===_this$_dummyManager||_this$_dummyManager.dispose(),this._initTimer&&(win.clearTimeout(this._initTimer),this._initTimer=void 0),win.clearTimeout(this._restoreModalizerFocusTimer),win.clearTimeout(this._focusOutTimer),Object.keys(this._modalizers).forEach((function(modalizerId){_this5._modalizers[modalizerId]&&(_this5._modalizers[modalizerId].dispose(),delete _this5._modalizers[modalizerId])})),this._tabster.focusedElement.unsubscribe(this._onFocus),delete this.activeModalizer}},{key:"createModalizer",value:function createModalizer(element,props){var _this$_dummyManager$m,_this$_dummyManager2,_this$_dummyManager$s,_this$_dummyManager3,_this$_tabster$focuse;var modalizer=new Modalizer(this._tabster,element,this._onModalizerDispose,null!==(_this$_dummyManager$m=null===(_this$_dummyManager2=this._dummyManager)||void 0===_this$_dummyManager2?void 0:_this$_dummyManager2.moveOutWithDefaultAction)&&void 0!==_this$_dummyManager$m?_this$_dummyManager$m:function(){return null},null!==(_this$_dummyManager$s=null===(_this$_dummyManager3=this._dummyManager)||void 0===_this$_dummyManager3?void 0:_this$_dummyManager3.setTabbable)&&void 0!==_this$_dummyManager$s?_this$_dummyManager$s:function(){return null},props);if(this._modalizers[props.id]=modalizer,element.contains(null!==(_this$_tabster$focuse=this._tabster.focusedElement.getFocusedElement())&&void 0!==_this$_tabster$focuse?_this$_tabster$focuse:null)){var prevModalizer=this.activeModalizer;prevModalizer&&prevModalizer.setActive(!1),this.activeModalizer=modalizer,this.activeModalizer.setActive(!0)}return modalizer}},{key:"focus",value:function focus(elementFromModalizer,noFocusFirst,noFocusDefault){var ctx=RootAPI.getTabsterContext(this._tabster,elementFromModalizer);if(ctx&&ctx.modalizer){this.activeModalizer=ctx.modalizer,this.activeModalizer.setActive(!0);var props=this.activeModalizer.getProps(),modalizerRoot=this.activeModalizer.getElement();if(modalizerRoot){if(void 0===noFocusFirst&&(noFocusFirst=props.isNoFocusFirst),!noFocusFirst&&this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&this._tabster.focusedElement.focusFirst({container:modalizerRoot}))return!0;if(void 0===noFocusDefault&&(noFocusDefault=props.isNoFocusDefault),!noFocusDefault&&this._tabster.focusedElement.focusDefault(modalizerRoot))return!0;this._tabster.focusedElement.resetFocus(modalizerRoot)}}else 0;return!1}},{key:"updateModalizer",value:function updateModalizer(modalizer,removed){removed&&(modalizer.isActive()&&modalizer.setActive(!1),delete this._modalizers[modalizer.userId],this.activeModalizer===modalizer&&(this.activeModalizer=void 0))}},{key:"_restoreModalizerFocus",value:function _restoreModalizerFocus(outsideElement){if(null!=outsideElement&&outsideElement.ownerDocument&&this.activeModalizer){var toFocus=this._tabster.focusable.findFirst({container:this.activeModalizer.getElement()});if(toFocus){if(outsideElement.compareDocumentPosition(toFocus)&document.DOCUMENT_POSITION_PRECEDING&&!(toFocus=this._tabster.focusable.findLast({container:outsideElement.ownerDocument.body})))throw new Error("Something went wrong.");this._tabster.focusedElement.focus(toFocus)}else outsideElement.blur()}}}]),ModalizerAPI}();function Mover_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function Mover_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return Mover_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mover_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function Mover_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function Mover_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Mover_createClass(Constructor,protoProps,staticProps){return protoProps&&Mover_defineProperties(Constructor.prototype,protoProps),staticProps&&Mover_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function Mover_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Mover_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&Mover_setPrototypeOf(subClass,superClass)}function Mover_setPrototypeOf(o,p){return Mover_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},Mover_setPrototypeOf(o,p)}function Mover_createSuper(Derived){var hasNativeReflectConstruct=function Mover_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=Mover_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=Mover_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return Mover_possibleConstructorReturn(this,result)}}function Mover_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function Mover_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function Mover_getPrototypeOf(o){return Mover_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},Mover_getPrototypeOf(o)}var _inputSelector=["input","textarea","*[contenteditable]"].join(", "),MoverDummyManager=function(_DummyInputManager){Mover_inherits(MoverDummyManager,_DummyInputManager);var _super=Mover_createSuper(MoverDummyManager);function MoverDummyManager(element,tabster,getMemorized){var _this;return Mover_classCallCheck(this,MoverDummyManager),(_this=_super.call(this,tabster,element,DummyInputManagerPriorities_Mover))._tabster=void 0,_this._getMemorized=void 0,_this._onFocusDummyInput=function(dummyInput){var container=_this._element.get(),input=dummyInput.input;if(container&&!dummyInput.shouldMoveOut&&input){var _this$_getMemorized,toFocus,_FocusedElementState$,ctx=RootAPI.getTabsterContext(_this._tabster,container);if(ctx)toFocus=null===(_FocusedElementState$=FocusedElementState.findNextTabbable(_this._tabster,ctx,void 0,input,!dummyInput.isFirst))||void 0===_FocusedElementState$?void 0:_FocusedElementState$.element;var memorized=null===(_this$_getMemorized=_this._getMemorized())||void 0===_this$_getMemorized?void 0:_this$_getMemorized.get();memorized&&(toFocus=memorized),toFocus&&(0,keyborg_esm.ev)(toFocus)}},_this._tabster=tabster,_this._getMemorized=getMemorized,_this._setHandlers(_this._onFocusDummyInput),_this}return Mover_createClass(MoverDummyManager)}(DummyInputManager),Mover=function(_TabsterPart){Mover_inherits(Mover,_TabsterPart);var _super2=Mover_createSuper(Mover);function Mover(tabster,element,onDispose,props){var _this2;Mover_classCallCheck(this,Mover),(_this2=_super2.call(this,tabster,element,props))._unobserve=void 0,_this2._intersectionObserver=void 0,_this2._setCurrentTimer=void 0,_this2._current=void 0,_this2._prevCurrent=void 0,_this2._visible={},_this2._fullyVisible=void 0,_this2._win=void 0,_this2._onDispose=void 0,_this2._allElements=void 0,_this2._updateQueue=void 0,_this2._updateTimer=void 0,_this2.dummyManager=void 0,_this2._onIntersection=function(entries){var _step,_iterator=Mover_createForOfIteratorHelper(entries);try{for(_iterator.s();!(_step=_iterator.n()).done;){var entry=_step.value,el=entry.target,id=getElementUId(_this2._win,el),newVisibility=void 0,fullyVisible=_this2._fullyVisible;if(entry.intersectionRatio>=.25&&(newVisibility=entry.intersectionRatio>=.75?src_Types.EL.Visible:src_Types.EL.PartiallyVisible)===src_Types.EL.Visible&&(fullyVisible=id),_this2._visible[id]!==newVisibility){void 0===newVisibility?(delete _this2._visible[id],fullyVisible===id&&delete _this2._fullyVisible):(_this2._visible[id]=newVisibility,_this2._fullyVisible=fullyVisible);var state=_this2.getState(el);state&&triggerEvent(el,src_Types.Km,state)}}}catch(err){_iterator.e(err)}finally{_iterator.f()}},_this2._win=tabster.getWindow,(_this2._props.trackState||_this2._props.visibilityAware)&&(_this2._intersectionObserver=new IntersectionObserver(_this2._onIntersection,{threshold:[0,.25,.5,.75,1]}),_this2._observeState()),_this2._onDispose=onDispose;return tabster.controlTab||(_this2.dummyManager=new MoverDummyManager(_this2._element,tabster,(function(){return props.memorizeCurrent?_this2._current:void 0}))),_this2}return Mover_createClass(Mover,[{key:"dispose",value:function dispose(){var _this$dummyManager;this._onDispose(this),this._intersectionObserver&&(this._intersectionObserver.disconnect(),delete this._intersectionObserver),delete this._current,delete this._fullyVisible,delete this._allElements,delete this._updateQueue,this._unobserve&&(this._unobserve(),delete this._unobserve);var win=this._win();this._setCurrentTimer&&(win.clearTimeout(this._setCurrentTimer),delete this._setCurrentTimer),this._updateTimer&&(win.clearTimeout(this._updateTimer),delete this._updateTimer),null===(_this$dummyManager=this.dummyManager)||void 0===_this$dummyManager||_this$dummyManager.dispose()}},{key:"setCurrent",value:function setCurrent(element){var _this3=this;this._current=element?new WeakHTMLElement(this._win,element):void 0,!this._props.trackState&&!this._props.visibilityAware||this._setCurrentTimer||(this._setCurrentTimer=this._win().setTimeout((function(){delete _this3._setCurrentTimer;var changed=[];_this3._current!==_this3._prevCurrent&&(changed.push(_this3._current),changed.push(_this3._prevCurrent),_this3._prevCurrent=_this3._current);for(var _i=0,_changed=changed;_i<_changed.length;_i++){var _this3$_allElements,weak=_changed[_i],el=null==weak?void 0:weak.get();if(el&&(null===(_this3$_allElements=_this3._allElements)||void 0===_this3$_allElements?void 0:_this3$_allElements.get(el))===_this3){var props=_this3._props;if(el&&(void 0!==props.visibilityAware||props.trackState)){var state=_this3.getState(el);state&&triggerEvent(el,src_Types.Km,state)}}}})))}},{key:"getCurrent",value:function getCurrent(){var _this$_current;return(null===(_this$_current=this._current)||void 0===_this$_current?void 0:_this$_current.get())||null}},{key:"findNextTabbable",value:function findNextTabbable(currentElement,isBackward){var _tabsterDummyContain,container=this.getElement(),currentIsDummy=container&&(null==currentElement||null===(_tabsterDummyContain=currentElement.__tabsterDummyContainer)||void 0===_tabsterDummyContain?void 0:_tabsterDummyContain.get())===container;if(!container)return null;var uncontrolled,focusable=this._tabster.focusable,next=null,onUncontrolled=function(el){uncontrolled=el};return(this._props.tabbable||currentIsDummy||currentElement&&!container.contains(currentElement))&&(next=isBackward?focusable.findPrev({currentElement:currentElement,container:container,onUncontrolled:onUncontrolled}):focusable.findNext({currentElement:currentElement,container:container,onUncontrolled:onUncontrolled})),{element:next,uncontrolled:uncontrolled,lastMoverOrGroupper:next||uncontrolled?void 0:this}}},{key:"acceptElement",value:function acceptElement(element,state){var _tabsterDummyContain2,_state$currentCtx,_this4=this;if(!FocusedElementState.isTabbing)return null!==(_state$currentCtx=state.currentCtx)&&void 0!==_state$currentCtx&&_state$currentCtx.isExcludedFromMover?NodeFilter.FILTER_REJECT:void 0;var _this$_props=this._props,memorizeCurrent=_this$_props.memorizeCurrent,visibilityAware=_this$_props.visibilityAware,moverElement=this.getElement();if(moverElement&&(memorizeCurrent||visibilityAware)&&(!moverElement.contains(state.from)||(null===(_tabsterDummyContain2=state.from.__tabsterDummyContainer)||void 0===_tabsterDummyContain2?void 0:_tabsterDummyContain2.get())===moverElement)){if(memorizeCurrent){var _this$_current2,current=null===(_this$_current2=this._current)||void 0===_this$_current2?void 0:_this$_current2.get();if(current&&state.acceptCondition(current))return state.found=!0,state.foundElement=current,state.lastToIgnore=moverElement,NodeFilter.FILTER_ACCEPT}if(visibilityAware){var found=this._tabster.focusable.findElement({container:moverElement,ignoreUncontrolled:!0,isBackward:state.isBackward,acceptCondition:function(el){var _this4$_allElements,id=getElementUId(_this4._win,el),visibility=_this4._visible[id];return moverElement!==el&&!(null===(_this4$_allElements=_this4._allElements)||void 0===_this4$_allElements||!_this4$_allElements.get(el))&&state.acceptCondition(el)&&(visibility===src_Types.EL.Visible||visibility===src_Types.EL.PartiallyVisible&&(visibilityAware===src_Types.EL.PartiallyVisible||!_this4._fullyVisible))}});if(found)return state.found=!0,state.foundElement=found,state.lastToIgnore=moverElement,NodeFilter.FILTER_ACCEPT}}}},{key:"_observeState",value:function _observeState(){var _this5=this,element=this.getElement();if(!this._unobserve&&element&&"undefined"!=typeof MutationObserver){var win=this._win(),allElements=this._allElements=new WeakMap,tabsterFocusable=this._tabster.focusable,updateQueue=this._updateQueue=[],observer=new MutationObserver((function(mutations){var _step2,_iterator2=Mover_createForOfIteratorHelper(mutations);try{for(_iterator2.s();!(_step2=_iterator2.n()).done;){var mutation=_step2.value,target=mutation.target,removed=mutation.removedNodes,added=mutation.addedNodes;if("attributes"===mutation.type)"tabindex"===mutation.attributeName&&updateQueue.push({element:target,type:2});else{for(var i=0;i<removed.length;i++)updateQueue.push({element:removed[i],type:3});for(var _i2=0;_i2<added.length;_i2++)updateQueue.push({element:added[_i2],type:1})}}}catch(err){_iterator2.e(err)}finally{_iterator2.f()}requestUpdate()})),setElement=function(element,remove){var _this5$_intersectionO,_this5$_intersectionO2,current=allElements.get(element);current&&remove&&(null===(_this5$_intersectionO=_this5._intersectionObserver)||void 0===_this5$_intersectionO||_this5$_intersectionO.unobserve(element),allElements.delete(element));current||remove||(allElements.set(element,_this5),null===(_this5$_intersectionO2=_this5._intersectionObserver)||void 0===_this5$_intersectionO2||_this5$_intersectionO2.observe(element))},updateElement=function(element){var isFocusable=tabsterFocusable.isFocusable(element);allElements.get(element)?isFocusable||setElement(element,!0):isFocusable&&setElement(element)},addNewElements=function(element){var mover=getMoverGroupper(element).mover;if(mover&&mover!==_this5){if(mover.getElement()!==element||!tabsterFocusable.isFocusable(element))return;setElement(element)}var walker=Utils_createElementTreeWalker(win.document,element,(function(node){var _getMoverGroupper2=getMoverGroupper(node),mover=_getMoverGroupper2.mover,groupper=_getMoverGroupper2.groupper;if(mover&&mover!==_this5)return NodeFilter.FILTER_REJECT;var groupperFirstFocusable=null==groupper?void 0:groupper.getFirst(!0);return groupper&&groupper.getElement()!==node&&groupperFirstFocusable&&groupperFirstFocusable!==node?NodeFilter.FILTER_REJECT:(tabsterFocusable.isFocusable(node)&&setElement(node),NodeFilter.FILTER_SKIP)}));if(walker)for(walker.currentNode=element;walker.nextNode(););},removeWalk=function(element){allElements.get(element)&&setElement(element,!0);for(var el=element.firstElementChild;el;el=el.nextElementSibling)removeWalk(el)},requestUpdate=function(){!_this5._updateTimer&&updateQueue.length&&(_this5._updateTimer=win.setTimeout((function(){delete _this5._updateTimer;var _step3,_iterator3=Mover_createForOfIteratorHelper(updateQueue);try{for(_iterator3.s();!(_step3=_iterator3.n()).done;){var _ref=_step3.value,_element=_ref.element;switch(_ref.type){case 2:updateElement(_element);break;case 1:addNewElements(_element);break;case 3:removeWalk(_element)}}}catch(err){_iterator3.e(err)}finally{_iterator3.f()}updateQueue=_this5._updateQueue=[]}),0))},getMoverGroupper=function(element){for(var ret={},el=element;el;el=el.parentElement){var toe=Instance_getTabsterOnElement(_this5._tabster,el);if(toe&&(toe.groupper&&!ret.groupper&&(ret.groupper=toe.groupper),toe.mover)){ret.mover=toe.mover;break}}return ret};updateQueue.push({element:element,type:1}),requestUpdate(),observer.observe(element,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["tabindex"]}),this._unobserve=function(){observer.disconnect()}}}},{key:"getState",value:function getState(element){var id=getElementUId(this._win,element);if(id in this._visible){var visibility=this._visible[id]||src_Types.EL.Invisible;return{isCurrent:this._current?this._current.get()===element:void 0,visibility:visibility}}}}]),Mover}(TabsterPart);var MoverAPI=function(){function MoverAPI(_tabster,getWindow){var _this6=this;Mover_classCallCheck(this,MoverAPI),this._tabster=void 0,this._initTimer=void 0,this._win=void 0,this._movers=void 0,this._ignoredInputTimer=void 0,this._ignoredInputResolve=void 0,this._init=function(){_this6._initTimer=void 0,_this6._win().addEventListener("keydown",_this6._onKeyDown,!0)},this._onMoverDispose=function(mover){delete _this6._movers[mover.id]},this._onFocus=function(e){for(var el=e;el;el=el.parentElement){var _getTabsterOnElement,_mover=null===(_getTabsterOnElement=Instance_getTabsterOnElement(_this6._tabster,el))||void 0===_getTabsterOnElement?void 0:_getTabsterOnElement.mover;if(_mover){_mover.setCurrent(e);break}}},this._onKeyDown=async function(e){var _this6$_ignoredInputR;_this6._ignoredInputTimer&&(_this6._win().clearTimeout(_this6._ignoredInputTimer),delete _this6._ignoredInputTimer),null===(_this6$_ignoredInputR=_this6._ignoredInputResolve)||void 0===_this6$_ignoredInputR||_this6$_ignoredInputR.call(_this6,!1);var keyCode=e.keyCode;switch(keyCode){case Keys_Down:case Keys_Right:case Keys_Up:case Keys_Left:case Keys_PageDown:case Keys_PageUp:case Keys_Home:case Keys_End:break;default:return}var tabster=_this6._tabster,focused=tabster.focusedElement.getFocusedElement();if(focused&&!await _this6._isIgnoredInput(focused,keyCode)){var ctx=RootAPI.getTabsterContext(tabster,focused,{checkRtl:!0});if(ctx&&ctx.mover&&!ctx.isExcludedFromMover&&!(ctx.isGroupperFirst&&ctx.groupper&&ctx.groupper.isActive(!0))){var mover=ctx.mover,container=mover.getElement();if(container){var next,focusedElementRect,focusable=tabster.focusable,moverProps=mover.getProps(),direction=moverProps.direction||src_Types.bM.Both,isBoth=direction===src_Types.bM.Both,isVertical=isBoth||direction===src_Types.bM.Vertical,isHorizontal=isBoth||direction===src_Types.bM.Horizontal,isGrid=direction===src_Types.bM.Grid,isCyclic=moverProps.cyclic,focusedElementX1=0,focusedElementX2=0;if(isGrid&&(focusedElementRect=focused.getBoundingClientRect(),focusedElementX1=Math.ceil(focusedElementRect.left),focusedElementX2=Math.floor(focusedElementRect.right)),!moverProps.disableHomeEndKeys||keyCode!==Keys_Home&&keyCode!==Keys_End){if(ctx.isRtl&&(keyCode===Keys_Right?keyCode=Keys_Left:keyCode===Keys_Left&&(keyCode=Keys_Right)),keyCode===Keys_Down&&isVertical||keyCode===Keys_Right&&(isHorizontal||isGrid))if((next=focusable.findNext({currentElement:focused,container:container}))&&isGrid)focusedElementX2>Math.ceil(next.getBoundingClientRect().left)&&(next=void 0);else!next&&isCyclic&&(next=focusable.findFirst({container:container}));else if(keyCode===Keys_Up&&isVertical||keyCode===Keys_Left&&(isHorizontal||isGrid)){if((next=focusable.findPrev({currentElement:focused,container:container}))&&isGrid)Math.floor(next.getBoundingClientRect().right)>focusedElementX1&&(next=void 0);else!next&&isCyclic&&(next=focusable.findLast({container:container}))}else if(keyCode===Keys_Home)next=focusable.findFirst({container:container});else if(keyCode===Keys_End)next=focusable.findLast({container:container});else if(keyCode===Keys_PageUp){for(var prevElement=focusable.findPrev({currentElement:focused,container:container}),pageUpElement=null;prevElement;)pageUpElement=prevElement,prevElement=isElementVerticallyVisibleInContainer(_this6._win,prevElement)?focusable.findPrev({currentElement:prevElement,container:container}):null;(next=pageUpElement)&&scrollIntoView(_this6._win,next,!1)}else if(keyCode===Keys_PageDown){for(var nextElement=focusable.findNext({currentElement:focused,container:container}),pageDownElement=null;nextElement;)pageDownElement=nextElement,nextElement=isElementVerticallyVisibleInContainer(_this6._win,nextElement)?focusable.findNext({currentElement:nextElement,container:container}):null;(next=pageDownElement)&&scrollIntoView(_this6._win,next,!0)}else if(isGrid){var targetElement,lastDistance,isBackward=keyCode===Keys_Up,ax1=focusedElementX1,ay1=Math.ceil(focusedElementRect.top),ax2=focusedElementX2,ay2=Math.floor(focusedElementRect.bottom),lastIntersection=0;focusable.findAll({container:container,currentElement:focused,isBackward:isBackward,onElement:function(el){var rect=el.getBoundingClientRect(),bx1=Math.ceil(rect.left),by1=Math.ceil(rect.top),bx2=Math.floor(rect.right),by2=Math.floor(rect.bottom);if(isBackward&&ay1<by2||!isBackward&&ay2>by1)return!0;var xIntersectionWidth=Math.ceil(Math.min(ax2,bx2))-Math.floor(Math.max(ax1,bx1)),minWidth=Math.ceil(Math.min(ax2-ax1,bx2-bx1));if(xIntersectionWidth>0&&minWidth>=xIntersectionWidth){var intersection=xIntersectionWidth/minWidth;intersection>lastIntersection&&(targetElement=el,lastIntersection=intersection)}else if(0===lastIntersection){var distance=function getDistance(ax1,ay1,ax2,ay2,bx1,by1,bx2,by2){var xDistance=ax2<bx1?bx1-ax2:bx2<ax1?ax1-bx2:0,yDistance=ay2<by1?by1-ay2:by2<ay1?ay1-by2:0;return 0===xDistance?yDistance:0===yDistance?xDistance:Math.sqrt(xDistance*xDistance+yDistance*yDistance)}(ax1,ay1,ax2,ay2,bx1,by1,bx2,by2);(void 0===lastDistance||distance<lastDistance)&&(lastDistance=distance,targetElement=el)}else if(lastIntersection>0)return!1;return!0}}),next=targetElement}next&&(e.preventDefault(),e.stopImmediatePropagation(),(0,keyborg_esm.ev)(next))}}}}},this._tabster=_tabster,this._win=getWindow,this._initTimer=getWindow().setTimeout(this._init,0),this._movers={},_tabster.focusedElement.subscribe(this._onFocus)}return Mover_createClass(MoverAPI,[{key:"dispose",value:function dispose(){var _this$_ignoredInputRe,_this7=this,win=this._win();this._tabster.focusedElement.unsubscribe(this._onFocus),this._initTimer&&(win.clearTimeout(this._initTimer),delete this._initTimer),null===(_this$_ignoredInputRe=this._ignoredInputResolve)||void 0===_this$_ignoredInputRe||_this$_ignoredInputRe.call(this,!1),this._ignoredInputTimer&&(win.clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),win.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._movers).forEach((function(moverId){_this7._movers[moverId]&&(_this7._movers[moverId].dispose(),delete _this7._movers[moverId])}))}},{key:"createMover",value:function createMover(element,props){var newMover=new Mover(this._tabster,element,this._onMoverDispose,props);return this._movers[newMover.id]=newMover,newMover}},{key:"_isIgnoredInput",value:async function _isIgnoredInput(element,keyCode){var _this8=this;if("true"===element.getAttribute("aria-expanded"))return!0;if(matchesSelector(element,_inputSelector)){var asyncRet,selectionStart=0,selectionEnd=0,textLength=0;if("INPUT"===element.tagName||"TEXTAREA"===element.tagName){var type=element.type,_value=element.value;if(textLength=(_value||"").length,"email"===type||"number"===type){if(textLength){var _element$ownerDocumen,selection=null===(_element$ownerDocumen=element.ownerDocument.defaultView)||void 0===_element$ownerDocumen?void 0:_element$ownerDocumen.getSelection();if(selection){var initialLength=selection.toString().length,isBackward=keyCode===Keys_Left||keyCode===Keys_Up;if(selection.modify("extend",isBackward?"backward":"forward","character"),initialLength!==selection.toString().length)return selection.modify("extend",isBackward?"forward":"backward","character"),!0;textLength=0}}}else{var selStart=element.selectionStart;if(null===selStart)return"hidden"===type;selectionStart=selStart||0,selectionEnd=element.selectionEnd||0}}else"true"===element.contentEditable&&(asyncRet=new(getPromise(this._win))((function(resolve){_this8._ignoredInputResolve=function(value){delete _this8._ignoredInputResolve,resolve(value)};var win=_this8._win();_this8._ignoredInputTimer&&win.clearTimeout(_this8._ignoredInputTimer);var _ref2=win.getSelection()||{},prevAnchorNode=_ref2.anchorNode,prevFocusNode=_ref2.focusNode,prevAnchorOffset=_ref2.anchorOffset,prevFocusOffset=_ref2.focusOffset;_this8._ignoredInputTimer=win.setTimeout((function(){var _element$textContent,_this8$_ignoredInputR2;delete _this8._ignoredInputTimer;var _ref3=win.getSelection()||{},anchorNode=_ref3.anchorNode,focusNode=_ref3.focusNode,anchorOffset=_ref3.anchorOffset,focusOffset=_ref3.focusOffset;if(anchorNode===prevAnchorNode&&focusNode===prevFocusNode&&anchorOffset===prevAnchorOffset&&focusOffset===prevFocusOffset){if(selectionStart=anchorOffset||0,selectionEnd=focusOffset||0,textLength=(null===(_element$textContent=element.textContent)||void 0===_element$textContent?void 0:_element$textContent.length)||0,anchorNode&&focusNode&&element.contains(anchorNode)&&element.contains(focusNode)&&anchorNode!==element){var anchorFound=!1,addOffsets=function(node){if(node===anchorNode)anchorFound=!0;else if(node===focusNode)return!0;var nodeText=node.textContent;if(nodeText&&!node.firstChild){var len=nodeText.length;anchorFound?focusNode!==anchorNode&&(selectionEnd+=len):(selectionStart+=len,selectionEnd+=len)}for(var stop=!1,e=node.firstChild;e&&!stop;e=e.nextSibling)stop=addOffsets(e);return stop};addOffsets(element)}null===(_this8$_ignoredInputR2=_this8._ignoredInputResolve)||void 0===_this8$_ignoredInputR2||_this8$_ignoredInputR2.call(_this8,!0)}else{var _this8$_ignoredInputR;null===(_this8$_ignoredInputR=_this8._ignoredInputResolve)||void 0===_this8$_ignoredInputR||_this8$_ignoredInputR.call(_this8,!1)}}),0)})));if(asyncRet&&!await asyncRet)return!0;if(selectionStart!==selectionEnd)return!0;if(selectionStart>0&&(keyCode===Keys_Left||keyCode===Keys_Up||keyCode===Keys_Home))return!0;if(selectionStart<textLength&&(keyCode===Keys_Right||keyCode===Keys_Down||keyCode===Keys_End))return!0}return!1}}]),MoverAPI}();function MutationEvent_createForOfIteratorHelper(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=function MutationEvent_unsupportedIterableToArray(o,minLen){if(!o)return;if("string"==typeof o)return MutationEvent_arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);"Object"===n&&o.constructor&&(n=o.constructor.name);if("Map"===n||"Set"===n)return Array.from(o);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return MutationEvent_arrayLikeToArray(o,minLen)}(o))||allowArrayLike&&o&&"number"==typeof o.length){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(e){throw e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(e){didErr=!0,err=e},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}function MutationEvent_arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ObservedElement_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function ObservedElement_setPrototypeOf(o,p){return ObservedElement_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o},ObservedElement_setPrototypeOf(o,p)}function ObservedElement_createSuper(Derived){var hasNativeReflectConstruct=function ObservedElement_isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function _createSuperInternal(){var result,Super=ObservedElement_getPrototypeOf(Derived);if(hasNativeReflectConstruct){var NewTarget=ObservedElement_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else result=Super.apply(this,arguments);return ObservedElement_possibleConstructorReturn(this,result)}}function ObservedElement_possibleConstructorReturn(self,call){if(call&&("object"==typeof call||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function ObservedElement_assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}function ObservedElement_getPrototypeOf(o){return ObservedElement_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)},ObservedElement_getPrototypeOf(o)}var ObservedElementAPI=function(_Subscribable){!function ObservedElement_inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&ObservedElement_setPrototypeOf(subClass,superClass)}(ObservedElementAPI,_Subscribable);var _super=ObservedElement_createSuper(ObservedElementAPI);function ObservedElementAPI(tabster){var _this;return function ObservedElement_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,ObservedElementAPI),(_this=_super.call(this))._win=void 0,_this._tabster=void 0,_this._initTimer=void 0,_this._waiting={},_this._lastRequestFocusId=0,_this._observedById={},_this._observedByName={},_this._currentRequest=void 0,_this._currentRequestTimestamp=0,_this._init=function(){_this._initTimer=void 0,_this._tabster.focusedElement.subscribe(_this._onFocus)},_this._onFocus=function(e){if(e){var current=_this._currentRequest;if(current){Date.now()-_this._currentRequestTimestamp>=300&&(delete _this._currentRequest,current.cancel())}}},_this.onObservedElementUpdate=function(element){var _getTabsterOnElement,observed=null===(_getTabsterOnElement=Instance_getTabsterOnElement(_this._tabster,element))||void 0===_getTabsterOnElement?void 0:_getTabsterOnElement.observed,uid=getElementUId(_this._win,element),info=_this._observedById[uid];if(observed&&documentContains(element.ownerDocument,element)){info||(info=_this._observedById[uid]={element:new WeakHTMLElement(_this._win,element)}),observed.names.sort();var observedNames=observed.names,prevNames=info.prevNames;_this._isObservedNamesUpdated(observedNames,prevNames)&&(prevNames&&prevNames.forEach((function(prevName){var obn=_this._observedByName[prevName];obn&&obn[uid]&&(Object.keys(obn).length>1?delete obn[uid]:delete _this._observedByName[prevName])})),info.prevNames=observedNames),observedNames.forEach((function(observedName){var obn=_this._observedByName[observedName];obn||(obn=_this._observedByName[observedName]={}),obn[uid]=info,_this._waitConditional(observedName)}))}else if(info){var _prevNames=info.prevNames;_prevNames&&_prevNames.forEach((function(prevName){var obn=_this._observedByName[prevName];obn&&obn[uid]&&(Object.keys(obn).length>1?delete obn[uid]:delete _this._observedByName[prevName])})),delete _this._observedById[uid]}},_this._tabster=tabster,_this._win=tabster.getWindow,_this._initTimer=_this._win().setTimeout(_this._init,0),_this}return function ObservedElement_createClass(Constructor,protoProps,staticProps){return protoProps&&ObservedElement_defineProperties(Constructor.prototype,protoProps),staticProps&&ObservedElement_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}(ObservedElementAPI,[{key:"dispose",value:function dispose(){var win=this._win();this._initTimer&&(win.clearTimeout(this._initTimer),this._initTimer=void 0),this._tabster.focusedElement.unsubscribe(this._onFocus);for(var _i=0,_Object$keys=Object.keys(this._waiting);_i<_Object$keys.length;_i++){var key=_Object$keys[_i];this._rejectWaiting(key)}this._observedById={},this._observedByName={}}},{key:"_rejectWaiting",value:function _rejectWaiting(key,shouldResolve){var w=this._waiting[key];if(w){var win=this._win();w.timer&&win.clearTimeout(w.timer),w.conditionTimer&&win.clearTimeout(w.conditionTimer),!shouldResolve&&w.reject?w.reject():shouldResolve&&w.resolve&&w.resolve(null),delete this._waiting[key]}}},{key:"_isObservedNamesUpdated",value:function _isObservedNamesUpdated(cur,prev){if(!prev||cur.length!==prev.length)return!0;for(var i=0;i<cur.length;++i)if(cur[i]!==prev[i])return!0;return!1}},{key:"getElement",value:function getElement(observedName,accessibility){var o=this._observedByName[observedName];if(o)for(var _i2=0,_Object$keys2=Object.keys(o);_i2<_Object$keys2.length;_i2++){var _uid=_Object$keys2[_i2],el=o[_uid].element.get()||null;return el?(accessibility===src_Types.hu.Accessible&&!this._tabster.focusable.isAccessible(el)||accessibility===src_Types.hu.Focusable&&!this._tabster.focusable.isFocusable(el,!0))&&(el=null):(delete o[_uid],delete this._observedById[_uid]),el}return null}},{key:"waitElement",value:function waitElement(observedName,timeout,accessibility){var _this2=this,el=this.getElement(observedName,accessibility);if(el)return{result:getPromise(this._win).resolve(el),cancel:function(){}};var key=(accessibility===src_Types.hu.Accessible?"a":accessibility===src_Types.hu.Focusable?"f":"_")+observedName,w=this._waiting[key];if(w&&w.request)return w.request;w=this._waiting[key]={timer:this._win().setTimeout((function(){w.conditionTimer&&_this2._win().clearTimeout(w.conditionTimer),delete _this2._waiting[key],w.resolve&&w.resolve(null)}),timeout)};var promise=new(getPromise(this._win))((function(resolve,reject){w.resolve=resolve,w.reject=reject}));return w.request={result:promise,cancel:function(){_this2._rejectWaiting(key,!0)}},accessibility&&this.getElement(observedName)&&this._waitConditional(observedName),w.request}},{key:"requestFocus",value:function requestFocus(observedName,timeout){var _this3=this,requestId=++this._lastRequestFocusId,currentRequestFocus=this._currentRequest;currentRequestFocus&&currentRequestFocus.cancel();var request=this.waitElement(observedName,timeout,src_Types.hu.Focusable);return this._currentRequest=request,this._currentRequestTimestamp=Date.now(),request.result.finally((function(){_this3._currentRequest===request&&delete _this3._currentRequest})),{result:request.result.then((function(element){return!(_this3._lastRequestFocusId!==requestId||!element)&&_this3._tabster.focusedElement.focus(element,!0)})),cancel:function(){request.cancel()}}}},{key:"_waitConditional",value:function _waitConditional(observedName){var _this4=this,waitingElementKey="_"+observedName,waitingAccessibleElementKey="a"+observedName,waitingFocusableElementKey="f"+observedName,waitingElement=this._waiting[waitingElementKey],waitingAccessibleElement=this._waiting[waitingAccessibleElementKey],waitingFocusableElement=this._waiting[waitingFocusableElementKey],win=this._win(),resolve=function(element,key,waiting,accessibility){var _getTabsterOnElement2,observed=null===(_getTabsterOnElement2=Instance_getTabsterOnElement(_this4._tabster,element))||void 0===_getTabsterOnElement2?void 0:_getTabsterOnElement2.observed;observed&&observed.names.includes(observedName)&&(waiting.timer&&win.clearTimeout(waiting.timer),delete _this4._waiting[key],waiting.resolve&&waiting.resolve(element),_this4.trigger(element,{names:[observedName],details:observed.details,accessibility:accessibility}))};if(waitingElement){var element=this.getElement(observedName);element&&documentContains(element.ownerDocument,element)&&resolve(element,waitingElementKey,waitingElement,src_Types.hu.Any)}if(waitingAccessibleElement&&!waitingAccessibleElement.conditionTimer){var resolveAccessible=function(){var element=_this4.getElement(observedName);element&&documentContains(element.ownerDocument,element)&&_this4._tabster.focusable.isAccessible(element)?resolve(element,waitingAccessibleElementKey,waitingAccessibleElement,src_Types.hu.Accessible):waitingAccessibleElement.conditionTimer=win.setTimeout(resolveAccessible,100)};resolveAccessible()}if(waitingFocusableElement&&!waitingFocusableElement.conditionTimer){var resolveFocusable=function(){var element=_this4.getElement(observedName);element&&documentContains(element.ownerDocument,element)&&_this4._tabster.focusable.isFocusable(element,!0)?resolve(element,waitingFocusableElementKey,waitingFocusableElement,src_Types.hu.Focusable):waitingFocusableElement.conditionTimer=win.setTimeout(resolveFocusable,100)};resolveFocusable()}}}]),ObservedElementAPI}(Subscribable);function Outline_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function Outline_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Outline_createClass(Constructor,protoProps,staticProps){return protoProps&&Outline_defineProperties(Constructor.prototype,protoProps),staticProps&&Outline_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}var defaultProps={areaClass:"tabster-focus-outline-area",outlineClass:"tabster-focus-outline",outlineColor:"#ff4500",outlineWidth:2,zIndex:2147483647},_props=defaultProps,OutlinePosition=function(){function OutlinePosition(left,top,right,bottom){Outline_classCallCheck(this,OutlinePosition),this.left=void 0,this.top=void 0,this.right=void 0,this.bottom=void 0,this.left=left,this.top=top,this.right=right,this.bottom=bottom}return Outline_createClass(OutlinePosition,[{key:"equalsTo",value:function equalsTo(other){return this.left===other.left&&this.top===other.top&&this.right===other.right&&this.bottom===other.bottom}},{key:"clone",value:function clone(){return new OutlinePosition(this.left,this.top,this.right,this.bottom)}}]),OutlinePosition}(),OutlineAPI=function(){function OutlineAPI(tabster){var _this=this;Outline_classCallCheck(this,OutlineAPI),this._tabster=void 0,this._win=void 0,this._initTimer=void 0,this._updateTimer=void 0,this._outlinedElement=void 0,this._curPos=void 0,this._isVisible=!1,this._curOutlineElements=void 0,this._allOutlineElements=[],this._fullScreenElement=void 0,this._fullScreenEventName=void 0,this._fullScreenElementName=void 0,this._init=function(){_this._initTimer=void 0,_this._tabster.keyboardNavigation.subscribe(_this._onKeyboardNavigationStateChanged),_this._tabster.focusedElement.subscribe(_this._onFocus);var win=_this._win();win.addEventListener("scroll",_this._onScroll,!0),_this._fullScreenEventName&&win.document.addEventListener(_this._fullScreenEventName,_this._onFullScreenChanged)},this._onFullScreenChanged=function(e){if(_this._fullScreenElementName&&e.target){var target=e.target.body||e.target,outlineElements=_this._getDOM(target);if(target.ownerDocument&&outlineElements){var fsElement=target.ownerDocument[_this._fullScreenElementName];fsElement?(fsElement.appendChild(outlineElements.container),_this._fullScreenElement=fsElement):(target.ownerDocument.body.appendChild(outlineElements.container),_this._fullScreenElement=void 0)}}},this._onKeyboardNavigationStateChanged=function(){_this._onFocus(_this._tabster.focusedElement.getFocusedElement())},this._onFocus=function(e){!_this._updateElement(e)&&_this._isVisible&&_this._setVisibility(!1)},this._onScroll=function(e){_this._outlinedElement&&OutlineAPI._isParentChild(e.target,_this._outlinedElement)&&(_this._curPos=void 0,_this._setOutlinePosition())},this._tabster=tabster,this._win=tabster.getWindow,this._initTimer=this._win().setTimeout(this._init,0),"undefined"!=typeof document&&("onfullscreenchange"in document?(this._fullScreenEventName="fullscreenchange",this._fullScreenElementName="fullscreenElement"):"onwebkitfullscreenchange"in document?(this._fullScreenEventName="webkitfullscreenchange",this._fullScreenElementName="webkitFullscreenElement"):"onmozfullscreenchange"in document?(this._fullScreenEventName="mozfullscreenchange",this._fullScreenElementName="mozFullScreenElement"):"onmsfullscreenchange"in document&&(this._fullScreenEventName="msfullscreenchange",this._fullScreenElementName="msFullscreenElement"))}return Outline_createClass(OutlineAPI,[{key:"setup",value:function setup(props){_props=Object.assign({},_props,props);var win=this._win();win.__tabsterOutline||(win.__tabsterOutline={}),win.__tabsterOutline.style||(win.__tabsterOutline.style=appendStyles(win.document,_props)),props&&props.areaClass?win.document.body.classList.remove(defaultProps.areaClass):win.document.body.classList.add(defaultProps.areaClass)}},{key:"dispose",value:function dispose(){var _this2=this,win=this._win();this._initTimer&&(win.clearTimeout(this._initTimer),this._initTimer=void 0),this._updateTimer&&(win.clearTimeout(this._updateTimer),this._updateTimer=void 0),this._tabster.keyboardNavigation.unsubscribe(this._onKeyboardNavigationStateChanged),this._tabster.focusedElement.unsubscribe(this._onFocus),win.removeEventListener("scroll",this._onScroll,!0),this._fullScreenEventName&&win.document.removeEventListener(this._fullScreenEventName,this._onFullScreenChanged),this._allOutlineElements.forEach((function(outlineElements){return _this2._removeDOM(outlineElements.container)})),this._allOutlineElements=[],delete this._outlinedElement,delete this._curPos,delete this._curOutlineElements,delete this._fullScreenElement}},{key:"_shouldShowCustomOutline",value:function _shouldShowCustomOutline(element){var tabsterOnElement=Instance_getTabsterOnElement(this._tabster,element);if(tabsterOnElement&&tabsterOnElement.outline&&tabsterOnElement.outline.isIgnored)return!1;for(var i=element;i;i=i.parentElement)if(i.classList&&i.classList.contains(_props.areaClass))return!0;return!1}},{key:"_updateElement",value:function _updateElement(e){if(this._outlinedElement=void 0,this._updateTimer&&(this._win().clearTimeout(this._updateTimer),this._updateTimer=void 0),this._curPos=void 0,!this._tabster.keyboardNavigation.isNavigatingWithKeyboard())return!1;if(e){if("INPUT"===e.tagName){if(!(e.type in{button:!0,checkbox:!0,file:!0,image:!0,radio:!0,range:!0,reset:!0,submit:!0}))return!1}else if("TEXTAREA"===e.tagName||"true"===e.contentEditable||"IFRAME"===e.tagName)return!1;return!!this._shouldShowCustomOutline(e)&&(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&(this._outlinedElement=e,this._updateOutline()),!0)}return!1}},{key:"_updateOutline",value:function _updateOutline(){var _this3=this;this._setOutlinePosition(),this._updateTimer&&(this._win().clearTimeout(this._updateTimer),this._updateTimer=void 0),this._outlinedElement&&(this._updateTimer=this._win().setTimeout((function(){_this3._updateTimer=void 0,_this3._updateOutline()}),30))}},{key:"_setVisibility",value:function _setVisibility(visible){this._isVisible=visible,this._curOutlineElements&&(visible?this._curOutlineElements.container.classList.add(`${_props.outlineClass}_visible`):(this._curOutlineElements.container.classList.remove(`${_props.outlineClass}_visible`),this._curPos=void 0))}},{key:"_setOutlinePosition",value:function _setOutlinePosition(){if(this._outlinedElement){var boundingRect=getBoundingRect(this._win,this._outlinedElement),position=new OutlinePosition(boundingRect.left,boundingRect.top,boundingRect.right,boundingRect.bottom);if(!this._curPos||!position.equalsTo(this._curPos)){var outlineElements=this._getDOM(this._outlinedElement),win=this._outlinedElement.ownerDocument&&this._outlinedElement.ownerDocument.defaultView;if(outlineElements&&win){this._curOutlineElements!==outlineElements&&(this._setVisibility(!1),this._curOutlineElements=outlineElements),this._curPos=position;var p=position.clone(),hasAbsolutePositionedParent=!1,hasFixedPositionedParent=!1,container=outlineElements.container,scrollingElement=container&&container.ownerDocument&&container.ownerDocument.scrollingElement;if(scrollingElement){for(var parent=this._outlinedElement.parentElement;parent&&parent!==this._fullScreenElement;parent=parent.parentElement){boundingRect=getBoundingRect(this._win,parent);var _win=parent.ownerDocument&&parent.ownerDocument.defaultView;if(!_win)return;var computedStyle=_win.getComputedStyle(parent),_position=computedStyle.position;"absolute"===_position?hasAbsolutePositionedParent=!0:"fixed"!==_position&&"sticky"!==_position||(hasFixedPositionedParent=!0),"visible"!==computedStyle.overflow&&((hasAbsolutePositionedParent||hasFixedPositionedParent)&&"hidden"!==computedStyle.overflow||(boundingRect.left>p.left&&(p.left=boundingRect.left),boundingRect.top>p.top&&(p.top=boundingRect.top),boundingRect.right<p.right&&(p.right=boundingRect.right),boundingRect.bottom<p.bottom&&(p.bottom=boundingRect.bottom)))}var allRect=getBoundingRect(this._win,scrollingElement),allWidth=allRect.left+allRect.right,allHeight=allRect.top+allRect.bottom,ow=_props.outlineWidth;p.left=p.left>ow?p.left-ow:0,p.top=p.top>ow?p.top-ow:0,p.right=p.right<allWidth-ow?p.right+ow:allWidth,p.bottom=p.bottom<allHeight-ow?p.bottom+ow:allHeight;var width=p.right-p.left,height=p.bottom-p.top;if(width>2*ow&&height>2*ow){var leftBorderNode=outlineElements.left,topBorderNode=outlineElements.top,rightBorderNode=outlineElements.right,bottomBorderNode=outlineElements.bottom,sx=this._fullScreenElement||hasFixedPositionedParent?0:win.pageXOffset,sy=this._fullScreenElement||hasFixedPositionedParent?0:win.pageYOffset;container.style.position=hasFixedPositionedParent?"fixed":"absolute",container.style.background=_props.outlineColor,leftBorderNode.style.width=rightBorderNode.style.width=topBorderNode.style.height=bottomBorderNode.style.height=_props.outlineWidth+"px",leftBorderNode.style.left=topBorderNode.style.left=bottomBorderNode.style.left=p.left+sx+"px",rightBorderNode.style.left=p.left+sx+width-ow+"px",leftBorderNode.style.top=rightBorderNode.style.top=topBorderNode.style.top=p.top+sy+"px",bottomBorderNode.style.top=p.top+sy+height-ow+"px",leftBorderNode.style.height=rightBorderNode.style.height=height+"px",topBorderNode.style.width=bottomBorderNode.style.width=width+"px",this._setVisibility(!0)}else this._setVisibility(!1)}}}}}},{key:"_getDOM",value:function _getDOM(contextElement){var doc=contextElement.ownerDocument,win=doc&&doc.defaultView;if(doc&&win&&win.__tabsterOutline){if(win.__tabsterOutline.style||(win.__tabsterOutline.style=appendStyles(doc,_props)),!win.__tabsterOutline.elements){var outlineElements={container:doc.createElement("div"),left:doc.createElement("div"),top:doc.createElement("div"),right:doc.createElement("div"),bottom:doc.createElement("div")};outlineElements.container.className=_props.outlineClass,outlineElements.left.className=`${_props.outlineClass}__left`,outlineElements.top.className=`${_props.outlineClass}__top`,outlineElements.right.className=`${_props.outlineClass}__right`,outlineElements.bottom.className=`${_props.outlineClass}__bottom`,outlineElements.container.appendChild(outlineElements.left),outlineElements.container.appendChild(outlineElements.top),outlineElements.container.appendChild(outlineElements.right),outlineElements.container.appendChild(outlineElements.bottom),doc.body.appendChild(outlineElements.container),win.__tabsterOutline.elements=outlineElements,this._allOutlineElements.push(outlineElements)}return win.__tabsterOutline.elements}}},{key:"_removeDOM",value:function _removeDOM(contextElement){var win=contextElement.ownerDocument&&contextElement.ownerDocument.defaultView,outline=win&&win.__tabsterOutline;if(outline){outline.style&&outline.style.parentNode&&(outline.style.parentNode.removeChild(outline.style),delete outline.style);var outlineElements=outline&&outline.elements;outlineElements&&(outlineElements.container.parentNode&&outlineElements.container.parentNode.removeChild(outlineElements.container),delete outline.elements)}}}],[{key:"_isParentChild",value:function _isParentChild(parent,child){return child===parent||!!(parent.compareDocumentPosition(child)&document.DOCUMENT_POSITION_CONTAINED_BY)}}]),OutlineAPI}();function appendStyles(document,props){var style=document.createElement("style");return style.type="text/css",style.appendChild(document.createTextNode(function getOutlineStyles(props){return`\n.${props.areaClass} *, .${props.areaClass} *:focus {\noutline: none !important;\n}\n\n.${props.outlineClass} {\ndisplay: none;\nposition: absolute;\nwidth: 0;\nheight: 0;\nleft: 0;\ntop: 0;\nz-index: ${props.zIndex};\n}\n\n.${props.outlineClass}.${props.outlineClass}_visible {\ndisplay: block;\n}\n\n.${props.outlineClass}__left,\n.${props.outlineClass}__top,\n.${props.outlineClass}__right,\n.${props.outlineClass}__bottom {\nposition: absolute;\nbackground: inherit;\n}`}(props))),document.head.appendChild(style),style}function Uncontrolled_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Uncontrolled_createClass(Constructor,protoProps,staticProps){return protoProps&&Uncontrolled_defineProperties(Constructor.prototype,protoProps),staticProps&&Uncontrolled_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}var UncontrolledAPI=Uncontrolled_createClass((function UncontrolledAPI(){!function Uncontrolled_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,UncontrolledAPI)}));function Tabster_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function Tabster_createClass(Constructor,protoProps,staticProps){return protoProps&&Tabster_defineProperties(Constructor.prototype,protoProps),staticProps&&Tabster_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function Tabster_classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var Tabster=Tabster_createClass((function Tabster(tabster){Tabster_classCallCheck(this,Tabster),this.keyboardNavigation=void 0,this.focusedElement=void 0,this.focusable=void 0,this.root=void 0,this.uncontrolled=void 0,this.core=void 0,this.keyboardNavigation=tabster.keyboardNavigation,this.focusedElement=tabster.focusedElement,this.focusable=tabster.focusable,this.root=tabster.root,this.uncontrolled=tabster.uncontrolled,this.core=tabster})),TabsterCore=function(){function TabsterCore(win,props){var _props$controlTab,_this=this;Tabster_classCallCheck(this,TabsterCore),this._storage=void 0,this._unobserve=void 0,this._win=void 0,this._forgetMemorizedTimer=void 0,this._forgetMemorizedElements=[],this._wrappers=new Set,this._version="3.0.8",this._noop=!1,this.controlTab=void 0,this.rootDummyInputs=void 0,this.keyboardNavigation=void 0,this.focusedElement=void 0,this.focusable=void 0,this.root=void 0,this.uncontrolled=void 0,this.internal=void 0,this.groupper=void 0,this.mover=void 0,this.outline=void 0,this.deloser=void 0,this.modalizer=void 0,this.observedElement=void 0,this.crossOrigin=void 0,this.getWindow=function(){if(!_this._win)throw new Error("Using disposed Tabster.");return _this._win},this._storage=function createWeakMap(win){var ctx=win.__tabsterInstanceContext;return new((null==ctx?void 0:ctx.basics.WeakMap)||WeakMap)}(win),this._win=win;var getWindow=this.getWindow;this.keyboardNavigation=new KeyboardNavigationState(getWindow),this.focusedElement=new FocusedElementState(this,getWindow),this.focusable=new FocusableAPI(this,getWindow),this.root=new RootAPI(this,null==props?void 0:props.autoRoot),this.uncontrolled=new UncontrolledAPI,this.controlTab=null===(_props$controlTab=null==props?void 0:props.controlTab)||void 0===_props$controlTab||_props$controlTab,this.rootDummyInputs=!(null==props||!props.rootDummyInputs),this.internal={stopObserver:function(){_this._unobserve&&(_this._unobserve(),delete _this._unobserve)},resumeObserver:function(syncState){if(!_this._unobserve){var doc=getWindow().document;_this._unobserve=function observeMutations(doc,tabster,updateTabsterByAttribute,syncState){if("undefined"==typeof MutationObserver)return function(){};var elementByUId,getWindow=tabster.getWindow;function updateTabsterElements(node,removed){elementByUId||(elementByUId=getInstanceContext(getWindow).elementByUId),processNode(node,removed);var walker=Utils_createElementTreeWalker(doc,node,(function(element){return processNode(element,removed)}));if(walker)for(;walker.nextNode(););}function processNode(element,removed){if(!element.getAttribute)return NodeFilter.FILTER_SKIP;var _elementByUId,_elementByUId$uid,uid=element.__tabsterElementUID;return uid&&elementByUId&&(removed?delete elementByUId[uid]:null!==(_elementByUId$uid=(_elementByUId=elementByUId)[uid])&&void 0!==_elementByUId$uid||(_elementByUId[uid]=new WeakHTMLElement(getWindow,element))),(Instance_getTabsterOnElement(tabster,element)||element.hasAttribute(src_Types.jN))&&updateTabsterByAttribute(tabster,element,removed),NodeFilter.FILTER_SKIP}var observer=new MutationObserver((function(mutations){var _step,_iterator=MutationEvent_createForOfIteratorHelper(mutations);try{for(_iterator.s();!(_step=_iterator.n()).done;){var mutation=_step.value,target=mutation.target,removed=mutation.removedNodes,added=mutation.addedNodes;if("attributes"===mutation.type)mutation.attributeName===src_Types.jN&&updateTabsterByAttribute(tabster,target);else{for(var i=0;i<removed.length;i++)updateTabsterElements(removed[i],!0);for(var _i=0;_i<added.length;_i++)updateTabsterElements(added[_i])}}}catch(err){_iterator.e(err)}finally{_iterator.f()}}));return syncState&&updateTabsterElements(getWindow().document.body),observer.observe(doc,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[src_Types.jN]}),function(){observer.disconnect()}}(doc,_this,Instance_updateTabsterByAttribute,syncState)}}},this.internal.resumeObserver(!1),startFakeWeakRefsCleanup(getWindow)}return Tabster_createClass(TabsterCore,[{key:"createTabster",value:function createTabster(noRefCount){var wrapper=new Tabster(this);return noRefCount||this._wrappers.add(wrapper),wrapper}},{key:"disposeTabster",value:function disposeTabster(wrapper,allInstances){allInstances?this._wrappers.clear():this._wrappers.delete(wrapper),0===this._wrappers.size&&this.dispose()}},{key:"dispose",value:function dispose(){var _this$outline,_this$crossOrigin,_this$deloser,_this$groupper,_this$mover,_this$modalizer,_this$observedElement;this.internal.stopObserver();var win=this._win;this._forgetMemorizedElements=[],win&&this._forgetMemorizedTimer&&(win.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),null===(_this$outline=this.outline)||void 0===_this$outline||_this$outline.dispose(),null===(_this$crossOrigin=this.crossOrigin)||void 0===_this$crossOrigin||_this$crossOrigin.dispose(),null===(_this$deloser=this.deloser)||void 0===_this$deloser||_this$deloser.dispose(),null===(_this$groupper=this.groupper)||void 0===_this$groupper||_this$groupper.dispose(),null===(_this$mover=this.mover)||void 0===_this$mover||_this$mover.dispose(),null===(_this$modalizer=this.modalizer)||void 0===_this$modalizer||_this$modalizer.dispose(),null===(_this$observedElement=this.observedElement)||void 0===_this$observedElement||_this$observedElement.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),function stopFakeWeakRefsCleanupAndClearStorage(getWindow){var context=getInstanceContext(getWindow);context.fakeWeakRefsStarted=!1,context.fakeWeakRefsTimer&&(getWindow().clearTimeout(context.fakeWeakRefsTimer),context.fakeWeakRefsTimer=void 0,context.fakeWeakRefs=[])}(this.getWindow),clearElementCache(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),win&&(!function disposeInstanceContext(win){var ctx=win.__tabsterInstanceContext;ctx&&(ctx.elementByUId={},delete ctx.WeakRef,ctx.containerBoundingRectCache={},ctx.containerBoundingRectCacheTimer&&win.clearTimeout(ctx.containerBoundingRectCacheTimer),ctx.fakeWeakRefsTimer&&win.clearTimeout(ctx.fakeWeakRefsTimer),ctx.fakeWeakRefs=[],delete win.__tabsterInstanceContext)}(win),delete win.__tabsterInstance,delete this._win)}},{key:"storageEntry",value:function storageEntry(element,addremove){var storage=this._storage,entry=storage.get(element);return entry?!1===addremove&&0===Object.keys(entry).length&&storage.delete(element):!0===addremove&&(entry={},storage.set(element,entry)),entry}},{key:"forceCleanup",value:function forceCleanup(){var _this2=this;this._win&&(this._forgetMemorizedElements.push(this._win.document.body),this._forgetMemorizedTimer||(this._forgetMemorizedTimer=this._win.setTimeout((function(){delete _this2._forgetMemorizedTimer;for(var el=_this2._forgetMemorizedElements.shift();el;el=_this2._forgetMemorizedElements.shift())clearElementCache(_this2.getWindow,el),FocusedElementState.forgetMemorized(_this2.focusedElement,el)}),0),cleanupFakeWeakRefs(this.getWindow,!0)))}}]),TabsterCore}();function createTabster(win,props){var tabster=getCurrentTabster(win);return tabster||(tabster=new TabsterCore(win,props),win.__tabsterInstance=tabster),tabster.createTabster()}function getGroupper(tabster){var tabsterCore=tabster.core;return tabsterCore.groupper||(tabsterCore.groupper=new GroupperAPI(tabsterCore,tabsterCore.getWindow)),tabsterCore.groupper}function getMover(tabster){var tabsterCore=tabster.core;return tabsterCore.mover||(tabsterCore.mover=new MoverAPI(tabsterCore,tabsterCore.getWindow)),tabsterCore.mover}function getOutline(tabster){var tabsterCore=tabster.core;return tabsterCore.outline||(tabsterCore.outline=new OutlineAPI(tabsterCore)),tabsterCore.outline}function getDeloser(tabster,props){var tabsterCore=tabster.core;return tabsterCore.deloser||(tabsterCore.deloser=new DeloserAPI(tabsterCore,props)),tabsterCore.deloser}function getModalizer(tabster){var tabsterCore=tabster.core;return tabsterCore.modalizer||(tabsterCore.modalizer=new ModalizerAPI(tabsterCore)),tabsterCore.modalizer}function getObservedElement(tabster){var tabsterCore=tabster.core;return tabsterCore.observedElement||(tabsterCore.observedElement=new ObservedElementAPI(tabsterCore)),tabsterCore.observedElement}function getCrossOrigin(tabster){var tabsterCore=tabster.core;return tabsterCore.crossOrigin||(getDeloser(tabster),getModalizer(tabster),getMover(tabster),getGroupper(tabster),getOutline(tabster),getObservedElement(tabster),tabsterCore.crossOrigin=new CrossOriginAPI(tabsterCore)),tabsterCore.crossOrigin}function disposeTabster(tabster,allInstances){tabster.core.disposeTabster(tabster,allInstances)}function getCurrentTabster(win){return win.__tabsterInstance}},"./src/Types.ts":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,{$I:function(){return TabsterDummyInputAttributeName},EL:function(){return Visibilities},Km:function(){return MoverEventName},LL:function(){return ModalizerEventName},Yy:function(){return DeloserEventName},bM:function(){return MoverDirections},ho:function(){return RestoreFocusOrders},hu:function(){return ObservedElementAccesibilities},jN:function(){return TabsterAttributeName},ti:function(){return GroupperTabbabilities}});var TabsterAttributeName="data-tabster",TabsterDummyInputAttributeName="data-tabster-dummy",DeloserEventName="tabster:deloser",ModalizerEventName="tabster:modalizer",MoverEventName="tabster:mover",ObservedElementAccesibilities={Any:0,Accessible:1,Focusable:2},RestoreFocusOrders={History:0,DeloserDefault:1,RootDefault:2,DeloserFirst:3,RootFirst:4},Visibilities={Invisible:0,PartiallyVisible:1,Visible:2},MoverDirections={Both:0,Vertical:1,Horizontal:2,Grid:3},GroupperTabbabilities={Unlimited:0,Limited:1,LimitedTrapFocus:2}},"./storybook-init-framework-entry.js":function(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__){"use strict";__webpack_require__("./node_modules/@storybook/html/dist/esm/client/index.js")},"./stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.(js%7Cjsx%7Cts%7Ctsx))$":function(module,__unused_webpack_exports,__webpack_require__){var map={"./Groupper/Groupper.stories.ts":"./stories/Groupper/Groupper.stories.ts","./Modalizer/Modalizer.stories.ts":"./stories/Modalizer/Modalizer.stories.ts","./Mover/Mover.stories.ts":"./stories/Mover/Mover.stories.ts","./Observed/Observed.stories.ts":"./stories/Observed/Observed.stories.ts","./TestContainer.stories.tsx":"./stories/TestContainer.stories.tsx"};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id="./stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.(js%7Cjsx%7Cts%7Ctsx))$"},"./stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.mdx)$":function(module){function webpackEmptyContext(req){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}webpackEmptyContext.keys=function(){return[]},webpackEmptyContext.resolve=webpackEmptyContext,webpackEmptyContext.id="./stories sync recursive ^\\.(?:(?:^%7C\\/%7C(?:(?:(?%21(?:^%7C\\/)\\.).)*?)\\/)(?%21\\.)(?=.)[^/]*?\\.stories\\.mdx)$",module.exports=webpackEmptyContext},"?4f7e":function(){}},function(__webpack_require__){var __webpack_exec__=function(moduleId){return __webpack_require__(__webpack_require__.s=moduleId)};__webpack_require__.O(0,[345],(function(){return __webpack_exec__("./node_modules/@storybook/core-client/dist/esm/globals/polyfills.js"),__webpack_exec__("./node_modules/@storybook/core-client/dist/esm/globals/globals.js"),__webpack_exec__("./storybook-init-framework-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-docs/dist/esm/frameworks/common/config.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-docs/dist/esm/frameworks/html/config.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/html/dist/esm/client/preview/config-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-links/dist/esm/preset/addDecorator.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-actions/dist/esm/preset/addDecorator.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-actions/dist/esm/preset/addArgs.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-backgrounds/dist/esm/preset/addDecorator.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-backgrounds/dist/esm/preset/addParameter.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-measure/dist/esm/preset/addDecorator.js-generated-config-entry.js"),__webpack_exec__("./node_modules/@storybook/addon-outline/dist/esm/preset/addDecorator.js-generated-config-entry.js"),__webpack_exec__("./.storybook/preview.js-generated-config-entry.js"),__webpack_exec__("./generated-stories-entry.js")}));__webpack_require__.O()}]);